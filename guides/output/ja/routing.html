<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
  <head>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport"    content="width=device-width, initial-scale=1"/>
    <meta name="description" content="Rails ガイドは、Ruby on Rails Guides に基づいた Rails 4.2 対応のリファレンスガイドです。Rails 開発で生産性を向上する方法や、各部品がどのように連携しているかなどを体系的に理解する上で役に立ちます。" />
    <meta name="keywords"    content="Ruby Rails ガイド 体系的 入門 無料" />
    <meta name="author"      content="Ruby on Rails Community" />

    <meta property="fb:admins"      content="715330868" />
    <meta property="og:title"       content="Ruby on Rails ガイド：体系的に Rails を学ぼう"/>
    <meta property="og:site_name"   content="Ruby on Rails ガイド：体系的に Rails を学ぼう"/>
    <meta property="og:image"       content="http://railsguides.jp/images/cover_for_facebook.png"/>
    <meta property="og:url"         content="http://railsguides.jp/" />
    <meta property="og:type"        content="article" />
    <meta property="og:description" content="Rails ガイドは、Ruby on Rails Guides に基づいた Rails 4.2 対応のリファレンスガイドです。Rails 開発で生産性を向上する方法や、各部品がどのように連携しているかなどを体系的に理解する上で役に立ちます。" />

    <meta name="twitter:card"  content="summary" />
    <meta name="twitter:site"  content="@RailsGuidesJP" />
    <meta name="twitter:title" content="Ruby on Rails ガイド：体系的に Rails を学ぼう" />
    <meta name="twitter:description" content="Rails ガイドは、Ruby on Rails Guides に基づいた Rails 4.2 対応のリファレンスガイドです。Rails 開発で生産性を向上する方法や、各部品がどのように連携しているかなどを体系的に理解する上で役に立ちます。" />
    <meta name="twitter:image" content="http://railsguides.jp/images/cover_for_twitter.png" />
    <meta name="twitter:url"   content="http://railsguides.jp/" />

    <title>Rails のルーティング — Rails ガイド</title>
    <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
    <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

    <link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

    <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />

    <link rel="apple-touch-icon" sizes="57x57" href="images/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="images/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="images/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="images/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="images/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="images/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="images/favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="images/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicons/favicon-16x16.png">
    <link rel="manifest" href="images/favicons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="images/favicons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

  </head>
<body class="guide">
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=614116885378153&version=v2.0";
    fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">関連サイト: </strong>
      <span class="red-button more-info-button">関連URL</span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://guides.rubyonrails.org/">原著 (英語)</a></li>
        <li class="more-info"><a href="https://github.com/yasslab/railsguides.jp">ソースコード (GitHub)</a></li>
        <li class="more-info"><a href="http://railstutorial.jp/">Rails チュートリアル</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="/" title="Return to home page">railsguides.jp</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="/">ホーム</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">ガイド目次</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>はじめに</dt>
                <dd><a href="getting_started.html">Rails をはじめよう</a></dd>
                <dt>モデル</dt>
                <dd><a href="active_record_basics.html">Active Record の基礎</a></dd>
                <dd><a href="active_record_migrations.html">Active Record マイグレーション</a></dd>
                <dd><a href="active_record_validations.html">Active Record バリデーション</a></dd>
                <dd><a href="active_record_callbacks.html">Active Record コールバック</a></dd>
                <dd><a href="association_basics.html">Active Record の関連付け</a></dd>
                <dd><a href="active_record_querying.html">Active Record クエリインターフェイス</a></dd>
                <dd><a href="active_model_basics.html">Active Model の基礎</a></dd>
                <dt>ビュー</dt>
                <dd><a href="action_view_overview.html">Action View の概要</a></dd>
                <dd><a href="layouts_and_rendering.html">レイアウトとレンダリング</a></dd>
                <dd><a href="form_helpers.html">Action View フォームヘルパー</a></dd>
                <dt>コントローラ</dt>
                <dd><a href="action_controller_overview.html">Action Controller の概要</a></dd>
                <dd><a href="routing.html">Rails ルーティング</a></dd>
              </dl>
              <dl class="R">
                <dt>高度なトピック</dt>
                <dd><a href="active_support_core_extensions.html">Active Support コア拡張機能</a></dd>
                <dd><a href="i18n.html">Rails 国際化 (i18n) API</a></dd>
                <dd><a href="action_mailer_basics.html">Action Mailer の基礎</a></dd>
                <dd><a href="active_job_basics.html">Active Job の基礎</a></dd>
                <dd><a href="testing.html">Rails テスティングガイド</a></dd>
                <dd><a href="security.html">Rails セキュリティガイド</a></dd>
                <dd><a href="debugging_rails_applications.html">Rails アプリケーションのデバッグ</a></dd>
                <dd><a href="configuring.html">Rails アプリケーションを設定する</a></dd>
                <dd><a href="command_line.html">コマンドラインツールと Rake タスク</a></dd>
                <dd><a href="asset_pipeline.html">アセットパイプライン</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">Rails で JavaScript を使用する</a></dd>
                <dd><a href="engines.html">Rails エンジン入門</a></dd>
                <dd><a href="initialization.html">Rails の初期化プロセス</a></dd>
                <dd><a href="constant_autoloading_and_reloading.html">定数の自動読み込みと再読み込み</a></dd>
                <dt>Rails を拡張する</dt>
                <dd><a href="plugins.html">Rails プラグイン作成入門</a></dd>
                <dd><a href="rails_on_rack.html">Rails と Rack</a></dd>
                <dd><a href="generators.html">Rails ジェネレータとテンプレート入門</a></dd>
                <dt>Ruby on Rails に貢献する</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails [未着手]</a></dd>
                <dd><a href="api_documentation_guidelines.html">APIドキュメント作成ガイドライン</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">Rails ガイドのガイドライン</a></dd>
                <dt>メンテナンスポリシー</dt>
                <dd><a href="maintenance_policy.html">メンテナンスポリシー</a></dd>
                <dt>リリースノート</dt>
                <dd><a href="upgrading_ruby_on_rails.html">Rails アップグレードガイド</a></dd>
                <dd><a href="4_2_release_notes.html">Ruby on Rails 4.2 リリースノート</a></dd>
                <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1 リリースノート</a></dd>
                <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0 リリースノート</a></dd>
                <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes [未着手]</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes [未着手]</a></dd>
                <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes [未着手]</a></dd>
                <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes [未着手]</a></dd>
                <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes [未着手]</a></dd>
              </dl>
          </div>
        </li>
        <li><a class="nav-item" href="https://github.com/yasslab/railsguides.jp#readme">翻訳に貢献する</a></li>
        <li><a class="nav-item" href="credits.html">原著者</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">ガイド目次</option>
              <optgroup label="はじめに">
                  <option value="getting_started.html">Rails をはじめよう</option>
              </optgroup>
              <optgroup label="モデル">
                  <option value="active_record_basics.html">Active Record の基礎</option>
                  <option value="active_record_migrations.html">Active Record マイグレーション</option>
                  <option value="active_record_validations.html">Active Record バリデーション</option>
                  <option value="active_record_callbacks.html">Active Record コールバック</option>
                  <option value="association_basics.html">Active Record の関連付け</option>
                  <option value="active_record_querying.html">Active Record クエリインターフェイス</option>
                  <option value="active_model_basics.html">Active Model の基礎</option>
              </optgroup>
              <optgroup label="ビュー">
                  <option value="action_view_overview.html">Action View の概要</option>
                  <option value="layouts_and_rendering.html">レイアウトとレンダリング</option>
                  <option value="form_helpers.html">Action View フォームヘルパー</option>
              </optgroup>
              <optgroup label="コントローラ">
                  <option value="action_controller_overview.html">Action Controller の概要</option>
                  <option value="routing.html">Rails ルーティング</option>
              </optgroup>
              <optgroup label="高度なトピック">
                  <option value="active_support_core_extensions.html">Active Support コア拡張機能</option>
                  <option value="i18n.html">Rails 国際化 (i18n) API</option>
                  <option value="action_mailer_basics.html">Action Mailer の基礎</option>
                  <option value="active_job_basics.html">Active Job の基礎</option>
                  <option value="testing.html">Rails テスティングガイド</option>
                  <option value="security.html">Rails セキュリティガイド</option>
                  <option value="debugging_rails_applications.html">Rails アプリケーションのデバッグ</option>
                  <option value="configuring.html">Rails アプリケーションを設定する</option>
                  <option value="command_line.html">コマンドラインツールと Rake タスク</option>
                  <option value="asset_pipeline.html">アセットパイプライン</option>
                  <option value="working_with_javascript_in_rails.html">Rails で JavaScript を使用する</option>
                  <option value="engines.html">Rails エンジン入門</option>
                  <option value="initialization.html">Rails の初期化プロセス</option>
                  <option value="constant_autoloading_and_reloading.html">定数の自動読み込みと再読み込み</option>
              </optgroup>
              <optgroup label="Rails を拡張する">
                  <option value="plugins.html">Rails プラグイン作成入門</option>
                  <option value="rails_on_rack.html">Rails と Rack</option>
                  <option value="generators.html">Rails ジェネレータとテンプレート入門</option>
              </optgroup>
              <optgroup label="Ruby on Rails に貢献する">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails [未着手]</option>
                  <option value="api_documentation_guidelines.html">APIドキュメント作成ガイドライン</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Rails ガイドのガイドライン</option>
              </optgroup>
              <optgroup label="メンテナンスポリシー">
                  <option value="maintenance_policy.html">メンテナンスポリシー</option>
              </optgroup>
              <optgroup label="リリースノート">
                  <option value="upgrading_ruby_on_rails.html">Rails アップグレードガイド</option>
                  <option value="4_2_release_notes.html">Ruby on Rails 4.2 リリースノート</option>
                  <option value="4_1_release_notes.html">Ruby on Rails 4.1 リリースノート</option>
                  <option value="4_0_release_notes.html">Ruby on Rails 4.0 リリースノート</option>
                  <option value="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes [未着手]</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes [未着手]</option>
                  <option value="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes [未着手]</option>
                  <option value="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes [未着手]</option>
                  <option value="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes [未着手]</option>
              </optgroup>
          </select>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Rails のルーティング</h2><p>このガイドでは、開発者に向けてRailsのルーティング機能を解説します (訳注: routeとrootを区別するため、訳文ではrouteを基本的に「ルーティング」と訳します)。</p><p>このガイドの内容:</p>
<ul>
<li><code>routes.rb</code>のコードの読み方</li>
<li>独自のルーティング作成法 (リソースベースのルーティングが推奨されますが、<code>match</code>メソッドによるルーティングも可能です)</li>
<li>アクション側で受け取るパラメータ</li>
<li>ルーティングヘルパーを使用してパスやURLを自動生成する方法</li>
<li>制限追加やRackエンドポイントなどの高度な手法</li>
</ul>

                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />目次</h3>
            <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<ol class="chapters">
<li>
<a href="#rails%E3%83%AB%E3%83%BC%E3%82%BF%E3%83%BC%E3%81%AE%E7%9B%AE%E7%9A%84">Railsルーターの目的</a>

<ul>
<li><a href="#url%E3%82%92%E5%AE%9F%E9%9A%9B%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AB%E5%89%B2%E3%82%8A%E6%8C%AF%E3%82%8B">URLを実際のコードに割り振る</a></li>
<li><a href="#%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%82%89%E3%83%91%E3%82%B9%E3%82%84url%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B">コードからパスやURLを生成する</a></li>
</ul>
</li>
<li>
<a href="#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0:-rails%E3%81%AE%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88">リソースベースのルーティング: Railsのデフォルト</a>

<ul>
<li><a href="#web%E4%B8%8A%E3%81%AE%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9">Web上のリソース</a></li>
<li><a href="#crud%E3%80%81%E5%8B%95%E8%A9%9E%E3%80%81%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3">CRUD、動詞、アクション</a></li>
<li><a href="#%E3%83%91%E3%82%B9%E3%81%A8url%E7%94%A8%E3%83%98%E3%83%AB%E3%83%91%E3%83%BC">パスとURL用ヘルパー</a></li>
<li><a href="#%E8%A4%87%E6%95%B0%E3%81%AE%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E5%90%8C%E6%99%82%E3%81%AB%E5%AE%9A%E7%BE%A9%E3%81%99%E3%82%8B">複数のリソースを同時に定義する</a></li>
<li><a href="#%E5%8D%98%E6%95%B0%E5%BD%A2%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9">単数形リソース</a></li>
<li><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%81%AE%E5%90%8D%E5%89%8D%E7%A9%BA%E9%96%93%E3%81%A8%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">コントローラの名前空間とルーティング</a></li>
<li><a href="#%E3%83%8D%E3%82%B9%E3%83%88%E3%81%97%E3%81%9F%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9">ネストしたリソース</a></li>
<li><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E3%80%8Cconcern%E3%80%8D%E6%A9%9F%E8%83%BD">ルーティングの「concern」機能</a></li>
<li><a href="#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%8B%E3%82%89%E3%83%91%E3%82%B9%E3%81%A8url%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B">オブジェクトからパスとURLを作成する</a></li>
<li><a href="#restful%E3%81%AA%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E3%81%95%E3%82%89%E3%81%AB%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">RESTfulなアクションをさらに追加する</a></li>
</ul>
</li>
<li>
<a href="#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%83%95%E3%83%AB%E3%81%A7%E3%81%AA%E3%81%84%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">リソースフルでないルーティング</a>

<ul>
<li><a href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AE%E5%89%B2%E3%82%8A%E5%BD%93%E3%81%A6">パラメータの割り当て</a></li>
<li><a href="#%E5%8B%95%E7%9A%84%E3%81%AA%E3%82%BB%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88">動的なセグメント</a></li>
<li><a href="#%E9%9D%99%E7%9A%84%E3%81%AA%E3%82%BB%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88">静的なセグメント</a></li>
<li><a href="#%E3%82%AF%E3%82%A8%E3%83%AA%E6%96%87%E5%AD%97%E5%88%97">クエリ文字列</a></li>
<li><a href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E8%A8%AD%E5%AE%9A%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%99%E3%82%8B">デフォルト設定を定義する</a></li>
<li><a href="#%E5%90%8D%E5%89%8D%E4%BB%98%E3%81%8D%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">名前付きルーティング</a></li>
<li><a href="#http%E5%8B%95%E8%A9%9E%E3%82%92%E5%88%B6%E9%99%90%E3%81%99%E3%82%8B">HTTP動詞を制限する</a></li>
<li><a href="#%E3%82%BB%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E5%88%B6%E9%99%90%E3%81%99%E3%82%8B">セグメントを制限する</a></li>
<li><a href="#%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E5%86%85%E5%AE%B9%E3%81%AB%E5%BF%9C%E3%81%98%E3%81%A6%E5%88%B6%E9%99%90%E3%82%92%E5%8A%A0%E3%81%88%E3%82%8B">リクエスト内容に応じて制限を加える</a></li>
<li><a href="#%E9%AB%98%E5%BA%A6%E3%81%AA%E5%88%B6%E9%99%90">高度な制限</a></li>
<li><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%B0%E3%83%AD%E3%83%96%E3%81%A8%E3%83%AF%E3%82%A4%E3%83%AB%E3%83%89%E3%82%AB%E3%83%BC%E3%83%89%E3%82%BB%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88">ルーティンググロブとワイルドカードセグメント</a></li>
<li><a href="#%E3%83%AA%E3%83%80%E3%82%A4%E3%83%AC%E3%82%AF%E3%83%88">リダイレクト</a></li>
<li><a href="#rack%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B">Rackアプリケーションにルーティングする</a></li>
<li><a href="#root%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><code>root</code>を使用する</a></li>
<li><a href="#unicode%E6%96%87%E5%AD%97%E5%88%97%E3%82%92%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">Unicode文字列をルーティングで使用する</a></li>
</ul>
</li>
<li>
<a href="#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%83%95%E3%83%AB%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA%E3%81%99%E3%82%8B">リソースフルルーティングをカスタマイズする</a>

<ul>
<li><a href="#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">使用するコントローラを指定する</a></li>
<li><a href="#%E5%88%B6%E9%99%90%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">制限を指定する</a></li>
<li><a href="#%E5%90%8D%E5%89%8D%E4%BB%98%E3%81%8D%E3%83%98%E3%83%AB%E3%83%91%E3%83%BC%E3%82%92%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%A9%E3%82%A4%E3%83%89%E3%81%99%E3%82%8B">名前付きヘルパーをオーバーライドする</a></li>
<li><a href="#new%E3%82%BB%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88%E3%82%84edit%E3%82%BB%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%A9%E3%82%A4%E3%83%89%E3%81%99%E3%82%8B"><code>new</code>セグメントや<code>edit</code>セグメントをオーバーライドする</a></li>
<li><a href="#%E5%90%8D%E5%89%8D%E4%BB%98%E3%81%8D%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%83%98%E3%83%AB%E3%83%91%E3%83%BC%E3%81%AB%E3%83%97%E3%83%AC%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">名前付きルーティングヘルパーにプレフィックスを追加する</a></li>
<li><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E4%BD%9C%E6%88%90%E3%82%92%E5%88%B6%E9%99%90%E3%81%99%E3%82%8B">ルーティングの作成を制限する</a></li>
<li><a href="#%E3%83%91%E3%82%B9%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B">パスを変更する</a></li>
<li><a href="#%E3%80%8C%E5%8D%98%E6%95%B0%E5%BD%A2%E3%81%AE%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%80%8D%E3%82%92%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%A9%E3%82%A4%E3%83%89%E3%81%99%E3%82%8B">「単数形のフォーム」をオーバーライドする</a></li>
<li><a href="#%E5%90%8D%E5%89%8D%E4%BB%98%E3%81%8D%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%A7:as%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">名前付きリソースで<code>:as</code>を使用する</a></li>
</ul>
</li>
<li>
<a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E8%AA%BF%E6%9F%BB%E3%81%A8%E3%83%86%E3%82%B9%E3%83%88">ルーティングの調査とテスト</a>

<ul>
<li><a href="#%E6%97%A2%E5%AD%98%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%AB%E3%82%92%E4%B8%80%E8%A6%A7%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B">既存のルールを一覧表示する</a></li>
<li><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E3%83%86%E3%82%B9%E3%83%88%E3%81%99%E3%82%8B">ルーティングをテストする</a></li>
</ul>
</li>
</ol>
</body></html>

          </div>
</div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h3 id="railsルーターの目的"><a href="#rails%E3%83%AB%E3%83%BC%E3%82%BF%E3%83%BC%E3%81%AE%E7%9B%AE%E7%9A%84">1 Railsルーターの目的</a></h3>
<p>Railsのルーターは受け取ったURLを認識し、適切なコントローラ内アクションに割り当てます。ルーターは、ビューでこれらのパスやURLを直接ハードコードすることを避けるためにパスやURLを生成することもできます。</p>
<h4 id="urlを実際のコードに割り振る"><a href="#url%E3%82%92%E5%AE%9F%E9%9A%9B%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AB%E5%89%B2%E3%82%8A%E6%8C%AF%E3%82%8B">1.1 URLを実際のコードに割り振る</a></h4>
<p>Railsアプリケーションが以下のHTTPリクエストを受け取ったとします。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
GET /patients/17

</pre>
</div>
<p>このリクエストは、特定のコントローラ内アクションにマッチさせるようルーターに要求しています。最初にマッチしたのが以下のルーティングだとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get '/patients/:id', to: 'patients#show'

</pre>
</div>
<p>このリクエストは<code>patients</code>コントローラの<code>show</code>アクションに割り当てられ、<code>params</code>には<code>{ id: '17' }</code>ハッシュが含まれています。</p>
<h4 id="コードからパスやurlを生成する"><a href="#%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8B%E3%82%89%E3%83%91%E3%82%B9%E3%82%84url%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B">1.2 コードからパスやURLを生成する</a></h4>
<p>パスやURLを生成することもできます。たとえば、上のルーティングが以下のように変更されたとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get '/patients/:id', to: 'patients#show', as: 'patient'

</pre>
</div>
<p>そして、アプリケーションのコントローラに以下のコードがあるとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@patient = Patient.find(17)

</pre>
</div>
<p>上記に対応するビューは以下です。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= link_to 'Patient Record', patient_path(@patient) %&gt;

</pre>
</div>
<p>これで、ルーターによって<code>/patients/17</code>というパスが生成されます。これを利用することでビューが改修しやすくなり、コードも読みやすくなります。このルーティングヘルパーではidを指定する必要がない点にご注目ください。</p>
<h3 id="リソースベースのルーティング:-railsのデフォルト"><a href="#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0:-rails%E3%81%AE%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88">2 リソースベースのルーティング: Railsのデフォルト</a></h3>
<p>リソースベースのルーティング (以下リソースルーティング) を使用することで、リソースベースで構成されたコントローラに対応する共通のルーティングを手軽に宣言できます。リソースフルなルーティングを宣言することで、コントローラの<code>index</code>、<code>show</code>、<code>new</code>、<code>edit</code>、<code>create</code>、<code>update</code>、<code>destroy</code>アクションを個別に宣言しなくても1行で宣言が完了します。</p>
<h4 id="web上のリソース"><a href="#web%E4%B8%8A%E3%81%AE%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9">2.1 Web上のリソース</a></h4>
<p>ブラウザはRailsに対してリクエストを送信する際に、特定のHTTPメソッド (<code>GET</code>、<code>POST</code>、<code>PATCH</code>、<code>PUT</code>、<code>DELETE</code>など) を使用して、URLに対するリクエストを作成します。上に述べたHTTPメソッドは、いずれもリソースに対して特定の操作の実行を指示するリクエストです。リソースルーティングでは、関連するさまざまなリクエストを1つのコントローラ内のアクションに割り当てます。</p>
<p>Railsアプリケーションが以下のHTTPリクエストを受け取ったとします。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
DELETE /photos/17

</pre>
</div>
<p>このリクエストは、特定のコントローラ内アクションにマッピングさせるようルーターに要求しています。最初にマッチしたのが以下のルーティングだとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos

</pre>
</div>
<p>Railsはこのリクエストを<code>photos</code>コントローラ内の<code>destroy</code>コントローラに割り当て、<code>params</code>ハッシュに<code>{ id: '17' }</code>を含めます。</p>
<h4 id="crud、動詞、アクション"><a href="#crud%E3%80%81%E5%8B%95%E8%A9%9E%E3%80%81%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3">2.2 CRUD、動詞、アクション</a></h4>
<p>Railsのリソースフルルーティングでは、(GET、PUTなどの) 各種HTTP動詞 (verb) と、コントローラ内アクションを指すURLが対応付けられます。1つのアクションは、データベース上での特定のCRUD (Create/Read/Update/Delete) 操作に対応付けられるルールになっています。たとえば、以下のようなルーティングが1つあるとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos

</pre>
</div>
<p>上の記述により、アプリケーション内に以下の7つのルーティングが作成され、いずれも<code>Photos</code>コントローラに対応付けられます。</p>
<table>
<thead>
<tr>
<th>HTTP動詞</th>
<th>パス</th>
<th>コントローラ#アクション</th>
<th>目的</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/photos</td>
<td>photos#index</td>
<td>すべての写真の一覧を表示</td>
</tr>
<tr>
<td>GET</td>
<td>/photos/new</td>
<td>photos#new</td>
<td>写真を1つ作成するためのHTMLフォームを返す</td>
</tr>
<tr>
<td>POST</td>
<td>/photos</td>
<td>photos#create</td>
<td>写真を1つ作成する</td>
</tr>
<tr>
<td>GET</td>
<td>/photos/:id</td>
<td>photos#show</td>
<td>特定の写真を表示する</td>
</tr>
<tr>
<td>GET</td>
<td>/photos/:id/edit</td>
<td>photos#edit</td>
<td>写真編集用のHTMLフォームを1つ返す</td>
</tr>
<tr>
<td>PATCH/PUT</td>
<td>/photos/:id</td>
<td>photos#update</td>
<td>特定の写真を更新する</td>
</tr>
<tr>
<td>DELETE</td>
<td>/photos/:id</td>
<td>photos#destroy</td>
<td>特定の写真を削除する</td>
</tr>
</tbody>
</table>
<div class="note"><p>Railsのルーターでは、サーバーへのリクエストをマッチさせる際にHTTP動詞とURLを使用しているため、4種類のURL (GET/POST/PATCH/DELETE) が7種類の異なるアクション (index/new/create/show/edit/update/destroy) に割り当てられています。</p></div>
<div class="note"><p>Railsのルーティングは、ルーティングファイルの「上からの記載順に」マッチします。このため、たとえば<code>resources :photos</code>というルーティングが<code>get 'photos/poll'</code>よりも前の行にあれば、<code>resources</code>行の<code>show</code>アクションが<code>get</code>行の記述よりも優先されますので、<code>get</code>行のルーティングは有効になりません。これを修正するには、<code>get</code>行を<code>resorces</code>行 <strong>よりも上</strong> の行に移動してください。これにより、<code>get</code>行がマッチするようになります。</p></div>
<h4 id="パスとurl用ヘルパー"><a href="#%E3%83%91%E3%82%B9%E3%81%A8url%E7%94%A8%E3%83%98%E3%83%AB%E3%83%91%E3%83%BC">2.3 パスとURL用ヘルパー</a></h4>
<p>リソースフルなルーティングを作成すると、アプリケーションのコントローラで多くのヘルパーが利用できるようになります。<code>resources :photos</code>というルーティングを例に取ってみましょう。</p>
<ul>
<li>
<code>photos_path</code>は<code>/photos</code>を返します</li>
<li>
<code>new_photo_path</code>は<code>/photos/new</code>を返します</li>
<li>
<code>edit_photo_path(:id)</code>は<code>/photos/:id/edit</code>を返します (<code>edit_photo_path(10)</code>であれば<code>/photos/10/edit</code>が返されます)</li>
<li>
<code>photo_path(:id)</code>は<code>/photos/:id</code>を返します。 (<code>photo_path(10)</code>であれば<code>/photos/10</code>が返されます)</li>
</ul>
<p>これらの_pathヘルパーには、それぞれに対応する<code>_url</code>ヘルパー (<code>photos_url</code>など) があります。_urlヘルパーは、_pathの前に現在のホスト名、ポート番号、パスのプレフィックスが追加されている点が異なります。</p>
<h4 id="複数のリソースを同時に定義する"><a href="#%E8%A4%87%E6%95%B0%E3%81%AE%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E5%90%8C%E6%99%82%E3%81%AB%E5%AE%9A%E7%BE%A9%E3%81%99%E3%82%8B">2.4 複数のリソースを同時に定義する</a></h4>
<p>リソースをいくつも定義しなければならない場合は、以下のような略記法で一度に定義することでタイプ量を節約できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos, :books, :videos

</pre>
</div>
<p>上の記法は以下と完全に同一です。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos
resources :books
resources :videos

</pre>
</div>
<h4 id="単数形リソース"><a href="#%E5%8D%98%E6%95%B0%E5%BD%A2%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9">2.5 単数形リソース</a></h4>
<p>場合によっては、ユーザーがページを表示する時にidを参照することのないリソースが使用されることがあります。たとえば、<code>/profile</code>では常に「現在ログインしているユーザー自身」のプロファイルを表示し、他のユーザーidを参照する必要がないとします。このような場合には、単数形リソース (singular resource) を使用して<code>show</code>アクションに (<code>/profile/:id</code>ではなく) <code>/profile</code>を割り当てることができます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get 'profile', to: 'users#show'

</pre>
</div>
<p><code>get</code>の引数に<code>文字列</code>を渡す場合は<code>コントローラ#アクション</code>形式であることが前提ですが、<code>get</code>の引数に<code>シンボル</code>を渡すとアクションに直接割り当てられます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get 'profile', to: :show

</pre>
</div>
<p>上をリソースフルなルーティングで記述すると以下のようになります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resource :geocoder

</pre>
</div>
<p>上のルーティングでは以下の6つのルーティングが作成され、すべて<code>Geocoders</code>コントローラに割り当てられます。</p>
<table>
<thead>
<tr>
<th>HTTP動詞</th>
<th>パス</th>
<th>コントローラ#アクション</th>
<th>目的</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/geocoder/new</td>
<td>geocoders#new</td>
<td>geocoder作成用のHTMLフォームを返す</td>
</tr>
<tr>
<td>POST</td>
<td>/geocoder</td>
<td>geocoders#create</td>
<td>geocoderを作成する</td>
</tr>
<tr>
<td>GET</td>
<td>/geocoder</td>
<td>geocoders#show</td>
<td>1つしかないgeocoderリソースを表示する</td>
</tr>
<tr>
<td>GET</td>
<td>/geocoder/edit</td>
<td>geocoders#edit</td>
<td>geocoder編集用のHTMLフォームを返す</td>
</tr>
<tr>
<td>PATCH/PUT</td>
<td>/geocoder</td>
<td>geocoders#update</td>
<td>1つしかないgeocoderリソースを更新する</td>
</tr>
<tr>
<td>DELETE</td>
<td>/geocoder</td>
<td>geocoders#destroy</td>
<td>geocoderリソースを削除する</td>
</tr>
</tbody>
</table>
<div class="note"><p>単数形リソースは複数形のコントローラに割り当てられます。これは、同じコントローラで単数形のルーティング (<code>/account</code>) と複数形のルーティング (<code>/accounts/45</code>) を両方使いたい場合を想定しているためです。従って、<code>resource :photo</code>と<code>resources :photos</code>のどちらも、単数形ルーティングと複数形ルーティングを両方作成し、同一のコントローラ (<code>PhotosController</code>) に割り当てられます。</p></div>
<p>単数形のリソースフルなルーティングを使用すると、以下のヘルパーメソッドが生成されます。</p>
<ul>
<li>
<code>new_geocoder_path</code>は<code>/geocoder/new</code>を返します</li>
<li>
<code>edit_geocoder_path</code>は<code>/geocoder/edit</code>を返します</li>
<li>
<code>geocoder_path</code>は<code>/geocoder</code>を返します。</li>
</ul>
<p>複数形リソースの場合と同様に、単数形リソースでも_pathヘルパーに対応する<code>_url</code>ヘルパーが使用できます。_urlヘルパーは、_pathの前に現在のホスト名、ポート番号、パスのプレフィックスが追加されている点が異なります。</p>
<div class="warning"><p>ある<a href="https://github.com/rails/rails/issues/1769">長年の未解決バグ</a> が原因で、<code>form_for</code>では単数形リソースを自動的に扱えません。これを解決するには、以下のようにフォームのurlを直接指定します。</p></div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
form_for @geocoder, url: geocoder_path do |f|

</pre>
</div>
<h4 id="コントローラの名前空間とルーティング"><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%81%AE%E5%90%8D%E5%89%8D%E7%A9%BA%E9%96%93%E3%81%A8%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">2.6 コントローラの名前空間とルーティング</a></h4>
<p>コントローラを名前空間によってグループ化することもできます。最もよく使用される名前空間といえば、多数の管理用コントローラ群をまとめる<code>Admin::</code>名前空間でしょう。これらのコントローラを<code>app/controllers/admin</code>ディレクトリに配置し、ルーティングでこれらをグループ化できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
namespace :admin do
  resources :posts, :comments
end

</pre>
</div>
<p>上のルーティングにより、<code>posts</code>コントローラや<code>comments</code>コントローラへのルーティングが多数生成されます。たとえば、<code>Admin::PostsController</code>向けに作成されるルーティングは以下のとおりです。</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>パス</th>
<th>コントローラ#アクション</th>
<th>名前付きヘルパー</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/admin/posts</td>
<td>admin/posts#index</td>
<td>admin_posts_path</td>
</tr>
<tr>
<td>GET</td>
<td>/admin/posts/new</td>
<td>admin/posts#new</td>
<td>new_admin_post_path</td>
</tr>
<tr>
<td>POST</td>
<td>/admin/posts</td>
<td>admin/posts#create</td>
<td>admin_posts_path</td>
</tr>
<tr>
<td>GET</td>
<td>/admin/posts/:id</td>
<td>admin/posts#show</td>
<td>admin_post_path(:id)</td>
</tr>
<tr>
<td>GET</td>
<td>/admin/posts/:id/edit</td>
<td>admin/posts#edit</td>
<td>edit_admin_post_path(:id)</td>
</tr>
<tr>
<td>PATCH/PUT</td>
<td>/admin/posts/:id</td>
<td>admin/posts#update</td>
<td>admin_post_path(:id)</td>
</tr>
<tr>
<td>DELETE</td>
<td>/admin/posts/:id</td>
<td>admin/posts#destroy</td>
<td>admin_post_path(:id)</td>
</tr>
</tbody>
</table>
<p>例外的に、(<code>/admin</code>が前についていない) <code>/posts</code>を<code>Admin::PostsController</code>にルーティングしたい場合は、以下のようにすることもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
scope module: 'admin' do
  resources :posts, :comments
end

</pre>
</div>
<p>以下のようにブロックを使用しない記述も可能です。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :posts, module: 'admin'

</pre>
</div>
<p>逆に、<code>/admin/posts</code>を (<code>Admin::</code>なしの) <code>PostsController</code>にルーティングしたい場合は、以下のようにします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
scope '/admin' do
  resources :posts, :comments
end

</pre>
</div>
<p>以下のようにブロックを使用しない記述も可能です。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :posts, path: '/admin/posts'

</pre>
</div>
<p>いずれの場合も、名前付きルート (named route)は、<code>scope</code>を使用しなかった場合と同じであることにご注目ください。最後の例の場合は、以下のパスが<code>PostsController</code>に割り当てられます。</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>パス</th>
<th>コントローラ#アクション</th>
<th>名前付きヘルパー</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/admin/posts</td>
<td>posts#index</td>
<td>posts_path</td>
</tr>
<tr>
<td>GET</td>
<td>/admin/posts/new</td>
<td>posts#new</td>
<td>new_post_path</td>
</tr>
<tr>
<td>POST</td>
<td>/admin/posts</td>
<td>posts#create</td>
<td>posts_path</td>
</tr>
<tr>
<td>GET</td>
<td>/admin/posts/:id</td>
<td>posts#show</td>
<td>post_path(:id)</td>
</tr>
<tr>
<td>GET</td>
<td>/admin/posts/:id/edit</td>
<td>posts#edit</td>
<td>edit_post_path(:id)</td>
</tr>
<tr>
<td>PATCH/PUT</td>
<td>/admin/posts/:id</td>
<td>posts#update</td>
<td>post_path(:id)</td>
</tr>
<tr>
<td>DELETE</td>
<td>/admin/posts/:id</td>
<td>posts#destroy</td>
<td>post_path(:id)</td>
</tr>
</tbody>
</table>
<div class="info"><p><em><code>namespace</code>ブロックの内部で異なるコントローラ名前空間を使用したいのであれば、「<code>get '/foo' =&gt; '/foo#index'</code>」のような絶対コントローラパスを指定することもできます。</em></p></div>
<h4 id="ネストしたリソース"><a href="#%E3%83%8D%E3%82%B9%E3%83%88%E3%81%97%E3%81%9F%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9">2.7 ネストしたリソース</a></h4>
<p>論理上、他のリソースの配下に子リソースを配置することはよくあります。たとえば、Railsアプリケーションに以下のモデルがあるとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Magazine &lt; ActiveRecord::Base
  has_many :ads
end

class Ad &lt; ActiveRecord::Base
  belongs_to :magazine
end

</pre>
</div>
<p>ルーティングをネストする (入れ子にする) ことで、この親子関係をルーティングで表すことができるようになります。上の例の場合、以下のようにルーティングを宣言することができます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :magazines do
  resources :ads
end

</pre>
</div>
<p>上のルーティングによって、雑誌 (magazine) へのルーティングに加えて、広告 (ad) を<code>AdsController</code>にルーティングすることもできるようになりました。adへのURLにはmagazineもなければなりません。</p>
<table>
<thead>
<tr>
<th>HTTP動詞</th>
<th>パス</th>
<th>コントローラ#アクション</th>
<th>目的</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/magazines/:magazine_id/ads</td>
<td>ads#index</td>
<td>ある雑誌1冊に含まれる広告をすべて表示する</td>
</tr>
<tr>
<td>GET</td>
<td>/magazines/:magazine_id/ads/new</td>
<td>ads#new</td>
<td>ある1冊の雑誌用の広告を1つ作成するHTMLフォームを返す</td>
</tr>
<tr>
<td>POST</td>
<td>/magazines/:magazine_id/ads</td>
<td>ads#create</td>
<td>ある1冊の雑誌用の広告を1つ作成する</td>
</tr>
<tr>
<td>GET</td>
<td>/magazines/:magazine_id/ads/:id</td>
<td>ads#show</td>
<td>ある雑誌1冊に含まれる広告を1つ表示する</td>
</tr>
<tr>
<td>GET</td>
<td>/magazines/:magazine_id/ads/:id/edit</td>
<td>ads#edit</td>
<td>ある雑誌1冊に含まれる広告1つを編集するHTMLフォームを返す</td>
</tr>
<tr>
<td>PATCH/PUT</td>
<td>/magazines/:magazine_id/ads/:id</td>
<td>ads#update</td>
<td>ある雑誌1冊に含まれる広告を1つ更新する</td>
</tr>
<tr>
<td>DELETE</td>
<td>/magazines/:magazine_id/ads/:id</td>
<td>ads#destroy</td>
<td>ある雑誌1冊に含まれる広告を1つ削除する</td>
</tr>
</tbody>
</table>
<p>ルーティングを作成すると、ルーティングヘルパーも作成されます。ヘルパーは<code>magazine_ads_url</code>や<code>edit_magazine_ad_path</code>のような名前になります。これらのヘルパーは、最初のパラメータとしてMagazineモデルのインスタンスを1つ取ります (<code>magazine_ads_url(@magazine)</code>)。</p>
<h5 id="ネスティング回数の限界"><a href="#%E3%83%8D%E3%82%B9%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E5%9B%9E%E6%95%B0%E3%81%AE%E9%99%90%E7%95%8C">2.7.1 ネスティング回数の限界</a></h5>
<p>ネストしたリソースの中でさらに別のリソースをネストすることは可能です。例：</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :publishers do
  resources :magazines do
    resources :photos
  end
end

</pre>
</div>
<p>すぐ想像が付くと思いますが、ネストが深くなるとたちまち扱いが厄介になります。たとえば、上のルーティングはアプリケーションで以下のようなパスとして認識されます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
/publishers/1/magazines/2/photos/3

</pre>
</div>
<p>このURLに対応するルーティングヘルパーは<code>publisher_magazine_photo_url</code>となります。このヘルパーを使用するには毎回3つの階層すべてでオブジェクトを指定する必要があります。ネスティングが深くなることでルーティングの扱いが困難になる問題については、Jamis Buckの有名な <a href="http://weblog.jamisbuck.org/2007/2/5/nesting-resources">記事</a> を参照してください。JamisはRailsアプリケーション設計上のよい経験則を提案しています。</p>
<div class="info"><p><em>リソースのネスティングは、ぜひとも1回にとどめて下さい。決して2回以上ネストするべきではありません。</em></p></div>
<h5 id="「浅い」ネスト"><a href="#%E3%80%8C%E6%B5%85%E3%81%84%E3%80%8D%E3%83%8D%E3%82%B9%E3%83%88">2.7.2 「浅い」ネスト</a></h5>
<p>前述したような深いネストを避けるひとつの方法として、コレクション (index/new/createのような、idを持たないアクション) だけを親のスコープの下で生成するという手法があります。このとき、メンバー (show/edit/update/destroyのような、idを必要とするアクション) をネストに含めないのがポイントです。これによりコレクションだけが階層化のメリットを受けられます。つまり、以下のように最小限の情報でリソースを一意に指定できるルーティングを作成するということです。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :posts do
  resources :comments, only: [:index, :new, :create]
end
resources :comments, only: [:show, :edit, :update, :destroy]

</pre>
</div>
<p>この方法は、ルーティングの記述を複雑にせず、かつ深いネストを作らないという絶妙なバランスを保っています。<code>:shallow</code>オプションを使用することで、上と同じ内容をさらに簡単に記述できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :posts do
  resources :comments, shallow: true
end

</pre>
</div>
<p>これによって生成されるルーティングは、最初の例と完全に同じです。親リソースで<code>:shallow</code>オプションを指定すると、すべてのネストしたリソースが浅くなります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :posts, shallow: true do
  resources :comments
  resources :quotes
  resources :drafts
end

</pre>
</div>
<p>DSL (ドメイン固有言語) である<code>shallow</code>メソッドをルーティングで使用すると、すべてのネストが浅くなるように内側にスコープを1つ作成します。これによって生成されるルーティングは、最初の例と完全に同じです。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
shallow do
  resources :posts do
    resources :comments
    resources :quotes
    resources :drafts
  end
end

</pre>
</div>
<p><code>scope</code>メソッドには、「浅い」ルーティングをカスタマイズするためのオプションが2つあります。<code>:shallow_path</code>オプションは、指定されたパラメータをメンバーのパスの冒頭にだけ追加します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
scope shallow_path: "sekret" do
  resources :posts do
    resources :comments, shallow: true
  end
end

</pre>
</div>
<p>上の場合、commentsリソースのルーティングは以下のようになります。</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>パス</th>
<th>コントローラ#アクション</th>
<th>名前付きヘルパー</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/posts/:post_id/comments(.:format)</td>
<td>comments#index</td>
<td>post_comments_path</td>
</tr>
<tr>
<td>POST</td>
<td>/posts/:post_id/comments(.:format)</td>
<td>comments#create</td>
<td>post_comments_path</td>
</tr>
<tr>
<td>GET</td>
<td>/posts/:post_id/comments/new(.:format)</td>
<td>comments#new</td>
<td>new_post_comment_path</td>
</tr>
<tr>
<td>GET</td>
<td>/sekret/comments/:id/edit(.:format)</td>
<td>comments#edit</td>
<td>edit_comment_path</td>
</tr>
<tr>
<td>GET</td>
<td>/sekret/comments/:id(.:format)</td>
<td>comments#show</td>
<td>comment_path</td>
</tr>
<tr>
<td>PATCH/PUT</td>
<td>/sekret/comments/:id(.:format)</td>
<td>comments#update</td>
<td>comment_path</td>
</tr>
<tr>
<td>DELETE</td>
<td>/sekret/comments/:id(.:format)</td>
<td>comments#destroy</td>
<td>comment_path</td>
</tr>
</tbody>
</table>
<p><code>:shallow_prefix</code>オプションを使用すると、指定されたパラメータを (パスではなく) 名前付きヘルパー名の冒頭に追加します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
scope shallow_prefix: "sekret" do
  resources :posts do
    resources :comments, shallow: true
  end
end

</pre>
</div>
<p>上の場合、commentsリソースのルーティングは以下のようになります。</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>パス</th>
<th>コントローラ#アクション</th>
<th>名前付きヘルパー</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/posts/:post_id/comments(.:format)</td>
<td>comments#index</td>
<td>post_comments_path</td>
</tr>
<tr>
<td>POST</td>
<td>/posts/:post_id/comments(.:format)</td>
<td>comments#create</td>
<td>post_comments_path</td>
</tr>
<tr>
<td>GET</td>
<td>/posts/:post_id/comments/new(.:format)</td>
<td>comments#new</td>
<td>new_post_comment_path</td>
</tr>
<tr>
<td>GET</td>
<td>/comments/:id/edit(.:format)</td>
<td>comments#edit</td>
<td>edit_sekret_comment_path</td>
</tr>
<tr>
<td>GET</td>
<td>/comments/:id(.:format)</td>
<td>comments#show</td>
<td>sekret_comment_path</td>
</tr>
<tr>
<td>PATCH/PUT</td>
<td>/comments/:id(.:format)</td>
<td>comments#update</td>
<td>sekret_comment_path</td>
</tr>
<tr>
<td>DELETE</td>
<td>/comments/:id(.:format)</td>
<td>comments#destroy</td>
<td>sekret_comment_path</td>
</tr>
</tbody>
</table>
<h4 id="ルーティングの「concern」機能"><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E3%80%8Cconcern%E3%80%8D%E6%A9%9F%E8%83%BD">2.8 ルーティングの「concern」機能</a></h4>
<p>concernを使用することで、他のリソースやルーティング内で使いまわすことのできる共通のルーティングを宣言することができます。concernは以下のように定義します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
concern :commentable do
  resources :comments
end

concern :image_attachable do
  resources :images, only: :index
end

</pre>
</div>
<p>concernを利用すると、同じようなルーティングを繰り返し記述せずに済み、複数のルーティング間で同じ動作を共有できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :messages, concerns: :commentable

resources :posts, concerns: [:commentable, :image_attachable]

</pre>
</div>
<p>上のコードは以下と同等です。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :messages do
  resources :comments
end

resources :posts do
  resources :comments
  resources :images, only: :index
end

</pre>
</div>
<p>concernはルーティング内のどのような場所にでも配置することができます。スコープや名前空間呼び出しでの使用法は以下のとおりです。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
namespace :posts do
  concerns :commentable
end

</pre>
</div>
<h4 id="オブジェクトからパスとurlを作成する"><a href="#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%8B%E3%82%89%E3%83%91%E3%82%B9%E3%81%A8url%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B">2.9 オブジェクトからパスとURLを作成する</a></h4>
<p>ルーティングヘルパーを使用する方法の他に、パラメータの配列からパスやURLを作成することもできます。例として、以下のようなルーティングがあるとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :magazines do
  resources :ads
end

</pre>
</div>
<p><code>magazine_ad_path</code>を使用すると、idを数字で渡す代りに<code>Magazine</code>と<code>Ad</code>のインスタンスを引数として渡すことができます。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= link_to 'Ad details', magazine_ad_path(@magazine, @ad) %&gt;

</pre>
</div>
<p>複数のオブジェクトが集まったセットに対して<code>url_for</code>を使用することもできます。複数のオブジェクトを渡しても、適切なルーティングが自動的に決定されます。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= link_to 'Ad details', url_for([@magazine, @ad]) %&gt;

</pre>
</div>
<p>上の場合、Railsは<code>@magazine</code>が<code>Magazine</code>であり、<code>@ad</code>が<code>Ad</code>であることを認識し、それに基づいて<code>magazine_ad_path</code>ヘルパーを呼び出します。<code>link_to</code>などのヘルパーでも、完全な<code>url_for</code>呼び出しの代りに単にオブジェクトを渡すことができます。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= link_to 'Ad details', [@magazine, @ad] %&gt;

</pre>
</div>
<p>1冊の雑誌にだけリンクしたいのであれば、以下のように書きます。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= link_to 'Magazine details', @magazine %&gt;

</pre>
</div>
<p>それ以外のアクションであれば、配列の最初の要素にアクション名を挿入するだけで済みます。</p>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= link_to 'Edit Ad', [:edit, @magazine, @ad] %&gt;

</pre>
</div>
<p>これにより、モデルのインスタンスをURLとして扱うことができます。これはリソースフルなスタイルを採用する大きなメリットの1つです。</p>
<h4 id="restfulなアクションをさらに追加する"><a href="#restful%E3%81%AA%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E3%81%95%E3%82%89%E3%81%AB%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">2.10 RESTfulなアクションをさらに追加する</a></h4>
<p>デフォルトで作成されるRESTfulなルーティングは7つですが、7つでなければならないということはありません。必要であれば、コレクションやコレクションの各メンバーに対して適用されるリソースを追加することもできます。</p>
<h5 id="メンバールーティングを追加する"><a href="#%E3%83%A1%E3%83%B3%E3%83%90%E3%83%BC%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">2.10.1 メンバールーティングを追加する</a></h5>
<p>メンバー (member) ルーティングを追加したい場合は、<code>member</code>ブロックをリソースブロックに1つ追加します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos do
  member do
    get 'preview'
  end
end

</pre>
</div>
<p>上のルーティングはGETリクエストとそれに伴う<code>/photos/1/preview</code>を認識し、リクエストを<code>Photos</code>コントローラの<code>preview</code>アクションにルーティングし、リソースid値を<code>params[:id]</code>に渡します。同時に、<code>preview_photo_url</code>ヘルパーと<code>preview_photo_path</code>ヘルパーも作成されます。</p>
<p>memberルーティングブロックの内側では、次に述べるHTTP動詞が指定されたルーティング名を認識できます。指定可能な動詞は<code>get</code>、<code>patch</code>、<code>put</code>、<code>post</code>、<code>delete</code>です。<code>member</code>ルーティングが1つだけしかないのであれば、以下のようにルーティングで<code>:on</code>オプションを指定することでブロックを省略できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos do
  get 'preview', on: :member
end

</pre>
</div>
<p><code>:on</code>オプションを省略しても同様のmemberルーティングが生成されます。この場合リソースidの値の取得に<code>params[:id]</code>ではなく<code>params[:photo_id]</code>を使用する点が異なります。</p>
<h5 id="コレクションルーティングを追加する"><a href="#%E3%82%B3%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">2.10.2 コレクションルーティングを追加する</a></h5>
<p>ルーティングにコレクション (collection) を追加するには以下のようにします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos do
  collection do
    get 'search'
  end
end

</pre>
</div>
<p>上のルーティングは、GETリクエスト+<code>/photos/search</code>などの (idを伴わない) パスを認識し、リクエストを<code>Photos</code>コントローラの<code>search</code>アクションにルーティングします。このとき<code>search_photos_url</code>や<code>search_photos_path</code>ルーティングヘルパーも同時に作成されます。</p>
<p>collectionルーティングでもmemberルーティングのときと同様に<code>:on</code>オプションを使用できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos do
  get 'search', on: :collection
end

</pre>
</div>
<h5 id="追加されたnewアクションへのルーティングを追加する"><a href="#%E8%BF%BD%E5%8A%A0%E3%81%95%E3%82%8C%E3%81%9Fnew%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%B8%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">2.10.3 追加されたnewアクションへのルーティングを追加する</a></h5>
<p><code>:on</code>オプションを使用して、たとえば以下のように別のnewアクションを追加できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :comments do
  get 'preview', on: :new
end

</pre>
</div>
<p>上のようにすることで、GET + <code>/comments/new/preview</code>のようなパスが認識され、<code>Comments</code>コントローラの<code>preview</code>アクションにルーティングされます。<code>preview_new_comment_url</code>や<code>preview_new_comment_path</code>ルーティングヘルパーも同時に作成されます。</p>
<div class="info"><p>リソースフルなルーティングにアクションが多数追加されていることに気付いたら、それ以上アクションを追加するのをやめて、そこに別のリソースが隠されているのではないかと疑ってみる方がよいでしょう。</p></div>
<h3 id="リソースフルでないルーティング"><a href="#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%83%95%E3%83%AB%E3%81%A7%E3%81%AA%E3%81%84%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">3 リソースフルでないルーティング</a></h3>
<p>Railsではリソースルーティングを行なう他に、任意のURLをアクションにルーティングすることもできます。この方式を使用する場合、リソースフルルーティングのような自動的なルーティンググループの生成は行われません。従って、アプリケーションで必要なルーティングを個別に設定することになります。</p>
<p>基本的にはリソースフルルーティングを使用すべきではありますが、このような単純なルーティングの方が適している箇所も多数あるはずです。リソースフルルーティングでは大袈裟過ぎる場合に、アプリケーションを無理にリソースフルなフレームワークに押し込める必要はありません。</p>
<p>シンプルルーティングは、特に従来形式のURLを新しいRailsのアクションに割り当てることがずっと簡単に行えるようになります。</p>
<h4 id="パラメータの割り当て"><a href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AE%E5%89%B2%E3%82%8A%E5%BD%93%E3%81%A6">3.1 パラメータの割り当て</a></h4>
<p>通常のルーティングを設定するのであれば、RailsがルーティングをブラウザからのHTTPリクエストに割り当てるためのシンボルをいくつか渡します。それらのシンボルのうち、<code>:controller</code>と<code>:action</code>は特別です。<code>:controller</code>はアプリケーションのコントローラへの割り当てを行い、<code>:action</code>はそのコントローラの中にあるアクションへの割り当てを行います (訳注: 具体的なコントローラ名とアクション名を指定していない点にご注目ください)。以下のルーティングを例にとってみましょう。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get ':controller(/:action(/:id))'

</pre>
</div>
<p>ブラウザからの<code>/photos/show/1</code>リクエストが上のルーティングで処理される (他のルーティング設定にはマッチしなかったとします) と、<code>Photos</code>コントローラの<code>show</code>アクションが呼び出され、URL末尾のパラメータ<code>"1"</code>へのアクセスは<code>params[:id]</code>で行なえます。<code>:action</code>と<code>:id</code>が必須パラメータではないことがかっこ () で示されているので、このルーティングは<code>/photos</code>を<code>PhotosController#index</code>にルーティングすることもできます。</p>
<h4 id="動的なセグメント"><a href="#%E5%8B%95%E7%9A%84%E3%81%AA%E3%82%BB%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88">3.2 動的なセグメント</a></h4>
<p>通常のルーティングの一部として、文字列を固定しない動的なセグメントを自由に使用できます。<code>:controller</code>や<code>:action</code>を除き、どんなものでも<code>params</code>の一部に含めてアクションに渡すことができます。以下のルーティングを設定したとします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get ':controller/:action/:id/:user_id'

</pre>
</div>
<p>ブラウザからの<code>/photos/show/1/2</code>パスは<code>Photos</code>コントローラの<code>show</code>アクションに割り当てられます。<code>params[:id]</code>には<code>"1"</code>、<code>params[:user_id]</code>には<code>"2"</code>がそれぞれ保存されます。</p>
<div class="note"><p><code>:controller</code>パスセグメントを使用する場合、<code>:namespace</code>や<code>:module</code>を併用することはできません。どうしても使用したいのであれば、以下のように、必要な名前空間だけにマッチするように<code>:controller</code>に制限を加えます。</p></div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get ':controller(/:action(/:id))', controller: /admin\/[^\/]+/

</pre>
</div>
<div class="info"><p>動的なセグメント分割ではドット<code>.</code>をデフォルトでは使用できません。ドットはフォーマット済みルーティングでは区切り文字として使用されるためです。どうしても動的セグメント内でドットを使用したい場合は、デフォルト設定を上書きする制限を与えます。たとえば<code>id: /[^\/]+/</code>とすると、スラッシュ以外のすべての文字が使用できます。</p></div>
<h4 id="静的なセグメント"><a href="#%E9%9D%99%E7%9A%84%E3%81%AA%E3%82%BB%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88">3.3 静的なセグメント</a></h4>
<p>ルート作成時にコロンを付けなかった部分は、静的なセグメントとして固定文字列が指定されます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get ':controller/:action/:id/with_user/:user_id'

</pre>
</div>
<p>上のルーティングは、<code>/photos/show/1/with_user/2</code>のようなパスにマッチします。<code>with_user</code>の部分は固定されています。このときアクションで使用できる<code>params</code>は <code>{ controller: 'photos', action: 'show', id: '1', user_id: '2' }</code>となります。</p>
<h4 id="クエリ文字列"><a href="#%E3%82%AF%E3%82%A8%E3%83%AA%E6%96%87%E5%AD%97%E5%88%97">3.4 クエリ文字列</a></h4>
<p>クエリ文字列 (訳注: <code>?パラメータ名=値</code>の形式でURLの末尾に置かれるパラメータ) で指定されているパラメータもすべて<code>params</code>に含まれます。以下のルーティングを例にとってみましょう。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get ':controller/:action/:id'

</pre>
</div>
<p>ブラウザからのリクエストで<code>/photos/show/1?user_id=2</code>というパスが渡されると、<code>Photos</code>コントローラの<code>show</code>アクションに割り当てられます。このときの<code>params</code>は<code>{ controller: 'photos', action: 'show', id: '1', user_id: '2' }</code>となります。</p>
<h4 id="デフォルト設定を定義する"><a href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E8%A8%AD%E5%AE%9A%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%99%E3%82%8B">3.5 デフォルト設定を定義する</a></h4>
<p><code>:controller</code>シンボルや<code>:action</code>シンボルは、ルーティング内で明示的に指定する必要はありません。これらは以下のようにデフォルトとして指定することができます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get 'photos/:id', to: 'photos#show'

</pre>
</div>
<p>上のルーティングはブラウザからの<code>/photos/12</code>パスにマッチし、<code>Photos</code>コントローラの<code>show</code>アクションに割り当てられます。</p>
<p><code>:defaults</code>オプションにハッシュを渡すことで、これ以外のデフォルト設定を定義することもできます。この定義は、動的セグメントとして指定していないパラメータに対しても適用されます。例: </p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get 'photos/:id', to: 'photos#show', defaults: { format: 'jpg' }

</pre>
</div>
<p>上のルーティングは<code>photos/12</code>にマッチし、<code>Photos</code>コントローラの<code>show</code>アクションに割り当てられ、<code>params[:format]</code>には<code>"jpg"</code>が設定されます。</p>
<h4 id="名前付きルーティング"><a href="#%E5%90%8D%E5%89%8D%E4%BB%98%E3%81%8D%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">3.6 名前付きルーティング</a></h4>
<p><code>:as</code>オプションを使用することで、どんなルーティングにも名前を指定できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get 'exit', to: 'sessions#destroy', as: :logout

</pre>
</div>
<p>上のルーティングでは<code>logout_path</code>と<code>logout_url</code>がアプリケーションの名前付きヘルパーとして作成されます。<code>logout_path</code>を呼び出すと<code>/exit</code>が返されます。</p>
<p>この方法を使用して、リソースとして定義されているルーティングを以下のように上書きすることもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get ':username', to: 'users#show', as: :user

</pre>
</div>
<p>上のルーティングでは<code>user_path</code>メソッドが生成され、コントローラ・ヘルパー・ビューでそれぞれ使用できるようになります。このメソッドは、<code>/bob</code>のようなユーザー名を持つルーティングに移動します。<code>Users</code>コントローラの<code>show</code>アクションの内部で<code>params[:username]</code>にアクセスすると、ユーザー名を取り出すことができます。パラメータ名を<code>:username</code>にしたくない場合は、ルーティング定義の<code>:username</code>の部分を変更してください。</p>
<h4 id="http動詞を制限する"><a href="#http%E5%8B%95%E8%A9%9E%E3%82%92%E5%88%B6%E9%99%90%E3%81%99%E3%82%8B">3.7 HTTP動詞を制限する</a></h4>
<p>あるルーティングを特定のHTTP動詞に割り当てるために、通常は<code>get</code>、<code>post</code>、<code>put</code>、<code>patch</code>、<code>delete</code>メソッドのいずれかを使用する必要があります。<code>match</code>メソッドと<code>:via</code>オプションを使用することで、複数のHTTP動詞に同時にマッチするルーティングを作成できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
match 'photos', to: 'photos#show', via: [:get, :post]

</pre>
</div>
<p><code>via: :all</code>を指定すると、すべてのHTTP動詞にマッチする特別なルーティングを作成できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
match 'photos', to: 'photos#show', via: :all

</pre>
</div>
<div class="note"><p>1つのアクションに<code>GET</code>リクエストと<code>POST</code>リクエストを両方ルーティングすると、セキュリティに影響する可能性があります。本当に必要な理由がない限り、1つのアクションにすべてのHTTP動詞をルーティングすることは避けてください。</p></div>
<h4 id="セグメントを制限する"><a href="#%E3%82%BB%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E5%88%B6%E9%99%90%E3%81%99%E3%82%8B">3.8 セグメントを制限する</a></h4>
<p><code>:constraints</code>オプションを使用すると、動的セグメントのURLフォーマットを特定の形式に制限することができます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get 'photos/:id', to: 'photos#show', constraints: { id: /[A-Z]\d{5}/ }

</pre>
</div>
<p>上のルーティングは<code>/photos/A12345</code>のようなパスにはマッチしますが、<code>/photos/893</code>にはマッチしません。以下のようにもっと簡潔な方法で記述することもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get 'photos/:id', to: 'photos#show', id: /[A-Z]\d{5}/

</pre>
</div>
<p><code>:constraints</code>では正規表現を使用できますが、ここでは正規表現の「アンカー」は使用できないという制限があることにご注意ください。たとえば、以下のルーティングは無効です。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get '/:id', to: 'posts#show', constraints: {id: /^\d/}

</pre>
</div>
<p>対象となるルーティングはすべて初めからアンカーされているので、このようなアンカー表現を使用する必要はないはずです。</p>
<p>たとえば以下のルーティングでは、ルート (root) 名前空間を共有する際に<code>posts</code>に対して<code>to_param</code>が<code>1-hello-world</code>のように数字で始まる値だけが使用できるようになっており、<code>users</code>に対して<code>to_param</code>が<code>david</code>のように数字で始まらない値だけが使用できるようになっています。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get '/:id', to: 'posts#show', constraints: { id: /\d.+/ }
get '/:username', to: 'users#show'

</pre>
</div>
<h4 id="リクエスト内容に応じて制限を加える"><a href="#%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E5%86%85%E5%AE%B9%E3%81%AB%E5%BF%9C%E3%81%98%E3%81%A6%E5%88%B6%E9%99%90%E3%82%92%E5%8A%A0%E3%81%88%E3%82%8B">3.9 リクエスト内容に応じて制限を加える</a></h4>
<p>また、<code>String</code>を返す<a href="action_controller_overview.html#request%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88">Request</a>オブジェクトの任意のメソッドに基いてルーティングを制限することもできます。</p>
<p>リクエストに応じた制限は、セグメントを制限するときと同様の方法で指定することができます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get 'photos', constraints: {subdomain: 'admin'}

</pre>
</div>
<p>ブロックフォームに対して制限を指定することもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
namespace :admin do
  constraints subdomain: 'admin' do
    resources :photos
  end
end

</pre>
</div>
<div class="note"><p>リクエストベースの制限は、Requestオブジェクトに対してあるメソッドを呼び出すことで実行されます。メソッド呼び出し時にハッシュキーと同じ名前をメソッドに渡し、返された値をハッシュ値と比較します。従って、制限された値は、対応するRequestオブジェクトメソッドが返す型と一致する必要があります。たとえば、<code>constraints: { subdomain: 'api' }</code>という制限は<code>api</code>サブドメインに期待どおりマッチしますが、<code>constraints: { subdomain: :api }</code>のようにシンボルを使用した場合は<code>api</code>サブドメインに一致しません。<code>request.subdomain</code>が返す<code>'api'</code>は文字列型であるためです。</p></div>
<h4 id="高度な制限"><a href="#%E9%AB%98%E5%BA%A6%E3%81%AA%E5%88%B6%E9%99%90">3.10 高度な制限</a></h4>
<p>より高度な制限を使用したい場合、Railsで必要な<code>matches?</code>に応答できるオブジェクトを渡す方法があります。例として、ブラックリストに記載されているすべてのユーザーを<code>BlacklistController</code>にルーティングしたいとします。この場合、以下のように設定します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class BlacklistConstraint
  def initialize
    @ips = Blacklist.retrieve_ips
  end

  def matches?(request)
    @ips.include?(request.remote_ip)
  end
end

Rails.application.routes.draw do
  get '*path', to: 'blacklist#index',
    constraints: BlacklistConstraint.new
end

</pre>
</div>
<p>制限をラムダとして指定することもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Rails.application.routes.draw do
  get '*path', to: 'blacklist#index',
    constraints: lambda { |request| Blacklist.retrieve_ips.include?(request.remote_ip) }
end

</pre>
</div>
<p><code>matches?</code>メソッドおよびラムダはいずれも引数として<code>request</code>オブジェクトを取ります。</p>
<h4 id="ルーティンググロブとワイルドカードセグメント"><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%B0%E3%83%AD%E3%83%96%E3%81%A8%E3%83%AF%E3%82%A4%E3%83%AB%E3%83%89%E3%82%AB%E3%83%BC%E3%83%89%E3%82%BB%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88">3.11 ルーティンググロブとワイルドカードセグメント</a></h4>
<p>ルーティンググロブ (route globbing) とはワイルドカード展開のことであり、ルーティングのある位置から下のすべての部分に特定のパラメータをマッチさせる際に使用します。例: </p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get 'photos/*other', to: 'photos#unknown'

</pre>
</div>
<p>上のルーティングは<code>photos/12</code>や<code>/photos/long/path/to/12</code>にマッチし、<code>params[:other]</code>には<code>"12"</code>や<code>"long/path/to/12"</code>が設定されます。先頭にアスタリスク<code>*</code>が付いている部分を「ワイルドカードセグメント」と呼びます。</p>
<p>ワイルドカードセグメントはルーティングのどの部分でも使用できます。例: </p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get 'books/*section/:title', to: 'books#show'

</pre>
</div>
<p>上は<code>books/some/section/last-words-a-memoir</code>にマッチし、<code>params[:section]</code>には<code>'some/section'</code>が保存され、<code>params[:title]</code>には<code>'last-words-a-memoir'</code>が保存されます。</p>
<p>技術上は、1つのルーティングに2つ以上のワイルドカードセグメントを含めることは可能です。マッチャがセグメントをパラメータに割り当てる方法は直感的です。例: </p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get '*a/foo/*b', to: 'test#index'

</pre>
</div>
<p>上のルーティングは<code>zoo/woo/foo/bar/baz</code>にマッチし、<code>params[:a]</code>には<code>'zoo/woo'</code>が保存され、and <code>params[:b]</code>には<code>'bar/baz'</code>が保存されます。</p>
<div class="note"><p><code>'/foo/bar.json'</code>をリクエストすると<code>params[:pages]</code>には<code>'foo/bar'</code>がJSONリクエストフォーマットで保存されます。Rails 3.0.xの動作に戻したい場合は、以下のように<code>format: false</code>を指定することができます。</p></div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get '*pages', to: 'pages#show', format: false

</pre>
</div>
<div class="note"><p>このセグメントフォーマットを必須にしたい場合は、以下のように<code>format: true</code>を指定します。</p></div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get '*pages', to: 'pages#show', format: true

</pre>
</div>
<h4 id="リダイレクト"><a href="#%E3%83%AA%E3%83%80%E3%82%A4%E3%83%AC%E3%82%AF%E3%83%88">3.12 リダイレクト</a></h4>
<p>ルーティングで<code>redirect</code>を使用すると、あるパスを他のあらゆるパスにリダイレクトできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get '/stories', to: redirect('/posts')

</pre>
</div>
<p>パスにマッチする動的セグメントを再利用してリダイレクトすることもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get '/stories/:name', to: redirect('/posts/%{name}')

</pre>
</div>
<p>リダイレクトにブロックを渡すこともできます。このリダイレクトは、シンボル化されたパスパラメータとrequestオブジェクトを受け取ります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get '/stories/:name', to: redirect {|path_params, req| "/posts/#{path_params[:name].pluralize}" }
get '/stories', to: redirect {|path_params, req| "/posts/#{req.subdomain}" }

</pre>
</div>
<p>ここで行われているリダイレクトは、HTTPステータスで言う「301 "Moved Permanently"」であることにご注意ください。一部のWebブラウザやプロキシサーバーはこの種のリダイレクトをキャッシュすることがあり、その場合リダイレクト前の古いページにはアクセスできなくなります。</p>
<p>どの場合であっても、ホスト (<code>http://www.example.com</code>など) がURLの冒頭で指定されていない場合は、Railsは (以前のリクエストではなく) 現在のリクエストから詳細を取得します。</p>
<h4 id="rackアプリケーションにルーティングする"><a href="#rack%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B">3.13 Rackアプリケーションにルーティングする</a></h4>
<p><code>Post</code>コントローラの<code>index</code>アクションに対応する<code>'posts#index'</code>のような文字列の代りに、任意の<a href="rails_on_rack.html">Rackアプリケーション</a>をマッチャーのエンドポイントとして指定することができます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
match '/application.js', to: Sprockets, via: :all

</pre>
</div>
<p>Railsルーターから見れば、<code>Sprockets</code>が<code>call</code>に応答して<code>[status, headers, body]</code>を返す限り、ルーティング先がRackアプリケーションであるかアクションであるかは区別できません。これは<code>via: :all</code>の適切な利用法です。というのは、適切と考えられるすべてのHTTP動詞をRackアプリケーションで扱えるようにできるからです。</p>
<div class="note"><p>参考までに、<code>'posts#index'</code>は実際には<code>PostsController.action(:index)</code>という形に展開されます。これは正しいRackアプリケーションを返します。</p></div>
<h4 id="rootを使用する"><a href="#root%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">3.14 <code>root</code>を使用する</a></h4>
<p><code>root</code>メソッドを使用することで、Railsがルート<code>'/'</code>とすべき場所を指定できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
root to: 'pages#main'
root 'pages#main' # 上の省略形

</pre>
</div>
<p><code>root</code>ルーティングは、ルーティングファイルの先頭に記述してください。rootは最もよく使用されるルーティングであり、最初にマッチする必要があるからです。</p>
<div class="note"><p><code>root</code>ルーティングがアクションに渡せるのは<code>GET</code>リクエストだけです。</p></div>
<p>名前空間やスコープの内側にrootを置くこともできます。例: </p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
namespace :admin do
  root to: "admin#index"
end

root to: "home#index"

</pre>
</div>
<h4 id="unicode文字列をルーティングで使用する"><a href="#unicode%E6%96%87%E5%AD%97%E5%88%97%E3%82%92%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">3.15 Unicode文字列をルーティングで使用する</a></h4>
<p>Unicode文字列をルーティングで直接使用することもできます。例:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
get 'こんにちは', to: 'welcome#index'

</pre>
</div>
<h3 id="リソースフルルーティングをカスタマイズする"><a href="#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%83%95%E3%83%AB%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA%E3%81%99%E3%82%8B">4 リソースフルルーティングをカスタマイズする</a></h3>
<p>ほとんどの場合、<code>resources :posts</code>のような指定を行ってデフォルトのルーティングやヘルパーを生成することで用は足りますが、もう少しルーティングをカスタマイズしたくなることもあります。Railsでは、リソースフルなヘルパーの一般的などの部分であっても事実上自由にカスタマイズ可能です。</p>
<h4 id="使用するコントローラを指定する"><a href="#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">4.1 使用するコントローラを指定する</a></h4>
<p><code>:controller</code>オプションは、リソースで使用するコントローラを明示的に指定します。例:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos, controller: 'images'

</pre>
</div>
<p>上のルーティングは、<code>/photos</code>で始まるパスを認識しますが、ルーティング先を<code>Images</code>コントローラにします。</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>パス</th>
<th>コントローラ#アクション</th>
<th>名前付きヘルパー</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/photos</td>
<td>images#index</td>
<td>photos_path</td>
</tr>
<tr>
<td>GET</td>
<td>/photos/new</td>
<td>images#new</td>
<td>new_photo_path</td>
</tr>
<tr>
<td>POST</td>
<td>/photos</td>
<td>images#create</td>
<td>photos_path</td>
</tr>
<tr>
<td>GET</td>
<td>/photos/:id</td>
<td>images#show</td>
<td>photo_path(:id)</td>
</tr>
<tr>
<td>GET</td>
<td>/photos/:id/edit</td>
<td>images#edit</td>
<td>edit_photo_path(:id)</td>
</tr>
<tr>
<td>PATCH/PUT</td>
<td>/photos/:id</td>
<td>images#update</td>
<td>photo_path(:id)</td>
</tr>
<tr>
<td>DELETE</td>
<td>/photos/:id</td>
<td>images#destroy</td>
<td>photo_path(:id)</td>
</tr>
</tbody>
</table>
<div class="note"><p>このリソースへのパスを生成するには<code>photos_path</code>や<code>new_photo_path</code>などを使用してください。</p></div>
<p>名前空間内のコントローラは以下のように直接指定することができます。例: </p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :user_permissions, controller: 'admin/user_permissions'

</pre>
</div>
<p>上は<code>Admin::UserPermissions</code>にルーティングされます。</p>
<div class="note"><p>ここでサポートされている記法は、<code>/</code>で区切る「ディレクトリ式」のみです。Rubyの定数表記法 (<code>controller: 'Admin::UserPermissions'</code>など) をコントローラに対して使用すると、ルーティングで問題が生じ、警告が出力される可能性があります。</p></div>
<h4 id="制限を指定する"><a href="#%E5%88%B6%E9%99%90%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">4.2 制限を指定する</a></h4>
<p><code>:constraints</code>オプションを使用すると、暗黙で使用される<code>id</code>に対してフォーマットを指定することができます。例:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos, constraints: {id: /[A-Z][A-Z][0-9]+/}

</pre>
</div>
<p>上の宣言は<code>:id</code>パラメータに制限を加え、指定した正規表現にのみマッチするようにします。従って、上の例では<code>/photos/1</code>のようなパスにはマッチしなくなります。代わって、<code>/photos/RR27</code>のようなパスにマッチするようになります。</p>
<p>ブロックフォームを使用することで、多数のルーティングに対して1つの制限をまとめて与えることもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
constraints(id: /[A-Z][A-Z][0-9]+/) do
  resources :photos
  resources :accounts
end

</pre>
</div>
<div class="note"><p>もちろん、この場合であれば「リソースフルでない」ルーティングに適用可能な、より高度な制限を加えることもできます。</p></div>
<div class="info"><p><code>:id</code>パラメータではドット<code>.</code>をデフォルトでは使用できません。ドットはフォーマット済みルーティングでは区切り文字として使用されるためです。どうしても<code>:id</code>内でドットを使用したい場合は、デフォルト設定を上書きする制限を与えます。たとえば<code>id: /[^\/]+/</code>とすると、スラッシュ以外のすべての文字が使用できます。</p></div>
<h4 id="名前付きヘルパーをオーバーライドする"><a href="#%E5%90%8D%E5%89%8D%E4%BB%98%E3%81%8D%E3%83%98%E3%83%AB%E3%83%91%E3%83%BC%E3%82%92%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%A9%E3%82%A4%E3%83%89%E3%81%99%E3%82%8B">4.3 名前付きヘルパーをオーバーライドする</a></h4>
<p><code>:as</code>オプションを使用すると、名前付きルーティングヘルパーを上書きして異なる名前を使用できます。例: </p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos, as: 'images'

</pre>
</div>
<p>上のルーティングでは、<code>/photos</code>で始まるブラウザからのパスを認識し、このリクエストを<code>Photos</code>コントローラにルーティングしますが、ヘルパーの命名に<code>:as</code>オプションの値が使用されます。</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>パス</th>
<th>コントローラ#アクション</th>
<th>名前付きヘルパー</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/photos</td>
<td>photos#index</td>
<td>images_path</td>
</tr>
<tr>
<td>GET</td>
<td>/photos/new</td>
<td>photos#new</td>
<td>new_image_path</td>
</tr>
<tr>
<td>POST</td>
<td>/photos</td>
<td>photos#create</td>
<td>images_path</td>
</tr>
<tr>
<td>GET</td>
<td>/photos/:id</td>
<td>photos#show</td>
<td>image_path(:id)</td>
</tr>
<tr>
<td>GET</td>
<td>/photos/:id/edit</td>
<td>photos#edit</td>
<td>edit_image_path(:id)</td>
</tr>
<tr>
<td>PATCH/PUT</td>
<td>/photos/:id</td>
<td>photos#update</td>
<td>image_path(:id)</td>
</tr>
<tr>
<td>DELETE</td>
<td>/photos/:id</td>
<td>photos#destroy</td>
<td>image_path(:id)</td>
</tr>
</tbody>
</table>
<h4 id="newセグメントやeditセグメントをオーバーライドする"><a href="#new%E3%82%BB%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88%E3%82%84edit%E3%82%BB%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%A9%E3%82%A4%E3%83%89%E3%81%99%E3%82%8B">4.4 <code>new</code>セグメントや<code>edit</code>セグメントをオーバーライドする</a></h4>
<p><code>:path_names</code>オプションを使用すると、パスに含まれている、自動生成された"new"セグメントや"edit"セグメントをオーバーライドできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos, path_names: { new: 'make', edit: 'change' }

</pre>
</div>
<p>これにより、ルーティングで以下のようなパスが認識できるようになります。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
/photos/make
/photos/1/change

</pre>
</div>
<div class="note"><p>このオプションを指定しても、実際のアクション名が変更されるわけではありません。変更後のパスを使用しても、ルーティング先は依然として<code>new</code>アクションと<code>edit</code>アクションのままです。</p></div>
<div class="info"><p>このオプションによる変更をすべてのルーティングに統一的に適用したくなった場合は、スコープを使用できます。</p></div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
scope path_names: { new: 'make' } do
  # 残りすべてのルーティング
end

</pre>
</div>
<h4 id="名前付きルーティングヘルパーにプレフィックスを追加する"><a href="#%E5%90%8D%E5%89%8D%E4%BB%98%E3%81%8D%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%83%98%E3%83%AB%E3%83%91%E3%83%BC%E3%81%AB%E3%83%97%E3%83%AC%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">4.5 名前付きルーティングヘルパーにプレフィックスを追加する</a></h4>
<p><code>:as</code>オプションを使用することで、Railsがルーティングに対して生成する名前付きルーティングヘルパー名の冒頭に文字を追加できます (プレフィックス)。パススコープを使用するルーティング同士での名前の衝突を避けたい場合に使用してください。例: </p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
scope 'admin' do
  resources :photos, as: 'admin_photos'
end

resources :photos

</pre>
</div>
<p>上のルーティングでは、<code>admin_photos_path</code>や<code>new_admin_photo_path</code>などのルーティングヘルパーが生成されます。</p>
<p>ルーティングヘルパーのグループにプレフィックスを追加するには、以下のように<code>scope</code>メソッドで<code>:as</code>オプションを使用します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
scope 'admin', as: 'admin' do
  resources :photos, :accounts
end

resources :photos, :accounts

</pre>
</div>
<p>上によって、<code>admin_photos_path</code>と<code>admin_accounts_path</code>などのルーティングが生成されます。これらは<code>/admin/photos</code>と<code>/admin/accounts</code>にそれぞれ割り当てられます。</p>
<div class="note"><p><code>namespace</code>スコープを使用すると、<code>:module</code>や<code>:path</code>プレフィックスに加えて<code>:as</code>も自動的に追加されます。</p></div>
<p>名前付きパラメータを持つルーティングにプレフィックスを追加することもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
scope ':username' do
  resources :posts
end

</pre>
</div>
<p>上のルーティングにより、<code>/bob/posts/1</code>のような形式のURLを使用できるようになります。さらに、コントローラ、ヘルパー、ビューのいずれにおいても、このパスの<code>username</code>の部分に相当する文字列 (この場合であればbob) を<code>params[:username]</code>で参照できます。</p>
<h4 id="ルーティングの作成を制限する"><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E4%BD%9C%E6%88%90%E3%82%92%E5%88%B6%E9%99%90%E3%81%99%E3%82%8B">4.6 ルーティングの作成を制限する</a></h4>
<p>Railsは、アプリケーション内のすべてのRESTfulルーティングに対してデフォルトで7つのアクション (index、show、new、create、edit、update、destory) へのルーティングを作成します。<code>:only</code>オプションや<code>:except</code>オプションを使用することで、これらのルーティングを微調整できます。<code>:only</code>オプションは、指定されたルーティングだけを生成するよう指示します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos, only: [:index, :show]

</pre>
</div>
<p>これで、<code>/photos</code>への<code>GET</code>リクエストは成功し、<code>/photos</code> への<code>POST</code>リクエスト (通常であれば<code>create</code>アクションにルーティングされます) は失敗します。</p>
<p><code>:except</code>オプションは逆に、指定したルーティングのみを生成 <em>しない</em> よう指示します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :photos, except: :destroy

</pre>
</div>
<p>この場合、<code>destroy</code> (<code>/photos/:id</code>への<code>DELETE</code>リクエスト) を除いて通常のルーティングが生成されます。</p>
<div class="info"><p>アプリケーションでRESTfulルーティングが多数使用されているのであれば、それらに適宜<code>:only</code>や<code>:except</code>を使用して、本当に必要なルーティングのみを生成することで、メモリ使用量の節約とルーティングプロセスの速度向上が見込めます。</p></div>
<h4 id="パスを変更する"><a href="#%E3%83%91%E3%82%B9%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B">4.7 パスを変更する</a></h4>
<p><code>scope</code>メソッドを使用することで、<code>resource</code>によって生成されるデフォルトのパス名を変更できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
scope(path_names: { new: 'neu', edit: 'bearbeiten' }) do
  resources :categories, path: 'kategorien'
end

</pre>
</div>
<p>上のようにすることで、以下のような<code>Categories</code>コントローラへのルーティングが作成されます。</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>パス</th>
<th>コントローラ#アクション</th>
<th>名前付きヘルパー</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/kategorien</td>
<td>categories#index</td>
<td>categories_path</td>
</tr>
<tr>
<td>GET</td>
<td>/kategorien/neu</td>
<td>categories#new</td>
<td>new_category_path</td>
</tr>
<tr>
<td>POST</td>
<td>/kategorien</td>
<td>categories#create</td>
<td>categories_path</td>
</tr>
<tr>
<td>GET</td>
<td>/kategorien/:id</td>
<td>categories#show</td>
<td>category_path(:id)</td>
</tr>
<tr>
<td>GET</td>
<td>/kategorien/:id/bearbeiten</td>
<td>categories#edit</td>
<td>edit_category_path(:id)</td>
</tr>
<tr>
<td>PATCH/PUT</td>
<td>/kategorien/:id</td>
<td>categories#update</td>
<td>category_path(:id)</td>
</tr>
<tr>
<td>DELETE</td>
<td>/kategorien/:id</td>
<td>categories#destroy</td>
<td>category_path(:id)</td>
</tr>
</tbody>
</table>
<h4 id="「単数形のフォーム」をオーバーライドする"><a href="#%E3%80%8C%E5%8D%98%E6%95%B0%E5%BD%A2%E3%81%AE%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%80%8D%E3%82%92%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%A9%E3%82%A4%E3%83%89%E3%81%99%E3%82%8B">4.8 「単数形のフォーム」をオーバーライドする</a></h4>
<p>あるリソースの「単数形のフォーム」を定義したい場合、<code>Inflector</code>に活用形ルールを追加します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
ActiveSupport::Inflector.inflections do |inflect|
  inflect.irregular 'tooth', 'teeth'
end

</pre>
</div>
<h4 id="名前付きリソースで:asを使用する"><a href="#%E5%90%8D%E5%89%8D%E4%BB%98%E3%81%8D%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%A7:as%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">4.9 名前付きリソースで<code>:as</code>を使用する</a></h4>
<p><code>:as</code>を使用すると、ネストしたルーティングヘルパー内のリソース用に自動生成された名前をオーバーライドできます。例:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :magazines do
  resources :ads, as: 'periodical_ads'
end

</pre>
</div>
<p>上のルーティングによって、<code>magazine_periodical_ads_url</code>や<code>edit_magazine_periodical_ad_path</code>などのルーティングヘルパーが生成されます。</p>
<h3 id="ルーティングの調査とテスト"><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E8%AA%BF%E6%9F%BB%E3%81%A8%E3%83%86%E3%82%B9%E3%83%88">5 ルーティングの調査とテスト</a></h3>
<p>Railsには、ルーティングを調べる機能とテストする機能が備わっています。</p>
<h4 id="既存のルールを一覧表示する"><a href="#%E6%97%A2%E5%AD%98%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%AB%E3%82%92%E4%B8%80%E8%A6%A7%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B">5.1 既存のルールを一覧表示する</a></h4>
<p>現在のアプリケーションで利用可能なルーティングをすべて表示するには、サーバーが <strong>development</strong> 環境で動作している状態で<code>http://localhost:3000/rails/info/routes</code>をブラウザで開きます。ターミナルで<code>rake routes</code>コマンドを実行しても同じ結果を得られます。</p>
<p>どちらの方法を使用した場合でも、<code>routes.rb</code>ファイルに記載された順にルーティングが表示されます。1つのルーティングについて以下の情報が表示されます。</p>
<ul>
<li>ルーティング名 (あれば)</li>
<li>使用されているHTTP動詞 (そのルーティングがすべてのHTTP動詞に応答するのでない場合)</li>
<li>マッチするURLパターン</li>
<li>そのルーティングで使用するパラメータ</li>
</ul>
<p>以下は、あるRESTfulルーティングに対して<code>rake routes</code>を実行した結果から抜粋したものです。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
    users GET    /users(.:format)          users#index
          POST   /users(.:format)          users#create
new_user GET    /users/new(.:format)      users#new
edit_user GET    /users/:id/edit(.:format) users#edit

</pre>
</div>
<p><code>CONTROLLER</code>環境変数を設定することで、ルーティング一覧の表示を特定のコントローラにマップされたものに制限することもできます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
$ CONTROLLER=users rake routes

</pre>
</div>
<div class="info"><p>折り返しが発生しないぐらいに十分大きなサイズのターミナルを使用できるのであれば、<code>rake routes</code>コマンドの出力の方がおそらく読みやすいでしょう。</p></div>
<h4 id="ルーティングをテストする"><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E3%83%86%E3%82%B9%E3%83%88%E3%81%99%E3%82%8B">5.2 ルーティングをテストする</a></h4>
<p>アプリケーションの他の部分と同様、ルーティング部分もテスティング戦略に含めておくべきでしょう。Railsでは、テスティングを容易にするために3つの<a href="http://api.rubyonrails.org/classes/ActionDispatch/Assertions/RoutingAssertions.html">ビルトインアサーション</a> が用意されています。</p>
<ul>
<li><code>assert_generates</code></li>
<li><code>assert_recognizes</code></li>
<li><code>assert_routing</code></li>
</ul>
<h5 id="assert_generatesアサーション"><a href="#assert_generates%E3%82%A2%E3%82%B5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3">5.2.1 <code>assert_generates</code>アサーション</a></h5>
<p><code>assert_generates</code>は、特定のオプションの組み合わせを使用した場合に特定のパスが生成されること、そしてそれらがデフォルトのルーティングでもカスタムルーティングでも使用できることをテストするアサーション (assert, assertion: 主張・検証とも) です。例:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
assert_generates '/photos/1', { controller: 'photos', action: 'show', id: '1' }
assert_generates '/about', controller: 'pages', action: 'about'

</pre>
</div>
<h5 id="assert_recognizesアサーション"><a href="#assert_recognizes%E3%82%A2%E3%82%B5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3">5.2.2 <code>assert_recognizes</code>アサーション</a></h5>
<p><code>assert_recognizes</code>は<code>assert_generates</code>と逆方向のテスティングを行います。与えられたパスが認識可能であること、アプリケーションの特定の場所にルーティングされることをテストするアサーションです。例:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
assert_recognizes({ controller: 'photos', action: 'show', id: '1' }, '/photos/1')

</pre>
</div>
<p>引数で<code>:method</code>を使用してHTTP動詞を指定することもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
assert_recognizes({ controller: 'photos', action: 'create' }, { path: 'photos', method: :post })

</pre>
</div>
<h5 id="assert_routingアサーション"><a href="#assert_routing%E3%82%A2%E3%82%B5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3">5.2.3 <code>assert_routing</code>アサーション</a></h5>
<p><code>assert_routing</code>アサーションは、ルーティングを2つの観点 (与えられたパスによってオプションが生成されること、そのオプションによって元のパスが生成されること) からチェックします。つまり、<code>assert_generates</code>と<code>assert_recognizes</code>の機能を組み合わせたものになります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
assert_routing({ path: 'photos', method: :post }, { controller: 'photos', action: 'create' })

</pre>
</div>
</body></html>

        
        <h3>フィードバックについて</h3>
        <p>
          本ガイドの訳文およびソースコードは、GitHub上の <a href="https://github.com/yasslab/railsguides.jp">yasslab/railsguides.jp</a> で管理・公開されております。
	  本ガイドを読んで、誤字・脱字・誤訳などを見かけましたら、上記リポジトリにてお気軽に <a href="https://github.com/yasslab/railsguides.jp/issues">Issue</a> を出して頂けると大変嬉しいです。また、「Pull Request を送りたい!」という場合には、<a href="ruby_on_rails_guides_guidelines.html">Ruby on Railsガイドのガイドライン</a>と、<a href="https://github.com/yasslab/railsguides.jp#%E7%BF%BB%E8%A8%B3%E3%81%AE%E6%B5%81%E3%82%8C">README</a>に記載されている「翻訳の流れ」をご参考にしてください。
	</p>
	<p>
	  なお、原著レベルでの間違いを見つけましたら、原著へのフィードバック方法 (<a href="http://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">documentation contributions</a>) をご参考にしてください。
        </p>
        <p>
	  本ガイドの品質向上に向けて、皆さまのご協力が得られれば幸いです。よろしくお願い致します。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <ol class="snsb" style="margin-left: 13px">
	<li><a href="http://www.railscp.org/text/" target="_blank"><img src="images/railscp_logo.png" width="150px"/></a></li>
      </ol>
      <ol class="snsb" style="margin-left: 13px">
	<li><iframe src="http://ghbtns.com/github-btn.html?user=yasslab&repo=railsguides.jp&type=watch&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="80" height="20"></iframe></li>
	<li><a href="http://b.hatena.ne.jp/entry/railsguides.jp" class="hatena-bookmark-button" data-hatena-bookmark-title="Ruby on Rails ガイド：体系的に Rails を学ぼう (Rails 4.2 対応)" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script></li>
	<li><div class="fb-like" data-href="http://railsguides.jp/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div></li>
	<li><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://railsguides.jp/" data-text="Ruby on Rails ガイド：体系的に Rails を学ぼう (Rails 4.2 対応)" data-lang="ja" data-hashtags="Railsガイド" width="100">ツイート</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></li>
      </ol>
      <ol class="snsb" style="margin-left: 13px">
	<li>本ガイドは<a href="https://creativecommons.org/licenses/by-sa/4.0/deed.ja">クリエイティブ・コモンズ 表示-継承 4.0 国際</a> (CC BY-SA 4.0) ライセンスに基づいて公開されています。</li>
	<li>「Rails」および「Ruby on Rails」という名称、そして Rails のロゴは、David Heinemeier Hansson による登録商標で、すべての権利を有しています。</li>
      </ol>
    </div>
  </div>
</h5>
  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all();
    $(guidesIndex.bind);
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
    ga('create', 'UA-50163209-4', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
