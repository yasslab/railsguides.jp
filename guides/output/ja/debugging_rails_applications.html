<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport"    content="width=device-width, initial-scale=1"/>
<meta name="description" content="Rails ガイドは、Ruby on Rails Guides に基づいた Rails 4.2 対応のリファレンスガイドです。Rails 開発で生産性を向上する方法や、各部品がどのように連携しているかなどを体系的に理解する上で役に立ちます。" />
<meta name="keywords"    content="Ruby Rails ガイド 体系的 入門 無料" />
<meta name="author"      content="Ruby on Rails Community" />

<meta property="fb:admins"      content="715330868" />
<meta property="og:title"       content="Ruby on Rails ガイド：体系的に Rails を学ぼう"/>
<meta property="og:site_name"   content="Ruby on Rails ガイド：体系的に Rails を学ぼう"/>
<meta property="og:image"       content="http://railsguides.jp/images/cover_for_facebook.png"/>
<meta property="og:url"         content="http://railsguides.jp/" />
<meta property="og:type"        content="article" />
<meta property="og:description" content="Rails ガイドは、Ruby on Rails Guides に基づいた Rails 4.2 対応のリファレンスガイドです。Rails 開発で生産性を向上する方法や、各部品がどのように連携しているかなどを体系的に理解する上で役に立ちます。" />

<meta name="twitter:card"  content="summary" />
<meta name="twitter:site"  content="@RailsGuidesJP" />
<meta name="twitter:title" content="Ruby on Rails ガイド：体系的に Rails を学ぼう" />
<meta name="twitter:description" content="Rails ガイドは、Ruby on Rails Guides に基づいた Rails 4.2 対応のリファレンスガイドです。Rails 開発で生産性を向上する方法や、各部品がどのように連携しているかなどを体系的に理解する上で役に立ちます。" />
<meta name="twitter:image" content="http://railsguides.jp/images/cover_for_twitter.png" />
<meta name="twitter:url"   content="http://railsguides.jp/" />

<title>Rails アプリケーションのデバッグ — Rails ガイド</title>
<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

<link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

<link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body class="guide">
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=614116885378153&version=v2.0";
    fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">関連サイト: </strong>
      <span class="red-button more-info-button">関連URL</span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://guides.rubyonrails.org/">原著 (英語)</a></li>
        <li class="more-info"><a href="https://github.com/yasslab/railsguides.jp">ソースコード (GitHub)</a></li>
        <li class="more-info"><a href="http://railstutorial.jp/">Rails チュートリアル</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="/" title="Return to home page">railsguides.jp</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="/">ホーム</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">ガイド目次</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>はじめに</dt>
                <dd><a href="getting_started.html">Rails をはじめよう</a></dd>
                <dt>モデル</dt>
                <dd><a href="active_record_basics.html">Active Record の基礎</a></dd>
                <dd><a href="active_record_migrations.html">Active Record マイグレーション</a></dd>
                <dd><a href="active_record_validations.html">Active Record バリデーション</a></dd>
                <dd><a href="active_record_callbacks.html">Active Record コールバック</a></dd>
                <dd><a href="association_basics.html">Active Record の関連付け</a></dd>
                <dd><a href="active_record_querying.html">Active Record クエリインターフェイス</a></dd>
                <dd><a href="active_model_basics.html">Active Model の基礎</a></dd>
                <dt>ビュー</dt>
                <dd><a href="action_view_overview.html">Action View の概要</a></dd>
                <dd><a href="layouts_and_rendering.html">レイアウトとレンダリング</a></dd>
                <dd><a href="form_helpers.html">Action View フォームヘルパー</a></dd>
                <dt>コントローラ</dt>
                <dd><a href="action_controller_overview.html">Action Controller の概要</a></dd>
                <dd><a href="routing.html">Rails ルーティング</a></dd>
              </dl>
              <dl class="R">
                <dt>高度なトピック</dt>
                <dd><a href="active_support_core_extensions.html">Active Support コア拡張機能</a></dd>
                <dd><a href="i18n.html">Rails 国際化 (i18n) API</a></dd>
                <dd><a href="action_mailer_basics.html">Action Mailer の基礎</a></dd>
                <dd><a href="active_job_basics.html">Active Job の基礎</a></dd>
                <dd><a href="testing.html">Rails テスティングガイド</a></dd>
                <dd><a href="security.html">Rails セキュリティガイド</a></dd>
                <dd><a href="debugging_rails_applications.html">Rails アプリケーションのデバッグ</a></dd>
                <dd><a href="configuring.html">Rails アプリケーションを設定する</a></dd>
                <dd><a href="command_line.html">コマンドラインツールと Rake タスク</a></dd>
                <dd><a href="asset_pipeline.html">アセットパイプライン</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">Rails で JavaScript を使用する</a></dd>
                <dd><a href="engines.html">Rails エンジン入門</a></dd>
                <dd><a href="initialization.html">Rails の初期化プロセス</a></dd>
                <dd><a href="constant_autoloading_and_reloading.html">定数の自動読み込みと再読み込み</a></dd>
                <dt>Rails を拡張する</dt>
                <dd><a href="plugins.html">Rails プラグイン作成入門</a></dd>
                <dd><a href="rails_on_rack.html">Rails と Rack</a></dd>
                <dd><a href="generators.html">Rails ジェネレータとテンプレート入門</a></dd>
                <dt>Ruby on Rails に貢献する</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails [未着手]</a></dd>
                <dd><a href="api_documentation_guidelines.html">APIドキュメント作成ガイドライン</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">Rails ガイドのガイドライン</a></dd>
                <dt>メンテナンスポリシー</dt>
                <dd><a href="maintenance_policy.html">メンテナンスポリシー</a></dd>
                <dt>リリースノート</dt>
                <dd><a href="upgrading_ruby_on_rails.html">Rails アップグレードガイド</a></dd>
                <dd><a href="4_2_release_notes.html">Ruby on Rails 4.2 リリースノート</a></dd>
                <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1 リリースノート</a></dd>
                <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0 リリースノート</a></dd>
                <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes [未着手]</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes [未着手]</a></dd>
                <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes [未着手]</a></dd>
                <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes [未着手]</a></dd>
                <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes [未着手]</a></dd>
              </dl>
          </div>
        </li>
        <li><a class="nav-item" href="https://github.com/yasslab/railsguides.jp#readme">翻訳に貢献する</a></li>
        <li><a class="nav-item" href="credits.html">原著者</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">ガイド目次</option>
              <optgroup label="はじめに">
                  <option value="getting_started.html">Rails をはじめよう</option>
              </optgroup>
              <optgroup label="モデル">
                  <option value="active_record_basics.html">Active Record の基礎</option>
                  <option value="active_record_migrations.html">Active Record マイグレーション</option>
                  <option value="active_record_validations.html">Active Record バリデーション</option>
                  <option value="active_record_callbacks.html">Active Record コールバック</option>
                  <option value="association_basics.html">Active Record の関連付け</option>
                  <option value="active_record_querying.html">Active Record クエリインターフェイス</option>
                  <option value="active_model_basics.html">Active Model の基礎</option>
              </optgroup>
              <optgroup label="ビュー">
                  <option value="action_view_overview.html">Action View の概要</option>
                  <option value="layouts_and_rendering.html">レイアウトとレンダリング</option>
                  <option value="form_helpers.html">Action View フォームヘルパー</option>
              </optgroup>
              <optgroup label="コントローラ">
                  <option value="action_controller_overview.html">Action Controller の概要</option>
                  <option value="routing.html">Rails ルーティング</option>
              </optgroup>
              <optgroup label="高度なトピック">
                  <option value="active_support_core_extensions.html">Active Support コア拡張機能</option>
                  <option value="i18n.html">Rails 国際化 (i18n) API</option>
                  <option value="action_mailer_basics.html">Action Mailer の基礎</option>
                  <option value="active_job_basics.html">Active Job の基礎</option>
                  <option value="testing.html">Rails テスティングガイド</option>
                  <option value="security.html">Rails セキュリティガイド</option>
                  <option value="debugging_rails_applications.html">Rails アプリケーションのデバッグ</option>
                  <option value="configuring.html">Rails アプリケーションを設定する</option>
                  <option value="command_line.html">コマンドラインツールと Rake タスク</option>
                  <option value="asset_pipeline.html">アセットパイプライン</option>
                  <option value="working_with_javascript_in_rails.html">Rails で JavaScript を使用する</option>
                  <option value="engines.html">Rails エンジン入門</option>
                  <option value="initialization.html">Rails の初期化プロセス</option>
                  <option value="constant_autoloading_and_reloading.html">定数の自動読み込みと再読み込み</option>
              </optgroup>
              <optgroup label="Rails を拡張する">
                  <option value="plugins.html">Rails プラグイン作成入門</option>
                  <option value="rails_on_rack.html">Rails と Rack</option>
                  <option value="generators.html">Rails ジェネレータとテンプレート入門</option>
              </optgroup>
              <optgroup label="Ruby on Rails に貢献する">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails [未着手]</option>
                  <option value="api_documentation_guidelines.html">APIドキュメント作成ガイドライン</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Rails ガイドのガイドライン</option>
              </optgroup>
              <optgroup label="メンテナンスポリシー">
                  <option value="maintenance_policy.html">メンテナンスポリシー</option>
              </optgroup>
              <optgroup label="リリースノート">
                  <option value="upgrading_ruby_on_rails.html">Rails アップグレードガイド</option>
                  <option value="4_2_release_notes.html">Ruby on Rails 4.2 リリースノート</option>
                  <option value="4_1_release_notes.html">Ruby on Rails 4.1 リリースノート</option>
                  <option value="4_0_release_notes.html">Ruby on Rails 4.0 リリースノート</option>
                  <option value="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes [未着手]</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes [未着手]</option>
                  <option value="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes [未着手]</option>
                  <option value="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes [未着手]</option>
                  <option value="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes [未着手]</option>
              </optgroup>
          </select>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Rails アプリケーションのデバッグ</h2><p>本ガイドでは、Ruby on Rails アプリケーションのさまざまなデバッグ技法をご紹介します。</p><p>このガイドの内容:</p>
<ul>
<li>デバッグの目的</li>
<li>テストで特定できない問題がアプリケーションで発生したときの追跡方法</li>
<li>さまざまなデバッグ方法</li>
<li>スタックトレースの解析方法</li>
</ul>

                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />目次</h3>
            <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<ol class="chapters">
<li>
<a href="#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%AB%E5%88%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E3%83%93%E3%83%A5%E3%83%BC%E3%83%98%E3%83%AB%E3%83%91%E3%83%BC">デバッグに利用できるビューヘルパー</a>

<ul>
<li><a href="#debug"><code>debug</code></a></li>
<li><a href="#to_yaml"><code>to_yaml</code></a></li>
<li><a href="#inspect"><code>inspect</code></a></li>
</ul>
</li>
<li>
<a href="#%E3%83%AD%E3%82%AC%E3%83%BC">ロガー</a>

<ul>
<li><a href="#%E3%83%AD%E3%82%AC%E3%83%BC%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">ロガーについて</a></li>
<li><a href="#%E3%83%AD%E3%82%B0%E3%81%AE%E5%87%BA%E5%8A%9B%E3%83%AC%E3%83%99%E3%83%AB">ログの出力レベル</a></li>
<li><a href="#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E9%80%81%E4%BF%A1">メッセージ送信</a></li>
<li><a href="#%E3%82%BF%E3%82%B0%E4%BB%98%E3%81%8D%E3%83%AD%E3%82%B0%E3%81%AE%E5%87%BA%E5%8A%9B">タグ付きログの出力</a></li>
<li><a href="#%E3%83%AD%E3%82%B0%E3%81%8C%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AB%E4%B8%8E%E3%81%88%E3%82%8B%E5%BD%B1%E9%9F%BF">ログがパフォーマンスに与える影響</a></li>
</ul>
</li>
<li>
<a href="#byebug-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B"><code>byebug</code> gemを使用してデバッグする</a>

<ul>
<li><a href="#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97">セットアップ</a></li>
<li><a href="#%E3%82%B7%E3%82%A7%E3%83%AB">シェル</a></li>
<li><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88">コンテキスト</a></li>
<li><a href="#%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89">スレッド</a></li>
<li><a href="#byebug-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B-%E5%A4%89%E6%95%B0%E3%81%AE%E6%A4%9C%E6%9F%BB">変数の検査</a></li>
<li><a href="#%E3%82%B9%E3%83%86%E3%83%83%E3%83%97%E5%AE%9F%E8%A1%8C">ステップ実行</a></li>
<li><a href="#%E3%83%96%E3%83%AC%E3%83%BC%E3%82%AF%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">ブレークポイント</a></li>
<li><a href="#%E4%BE%8B%E5%A4%96%E3%81%AE%E3%82%AD%E3%83%A3%E3%83%83%E3%83%81">例外のキャッチ</a></li>
<li><a href="#%E5%AE%9F%E8%A1%8C%E5%86%8D%E9%96%8B">実行再開</a></li>
<li><a href="#%E7%B7%A8%E9%9B%86">編集</a></li>
<li><a href="#%E7%B5%82%E4%BA%86">終了</a></li>
<li><a href="#byebug-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B-%E8%A8%AD%E5%AE%9A">設定</a></li>
</ul>
</li>
<li>
<a href="#web-console-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%87%E3%83%90%E3%83%83%E3%82%B0"><code>web-console</code> gemを使用するデバッグ</a>

<ul>
<li><a href="#console">Console</a></li>
<li><a href="#web-console-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%87%E3%83%90%E3%83%83%E3%82%B0-%E5%A4%89%E6%95%B0%E3%81%AE%E6%A4%9C%E6%9F%BB">変数の検査</a></li>
<li><a href="#web-console-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%87%E3%83%90%E3%83%83%E3%82%B0-%E8%A8%AD%E5%AE%9A">設定</a></li>
</ul>
</li>
<li>
<a href="#%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%BC%E3%83%AA%E3%83%BC%E3%82%AF%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0">メモリーリークのデバッグ</a>

<ul>
<li><a href="#valgrind">Valgrind</a></li>
</ul>
</li>
<li><a href="#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E7%94%A8%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3">デバッグ用プラグイン</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99">参考資料</a></li>
</ol>
</body></html>

          </div>
</div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h3 id="デバッグに利用できるビューヘルパー"><a href="#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%AB%E5%88%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E3%83%93%E3%83%A5%E3%83%BC%E3%83%98%E3%83%AB%E3%83%91%E3%83%BC">1 デバッグに利用できるビューヘルパー</a></h3>
<p>変数にどんな値が入っているかを確認する作業は何かと必要になります。Rails では以下の3つのメソッドを利用できます。</p>
<ul>
<li><code>debug</code></li>
<li><code>to_yaml</code></li>
<li><code>inspect</code></li>
</ul>
<h4 id="debug"><a href="#debug">1.1 <code>debug</code></a></h4>
<p><code>debug</code>ヘルパーは&lt;pre&gt;タグを返します。このタグの中にYAML形式でオブジェクトが出力されます。これにより、あらゆるオブジェクトを人間が読めるデータに変換できます。たとえば、以下のコードがビューにあるとします。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= debug @article %&gt;
&lt;p&gt;
  &lt;b&gt;Title:&lt;/b&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;

</pre>
</div>
<p>ここから以下のような出力を得られます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
--- !ruby/object Article
attributes:
  updated_at: 2008-09-05 22:55:47
  body: It's a very helpful guide for debugging your Rails app.
  title: Rails debugging guide
  published: t
  id: "1"
  created_at: 2008-09-05 22:55:47
attributes_cache: {}


Title: Rails debugging guide

</pre>
</div>
<h4 id="to_yaml"><a href="#to_yaml">1.2 <code>to_yaml</code></a></h4>
<p>インスタンス変数や、その他のあらゆるオブジェクトやメソッドをYAML形式で表示します。以下のような感じで使用します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= simple_format @article.to_yaml %&gt;
&lt;p&gt;
  &lt;b&gt;Title:&lt;/b&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;

</pre>
</div>
<p><code>to_yaml</code>メソッドは、メソッドをYAML形式に変換して読みやすくし、<code>simple_format</code>ヘルパーは出力結果をコンソールのように行ごとに改行します。これが<code>debug</code>メソッドのマジックです。</p>
<p>これにより、以下のような結果がビューに表示されます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
--- !ruby/object Article
attributes:
updated_at: 2008-09-05 22:55:47
body: It's a very helpful guide for debugging your Rails app.
title: Rails debugging guide
published: t
id: "1"
created_at: 2008-09-05 22:55:47
attributes_cache: {}

Title: Rails debugging guide

</pre>
</div>
<h4 id="inspect"><a href="#inspect">1.3 <code>inspect</code></a></h4>
<p>オブジェクトの値を表示するのに便利なメソッドとして<code>inspect</code>も利用できます。特に、配列やハッシュを扱うときに便利です。このメソッドはオブジェクトの値を文字列として出力します。以下に例を示します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= [1, 2, 3, 4, 5].inspect %&gt;
&lt;p&gt;
  &lt;b&gt;Title:&lt;/b&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;

</pre>
</div>
<p>上のコードから以下の出力を得られます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
[1, 2, 3, 4, 5]

Title: Rails debugging guide

</pre>
</div>
<h3 id="ロガー"><a href="#%E3%83%AD%E3%82%AC%E3%83%BC">2 ロガー</a></h3>
<p>実行時に情報をログに保存できるとさらに便利です。Railsは実行環境ごとに異なるログファイルを出力するようになっています。</p>
<h4 id="ロガーについて"><a href="#%E3%83%AD%E3%82%AC%E3%83%BC%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">2.1 ロガーについて</a></h4>
<p>Railsは<code>ActiveSupport::Logger</code>クラスを利用してログ情報を出力します。必要に応じて、<code>Log4r</code>など別のロガーに差し替えることもできます。</p>
<p>別のロガーの指定は、<code>environment.rb</code>または環境ごとの設定ファイルで行います。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Rails.logger = Logger.new(STDOUT)
Rails.logger = Log4r::Logger.new("Application Log")

</pre>
</div>
<p>あるいは、<code>Initializer</code>セクションに以下の <em>いずれか</em> を追加します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
config.logger = Logger.new(STDOUT)
config.logger = Log4r::Logger.new("Application Log")

</pre>
</div>
<div class="info"><p>ログの保存場所は、デフォルトでは<code>Rails.root/log/</code>になります。ログのファイル名は、アプリケーションが実行されるときの環境 (development/test/productionなど) が使用されます。</p></div>
<h4 id="ログの出力レベル"><a href="#%E3%83%AD%E3%82%B0%E3%81%AE%E5%87%BA%E5%8A%9B%E3%83%AC%E3%83%99%E3%83%AB">2.2 ログの出力レベル</a></h4>
<p>ログに出力されるメッセージのログレベルが、設定済みのログレベル以上になった場合に、対応するログファイルにそのメッセージが出力されます。現在のログレベルを知りたい場合は、<code>Rails.logger.level</code>メソッドを呼び出します。</p>
<p>指定可能なログレベルは<code>:debug</code>、<code>:info</code>、<code>:warn</code>、<code>:error</code>、<code>:fatal</code>、<code>:unknown</code>の6つであり、それぞれ0から5までの数字に対応します。デフォルトのログレベルを変更するには以下のようにします。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
config.log_level = :warn # 環境ごとのイニシャライザで使用可能
Rails.logger.level = 0 # いつでも使用可能

</pre>
</div>
<p>これは、development環境やstating環境ではログを出力し、production環境では不要な情報をログに出力したくない場合などに便利です。</p>
<div class="info"><p>Railsのデフォルトログレベルは全環境で<code>debug</code>です。</p></div>
<h4 id="メッセージ送信"><a href="#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E9%80%81%E4%BF%A1">2.3 メッセージ送信</a></h4>
<p>コントローラ、モデル、メイラーから現在のログに書き込みたい場合は、<code>logger.(debug|info|warn|error|fatal)</code>を使用します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
logger.debug "Person attributes hash: #{@person.attributes.inspect}"
logger.info "Processing the request..."
logger.fatal "Terminating application, raised unrecoverable error!!!"

</pre>
</div>
<p>例として、ログに別の情報を追加する機能を装備したメソッドを以下に示します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
  class ArticlesController &lt; ApplicationController
  # ...

  def create
    @article = Article.new(params[:article])
    logger.debug "新しい記事: #{@article.attributes.inspect}"
    logger.debug "記事が正しいかどうか: #{@article.valid?}"

    if @article.save
      flash[:notice] =  'Article was successfully created.'
      logger.debug "記事は正常に保存され、ユーザーをリダイレクト中..."
      redirect_to(@article)
    else
      render action: "new"
    end
  end

  # ...
end

</pre>
</div>
<p>上のコントローラのアクションを実行すると、以下のようなログが生成されます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
Processing ArticlesController#create (for 127.0.0.1 at 2008-09-08 11:52:54) [POST]
  Session ID: BAh7BzoMY3NyZl9pZCIlMDY5MWU1M2I1ZDRjODBlMzkyMWI1OTg2NWQyNzViZjYiCmZsYXNoSUM6J0FjdGl
vbkNvbnRyb2xsZXI6OkZsYXNoOjpGbGFzaEhhc2h7AAY6CkB1c2VkewA=--b18cd92fba90eacf8137e5f6b3b06c4d724596a4
  Parameters: {"commit"=&gt;"Create", "article"=&gt;{"title"=&gt;"Debugging Rails",
"body"=&gt;"I'm learning how to print in logs!!!", "published"=&gt;"0"},
"authenticity_token"=&gt;"2059c1286e93402e389127b1153204e0d1e275dd", "action"=&gt;"create", "controller"=&gt;"articles"}
新しい記事: {"updated_at"=&gt;nil, "title"=&gt;"Debugging Rails", "body"=&gt;"I'm learning how to print in logs!!!",
"published"=&gt;false, "created_at"=&gt;nil}
記事が正しいかどうか: true
  Article Create (0.000443)   INSERT INTO "articles" ("updated_at", "title", "body", "published",
"created_at") VALUES('2008-09-08 14:52:54', 'Debugging Rails',
'I''m learning how to print in logs!!!', 'f', '2008-09-08 14:52:54')
記事は正常に保存され、ユーザーをリダイレクト中...
Redirected to # Article:0x20af760&gt;
Completed in 0.01224 (81 reqs/sec) | DB: 0.00044 (3%) | 302 Found [http://localhost/articles]

</pre>
</div>
<p>このようにログに独自の情報を追加すると、予想外の異常な動作をログで見つけやすくなります。ログに独自の情報を追加する場合は、productionログが意味のない大量のメッセージでうずまることのないよう、適切なログレベルを使用するようにしてください。</p>
<h4 id="タグ付きログの出力"><a href="#%E3%82%BF%E3%82%B0%E4%BB%98%E3%81%8D%E3%83%AD%E3%82%B0%E3%81%AE%E5%87%BA%E5%8A%9B">2.4 タグ付きログの出力</a></h4>
<p>ユーザーとアカウントを多数使用するアプリケーションを実行するときに、何らかのカスタムルールを設定してログをフィルタできると便利です。Active Supportの<code>TaggedLogging</code>を使用すれば、サブドメインやリクエストIDなどを指定してログを絞り込むことができ、このようなアプリケーションのデバッグがはかどります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
logger = ActiveSupport::TaggedLogging.new(Logger.new(STDOUT))
logger.tagged("BCX") { logger.info "Stuff" }                            # Logs "[BCX] Stuff"
logger.tagged("BCX", "Jason") { logger.info "Stuff" }                   # Logs "[BCX] [Jason] Stuff"
logger.tagged("BCX") { logger.tagged("Jason") { logger.info "Stuff" } } # Logs "[BCX] [Jason] Stuff"

</pre>
</div>
<h4 id="ログがパフォーマンスに与える影響"><a href="#%E3%83%AD%E3%82%B0%E3%81%8C%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AB%E4%B8%8E%E3%81%88%E3%82%8B%E5%BD%B1%E9%9F%BF">2.5 ログがパフォーマンスに与える影響</a></h4>
<p>ログ出力がRailsアプリのパフォーマンスに与える影響は常にわずかです。ログをディスクに保存する場合は特にそうです。ただし、場合によってはそうとは言い切れないことがあります。</p>
<p>ログレベル<code>:debug</code>は、<code>:fatal</code>と比べてはるかに多くの文字列が評価および(ディスクなどに)出力されるため、パフォーマンスに与える影響がずっと大きくなります。</p>
<p>他にも、以下のように<code>Logger</code>の呼び出しを多数実行した場合には落とし穴に注意する必要があります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
logger.debug "Person attributes hash: #{@person.attributes.inspect}"

</pre>
</div>
<p>上の例では、たとえログ出力レベルをdebugにしなかった場合でもパフォーマンスが低下します。その理由は、上のコードでは文字列を評価する必要があり、その際に比較的動作が重い<code>String</code>オブジェクトのインスタンス化と、実行に時間のかかる変数の式展開 (interpolation) が行われているからです。
したがって、ロガーメソッドに渡すものはブロックの形にしておくことをお勧めします。ブロックとして渡しておけば、ブロックの評価は出力レベルが設定レベル以上になった場合にしか行われない (遅延読み込みなど) ためです。これに従って上のコードを書き直すと以下のようになります。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
logger.debug {"Person attributes hash: #{@person.attributes.inspect}"}

</pre>
</div>
<p>渡したブロックの内容 (ここでは文字列の式展開) は、debug が有効になっている場合にしか評価されません。この方法によるパフォーマンスの改善は、大量のログを出力しているときでないとそれほど実感できないかもしれませんが、それでも採用する価値があります。</p>
<h3 id="byebug-gemを使用してデバッグする"><a href="#byebug-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B">3 <code>byebug</code> gemを使用してデバッグする</a></h3>
<p>コードが期待どおりに動作しない場合は、ログやコンソールに出力して問題を診断することができます。ただし、この方法ではエラー追跡を何度も繰り返さねばならず、根本的な原因を突き止めるには能率がよいとは言えません。
実行中のコードに探りを入れる必要があるのであれば、最も頼りになるのはやはりデバッガーです。</p>
<p>デバッガーは、Railsのソースコードを追うときに、そのコードをどこで開始するのかがを知りたいときにも有用です。アプリケーションへのリクエストをすべてデバッグし、自分が書いたコードからRailsのもっと深いところへダイブする方法を本ガイドから学びましょう。</p>
<h4 id="セットアップ"><a href="#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97">3.1 セットアップ</a></h4>
<p><code>byebug</code> gemを使用すると、Railsコードにブレークポイントを設定してステップ実行できます。次を実行するだけでインストールできます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
$ gem install byebug

</pre>
</div>
<p>後はRailsアプリケーション内で<code>byebug</code>メソッドを呼び出せばいつでもデバッガーを起動できます。</p>
<p>以下に例を示します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class PeopleController &lt; ApplicationController
  def new
    byebug
    @person = Person.new
  end
end

</pre>
</div>
<h4 id="シェル"><a href="#%E3%82%B7%E3%82%A7%E3%83%AB">3.2 シェル</a></h4>
<p>アプリケーションで<code>byebug</code>を呼び出すと、アプリケーションサーバーを実行しているターミナルウィンドウ内のデバッガーシェルで即座にデバッガーが起動し、<code>(byebug)</code>というプロンプトが表示されます。
実行しようとしている行の前後のコードがプロンプトの前に表示され、'=&gt;'で現在の行が示されます。以下に例を示します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
[1, 10] in /PathTo/project/app/controllers/articles_controller.rb
    3:
    4:   # GET /articles
    5:   # GET /articles.json
    6:   def index
    7:     byebug
=&gt;  8:     @articles = Article.find_recent
    9:
   10:     respond_to do |format|
   11:       format.html # index.html.erb
   12:       format.json { render json: @articles }

(byebug)

</pre>
</div>
<p>ブラウザからのリクエストによってデバッグ行に到達した場合、リクエストしたブラウザのタブ上の処理は、デバッガが終了してリクエストの処理が完全に終了するまで中断します。</p>
<p>以下に例を示します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
=&gt; Booting WEBrick
=&gt; Rails 5.0.0 application starting in development on http://0.0.0.0:3000
=&gt; Run `rails server -h` for more startup options
=&gt; Notice: server is listening on all interfaces (0.0.0.0). Consider using 127.0.0.1 (--binding option)
=&gt; Ctrl-C to shutdown server
[2014-04-11 13:11:47] INFO  WEBrick 1.3.1
[2014-04-11 13:11:47] INFO  ruby 2.1.1 (2014-02-24) [i686-linux]
[2014-04-11 13:11:47] INFO  WEBrick::HTTPServer#start: pid=6370 port=3000


Started GET "/" for 127.0.0.1 at 2014-04-11 13:11:48 +0200
  ActiveRecord::SchemaMigration Load (0.2ms)  SELECT "schema_migrations".* FROM "schema_migrations"
Processing by ArticlesController#index as HTML

[3, 12] in /PathTo/project/app/controllers/articles_controller.rb
    3:
    4:   # GET /articles
    5:   # GET /articles.json
    6:   def index
    7:     byebug
=&gt;  8:     @articles = Article.find_recent
    9:
   10:     respond_to do |format|
   11:       format.html # index.html.erb
   12:       format.json { render json: @articles }

(byebug)

</pre>
</div>
<p>それではアプリケーションの奥深くにダイブしてみましょう。まずはデバッガーのヘルプを表示してみるのがよいでしょう。<code>help</code>と入力します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) help

byebug 2.7.0

Type 'help &lt;command-name&gt;' for help on a specific command

Available commands:
backtrace  delete   enable  help       list    pry next  restart  source     up
break      disable  eval    info       method  ps        save     step       var
catch      display  exit    interrupt  next    putl      set      thread
condition  down     finish  irb        p       quit      show     trace
continue   edit     frame   kill       pp      reload    skip     undisplay

</pre>
</div>
<div class="info"><p>個別のコマンドのヘルプを表示するには、デバッガーのプロンプトで<code>help &lt;コマンド名&gt;</code>と入力します。（例: <em><code>help list</code></em>）デバッグ用コマンドは、他のコマンドと区別できる程度に短縮できます。たとえば<code>list</code>コマンドの代わりに<code>l</code>と入力することもできます。</p></div>
<p>前の10行を表示するには、<code>list-</code> (または <code>l-</code>) と入力します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) l-

[1, 10] in /PathTo/project/app/controllers/articles_controller.rb
   1  class ArticlesController &lt; ApplicationController
   2    before_action :set_article, only: [:show, :edit, :update, :destroy]
   3
   4    # GET /articles
   5    # GET /articles.json
   6    def index
   7      byebug
   8      @articles = Article.find_recent
   9
   10      respond_to do |format|


</pre>
</div>
<p>上に示したように、該当のファイルに移動して、<code>byebug</code>呼び出しを追加した行の前を表示できます。最後に、<code>list=</code>と入力して現在の位置を再び表示してみましょう。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) list=

[3, 12] in /PathTo/project/app/controllers/articles_controller.rb
    3:
    4:   # GET /articles
    5:   # GET /articles.json
    6:   def index
    7:     byebug
=&gt;  8:     @articles = Article.find_recent
    9:
   10:     respond_to do |format|
   11:       format.html # index.html.erb
   12:       format.json { render json: @articles }

(byebug)

</pre>
</div>
<h4 id="コンテキスト"><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88">3.3 コンテキスト</a></h4>
<p>アプリケーションのデバッグ中は、通常と異なる「コンテキスト」に置かれます。具体的には、スタックの別の部分を通って進むコンテキストです。</p>
<p>デバッガーは、停止位置やイベントに到達するときに「コンテキスト」を作成します。作成されたコンテキストには、中断しているプログラムに関する情報が含まれており、デバッガーはこの情報を使用して、フレームスタックの検査やデバッグ中のプログラムにおける変数の評価を行います。また、デバッグ中のプログラムが停止している位置の情報もコンテキストに含まれます。</p>
<p><code>backtrace</code>コマンド (またはそのエイリアスである<code>where</code>コマンド) を使用すれば、いつでもアプリケーションのバックトレースを出力できます。これは、コードのその位置に至るまでの経過を知るうえで非常に便利です。コードのある行にたどりついたとき、その経緯を知りたければ<code>backtrace</code>でわかります。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) where
--&gt; #0  ArticlesController.index
      at /PathTo/project/test_app/app/controllers/articles_controller.rb:8
    #1  ActionController::ImplicitRender.send_action(method#String, *args#Array)
      at /PathToGems/actionpack-5.0.0/lib/action_controller/metal/implicit_render.rb:4
    #2  AbstractController::Base.process_action(action#NilClass, *args#Array)
      at /PathToGems/actionpack-5.0.0/lib/abstract_controller/base.rb:189
    #3  ActionController::Rendering.process_action(action#NilClass, *args#NilClass)
      at /PathToGems/actionpack-5.0.0/lib/action_controller/metal/rendering.rb:10
...

</pre>
</div>
<p>現在のフレームは<code>--&gt;</code>で示されます。<code>frame</code><em>n</em>コマンド (<em>n</em>はフレーム番号) を使用すれば、トレース内のどのコンテキストにも自由に移動できます。このコマンドを実行すると、<code>byebug</code>は新しいコンテキストを表示します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) frame 2

[184, 193] in /PathToGems/actionpack-5.0.0/lib/abstract_controller/base.rb
   184:       # is the intended way to override action dispatching.
   185:       #
   186:       # Notice that the first argument is the method to be dispatched
   187:       # which is *not* necessarily the same as the action name.
   188:       def process_action(method_name, *args)
=&gt; 189:         send_action(method_name, *args)
   190:       end
   191:
   192:       # Actually call the method associated with the action. Override
   193:       # this method if you wish to change how action methods are called,

(byebug)

</pre>
</div>
<p>コードを1行ずつ実行していた場合、利用できる変数は同一です。つまり、これこそがデバッグという作業です。</p>
<p><code>up [n]</code> (短縮形の<code>u</code>も可) コマンドや<code>down [n]</code>コマンドを使用して、スタックを <em>n</em> フレーム上または下に移動し、コンテキストを切り替えることもできます。upはスタックフレーム番号の大きい方に進み、downは小さい方に進みます。</p>
<h4 id="スレッド"><a href="#%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89">3.4 スレッド</a></h4>
<p>デバッガーで<code>thread</code>(短縮形は<code>th</code>) コマンドを使用すると、スレッド実行中にスレッドのリスト表示/停止/再開/切り替えを行えます。このコマンドには以下のささやかなオプションがあります。</p>
<ul>
<li>
<code>thread</code>は現在のスレッドを表示します。</li>
<li>
<code>thread list</code>はすべてのスレッドのリストをステータス付きで表示します。現在実行中のスレッドは「+」記号と数字で示されます。</li>
<li>
<code>thread stop</code><em>n</em> はスレッド <em>n</em> を停止します。</li>
<li>
<code>thread resume</code><em>n</em> はスレッド <em>n</em> を再開します。</li>
<li>
<code>thread switch</code><em>n</em> は現在のスレッドコンテキストを <em>n</em> に切り替えます。</li>
</ul>
<p>このコマンドは他の場合にも非常に便利です。同時実行スレッドのデバッグ中に、競合状態が発生していないかどうかを確認する必要がある場合にも使えます。</p>
<h4 id="byebug-gemを使用してデバッグする-変数の検査"><a href="#byebug-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B-%E5%A4%89%E6%95%B0%E3%81%AE%E6%A4%9C%E6%9F%BB">3.5 変数の検査</a></h4>
<p>すべての式は、現在のコンテキストで評価されます。式を評価するには、単にその式を入力します。</p>
<p>次の例では、現在のコンテキスト内で定義されたインスタンス変数を出力する方法を示しています。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
[3, 12] in /PathTo/project/app/controllers/articles_controller.rb
    3:
    4:   # GET /articles
    5:   # GET /articles.json
    6:   def index
    7:     byebug
=&gt;  8:     @articles = Article.find_recent
    9:
   10:     respond_to do |format|
   11:       format.html # index.html.erb
   12:       format.json { render json: @articles }

(byebug) instance_variables
[:@_action_has_layout, :@_routes, :@_headers, :@_status, :@_request, :@_response, :@_env, :@_prefixes, :@_lookup_context, :@_action_name, :@_response_body, :@marked_for_same_origin_verification, :@_config]

</pre>
</div>
<p>見ての通り、コントローラからアクセスできるすべての変数が表示されています。表示される変数リストは、コードの実行に伴って動的に更新されます。
たとえば、<code>next</code>コマンドで次の行に進んだとします (このコマンドの詳細については後述します)。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) next
[5, 14] in /PathTo/project/app/controllers/articles_controller.rb
   5     # GET /articles.json
   6     def index
   7       byebug
   8       @articles = Article.find_recent
   9
=&gt; 10       respond_to do |format|
   11         format.html # index.html.erb
   12        format.json { render json: @articles }
   13      end
   14    end
   15
(byebug)

</pre>
</div>
<p>それではinstance_variablesをもう一度調べてみましょう。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) instance_variables.include? "@articles"
true

</pre>
</div>
<p>定義行が実行されたことによって、今度は<code>@articles</code>もインスタンス変数に表示されます。</p>
<div class="info"><p><code>irb</code>コマンドを使用することで、<strong>irb</strong>モードで実行できます。
これにより、呼び出し中のコンテキスト内でirbセッションが開始されます。ただし、この機能はまだ実験中の段階です。</p></div>
<p>変数と値のリストを表示するのに便利なのは何と言っても<code>var</code>メソッドでしょう。
<code>byebug</code>でこのメソッドを使ってみましょう。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) help var
v[ar] cl[ass]                   show class variables of self
v[ar] const &lt;object&gt;            show constants of object
v[ar] g[lobal]                  show global variables
v[ar] i[nstance] &lt;object&gt;       show instance variables of object
v[ar] l[ocal]                   show local variables

</pre>
</div>
<p>このメソッドは、現在のコンテキストでの変数の値を検査するのにうってつけの方法です。たとえば、現時点でローカル変数が何も定義されていないことを確認してみましょう。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) var local
(byebug)

</pre>
</div>
<p>以下の方法でオブジェクトのメソッドを検査することもできます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) var instance Article.new
@_start_transaction_state = {}
@aggregation_cache = {}
@association_cache = {}
@attributes = {"id"=&gt;nil, "created_at"=&gt;nil, "updated_at"=&gt;nil}
@attributes_cache = {}
@changed_attributes = nil
...

</pre>
</div>
<div class="info"><p><code>p</code> (print) コマンドと<code>pp</code> (pretty print) コマンドを使用して
Rubyの式を評価し、変数の値をコンソールに出力することができます。</p></div>
<p><code>display</code>コマンドを使用して変数をウォッチすることもできます。これは、デバッガーで実行を進めながら変数の値の移り変わりを追跡するのに大変便利です。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) display @articles
1: @articles = nil

</pre>
</div>
<p>スタック内で移動するたびに、そのときの変数と値のリストが出力されます。変数の表示を止めるには、<code>undisplay</code><em>n</em> (<em>n</em> は変数番号) を実行します。上の例では変数番号は 1 になっています。</p>
<h4 id="ステップ実行"><a href="#%E3%82%B9%E3%83%86%E3%83%83%E3%83%97%E5%AE%9F%E8%A1%8C">3.6 ステップ実行</a></h4>
<p>これで、トレース実行中に現在の実行位置を確認し、利用可能な変数をいつでも確認できるようになりました。アプリケーションの実行について引き続き学んでみましょう。</p>
<p><code>step</code>コマンド (短縮形は<code>s</code>) を使用すると、プログラムの実行を継続し、次の論理的な停止行まで進んだらデバッガーに制御を返します。</p>
<p><code>step</code>とよく似た<code>next</code>を使用することももちろんできますが、<code>next</code>はそのコードの行に関数やメソッドがあっても止まらずにそれらの関数やメソッドを実行してしまう点が異なります。</p>
<div class="info"><p><code>step n</code>や<code>next n</code>と入力することで、<code>n</code>ステップずつ進めることもできます。</p></div>
<p><code>next</code>と<code>step</code>の違いは次のとおりです。<code>step</code>は次のコード行を実行したらそこで止まるので、常に一度に1行だけを実行します。<code>next</code>はメソッドがあってもその中に潜らずに次の行に進みます。</p>
<p>たとえば、次のような状況を考えてみましょう</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Started GET "/" for 127.0.0.1 at 2014-04-11 13:39:23 +0200
Processing by ArticlesController#index as HTML

[1, 8] in /home/davidr/Proyectos/test_app/app/models/article.rb
   1: class Article &lt; ActiveRecord::Base
   2:
   3:   def self.find_recent(limit = 10)
   4:     byebug
=&gt; 5:     where('created_at &gt; ?', 1.week.ago).limit(limit)
   6:   end
   7:
   8: end

(byebug)

</pre>
</div>
<p><code>next</code>を使用していて、メソッド呼び出しに潜ってみたいとしましょう。しかしbyebugは、潜る代わりに単に同じコンテキストの次の行に進みます。この例の場合、次の行とはそのメソッドの最終行になります。従って、<code>byebug</code>は前のフレームにある次の次の行にジャンプします。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) next
前のフレームの実行が完了するので、Nextによって1つ上のフレームに移動する

[4, 13] in /PathTo/project/test_app/app/controllers/articles_controller.rb
    4:   # GET /articles
    5:   # GET /articles.json
    6:   def index
    7:     @articles = Article.find_recent
    8:
=&gt;  9:     respond_to do |format|
   10:       format.html # index.html.erb
   11:       format.json { render json: @articles }
   12:     end
   13:   end

(byebug)

</pre>
</div>
<p>同じ状況で<code>step</code>を使用すると、文字通り「Rubyコードの、実行すべき次の行」に進みます。ここではactivesupportの<code>week</code>メソッドに潜って進むことになります。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) step

[50, 59] in /PathToGems/activesupport-5.0.0/lib/active_support/core_ext/numeric/time.rb
   50:     ActiveSupport::Duration.new(self * 24.hours, [[:days, self]])
   51:   end
   52:   alias :day :days
   53:
   54:   def weeks
=&gt; 55:     ActiveSupport::Duration.new(self * 7.days, [[:days, self * 7]])
   56:   end
   57:   alias :week :weeks
   58:
   59:   def fortnights

(byebug)

</pre>
</div>
<p>これは自分のコードの、ひいてはRuby on Railsのバグを見つけ出す方法として非常に優れています。</p>
<h4 id="ブレークポイント"><a href="#%E3%83%96%E3%83%AC%E3%83%BC%E3%82%AF%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">3.7 ブレークポイント</a></h4>
<p>ブレークポイントとは、アプリケーションの実行がプログラムの特定の場所に達した時に停止する位置を指します。そしてその場所でデバッガーシェルが起動します。</p>
<p><code>break</code> (または<code>b</code>) コマンドを使用してブレークポイントを動的に追加できます。
手動でブレークポイントを追加する方法は次の 3 とおりです。</p>
<ul>
<li>
<code>break line</code>: 現在のソースファイルの <em>line</em> で示した行にブレークポイントを設定します。</li>
<li>
<code>break file:line [if expression]</code>: <em>file</em>の<em>line</em>行目にブレークポイントを設定します。<em>expression</em> が与えられた場合、デバッガを起動するにはこの式が <em>true</em> と評価される必要があります。</li>
<li>
<code>break class(.|\#)method [if expression]</code>: <em>class</em> に定義されている <em>method</em> にブレークポイントを設定します (「.」と「#」はそれぞれクラスとインスタンスメソッドを指す)。<em>expression</em>の動作はfile:lineの場合と同じです。</li>
</ul>
<p>さっきと同じ状況を例に説明します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
[4, 13] in /PathTo/project/app/controllers/articles_controller.rb
    4:   # GET /articles
    5:   # GET /articles.json
    6:   def index
    7:     @articles = Article.find_recent
    8:
=&gt;  9:     respond_to do |format|
   10:       format.html # index.html.erb
   11:       format.json { render json: @articles }
   12:     end
   13:   end

(byebug) break 11
Created breakpoint 1 at /PathTo/project/app/controllers/articles_controller.rb:11


</pre>
</div>
<p>ブレークポイントをリスト表示するには、<code>info breakpoints</code><em>n</em>や<code>info break</code><em>n</em>を使用します。番号を指定すると、その番号のブレークポイントをリスト表示します。番号を指定しない場合は、すべてのブレークポイントをリスト表示します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) info breakpoints
Num Enb What
1   y   at /PathTo/project/app/controllers/articles_controller.rb:11

</pre>
</div>
<p><code>delete</code><em>n</em>コマンドを使用すると<em>n</em>番のブレークポイントを削除できます。番号を指定しない場合、現在有効なブレークポイントをすべて削除します。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
(byebug) delete 1
(byebug) info breakpoints
No breakpoints.

</pre>
</div>
<p>ブレークポイントを有効にしたり、無効にしたりすることもできます。</p>
<ul>
<li>
<code>enable breakpoints</code>: <em>breakpoints</em>で指定したブレークポイントのリスト (無指定の場合はすべてのブレークポイント) でのプログラムの停止を有効にします。ブレークポイントを作成するとデフォルトでこの状態になります。</li>
<li>
<code>disable breakpoints</code>: <em>breakpoints</em>で指定したブレークポイントのリストで停止しなくなります。</li>
</ul>
<h4 id="例外のキャッチ"><a href="#%E4%BE%8B%E5%A4%96%E3%81%AE%E3%82%AD%E3%83%A3%E3%83%83%E3%83%81">3.8 例外のキャッチ</a></h4>
<p><code>catch exception-name</code> (省略形は <code>cat exception-name</code>) を使用すると、例外を受けるハンドラが他にないと考えられる場合に、<em>exception-name</em>で例外の種類を指定してインターセプトできます。</p>
<p>例外のキャッチポイントをすべてリスト表示するには単に<code>catch</code>と入力します。</p>
<h4 id="実行再開"><a href="#%E5%AE%9F%E8%A1%8C%E5%86%8D%E9%96%8B">3.9 実行再開</a></h4>
<p>デバッガーで停止したアプリケーションの再開方法は2種類あります。</p>
<ul>
<li>
<code>continue</code> [line-specification] (または<code>c</code>): スクリプトが直前に停止していたアドレスからプログラムの実行を再開します。このとき、それまで設定されていたブレークポイントはすべて無視されます。オプションとして、特定の行番号をワンタイムブレークポイントとして[line-specification]で指定できます。このワンタイムブレークポイントに達するとブレークポイントは削除されます。</li>
<li>
<code>finish</code> [frame-number] (or <code>fin</code>): 指定のスタックフレームが返るまで実行を続けます。frame-numberが指定されていない場合は、現在選択しているフレームが返るまで実行を続けます。フレーム位置が指定されていない (upやdownやフレーム番号指定が行われていない) 場合は、現在の位置から最も近いフレームまたは0フレームから開始します。フレーム番号を指定すると、そのフレームが返るまで実行を続けます。</li>
</ul>
<h4 id="編集"><a href="#%E7%B7%A8%E9%9B%86">3.10 編集</a></h4>
<p>デバッガー上のコードをエディタで開くためのコマンドは2種類あります。</p>
<ul>
<li>
<code>edit [file:line]</code>: <em>file</em>をエディタで開きます。エディタはEDITOR環境変数で指定します。<em>line</em>で行数を指定することもできます。</li>
</ul>
<h4 id="終了"><a href="#%E7%B5%82%E4%BA%86">3.11 終了</a></h4>
<p>デバッガーを終了するには、<code>quit</code>コマンド (短縮形は <code>q</code>) または別名の<code>exit</code>を使用します。</p>
<p>quitを実行すると、事実上すべてのスレッドを終了しようとします。これによりサーバーが停止するので、サーバーを再起動する必要があります。</p>
<h4 id="byebug-gemを使用してデバッグする-設定"><a href="#byebug-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%99%E3%82%8B-%E8%A8%AD%E5%AE%9A">3.12 設定</a></h4>
<p><code>byebug</code>の振る舞いを変更するためのオプションがいくつかあります。</p>
<ul>
<li>
<code>set autoreload</code>: ソースコードが変更されると再読み込みします (デフォルト: true)。</li>
<li>
<code>set autolist</code>: すべてのブレークポイントで<code>list</code>コマンドを実行します (デフォルト: true)。</li>
<li>
<code>set listsize _n_</code>: リスト表示の行数をデフォルトから<em>n</em> に変更します (デフォルト: 10)。</li>
<li>
<code>set forcestep</code>: <code>next</code>や<code>step</code>コマンドを実行すると常に新しい行に移動するようにします。</li>
</ul>
<p>すべてのオプションを表示するには<code>help set</code>を実行します。特定の<code>set</code>コマンドを調べるには<code>help set</code><em>subcommand</em> を実行します。</p>
<div class="info"><p>これらの設定は、ホームディレクトリの<code>.byebugrc</code>ファイルに保存しておくことができます。
デバッガーが起動すると、この設定がグローバルに適用されます。以下に例を示します。</p></div>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
set forcestep
set listsize 25

</pre>
</div>
<h3 id="web-console-gemを使用するデバッグ"><a href="#web-console-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%87%E3%83%90%E3%83%83%E3%82%B0">4 <code>web-console</code> gemを使用するデバッグ</a></h3>
<p>Web Consoleは<code>byebug</code>と似ていますが、ブラウザ上で動作する点が異なります。開発中のどのページでも、ビューやコントローラのコンテキストでコンソールをリクエストできます。コンソールは、HTMLコンテンツの隣に表示されます。</p>
<h4 id="console"><a href="#console">4.1 Console</a></h4>
<p><code>console</code>メソッドを呼び出すことで、任意のコントローラのアクションやビューでいつでもコンソールを呼び出せます。</p>
<p>たとえば、コントローラで以下のように呼び出せます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class PostsController &lt; ApplicationController
  def new
    console
    @post = Post.new
  end
end

</pre>
</div>
<p>ビューでも以下のように呼び出せます。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;% console %&gt;

&lt;h2&gt;New Post&lt;/h2&gt;

</pre>
</div>
<p>上のコードは、ビューの内部でコンソールを出力します。<code>console</code>を呼び出す位置を気にする必要はありません。コンソールは、呼び出し位置にかかわらず、HTMLコンテンツの隣りに出力されます。</p>
<p>コンソールでは純粋なRubyコードを実行できます。ここでカスタムクラスの定義やインスタンス化を行ったり、新しいモデルを作成したり、変数を検査したりすることができます。</p>
<div class="note"><p>一回のリクエストで出力できるコンソールは1つだけです。<code>console</code>呼び出しを2回以上行うと<code>web-console</code>でエラーが発生します。</p></div>
<h4 id="web-console-gemを使用するデバッグ-変数の検査"><a href="#web-console-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%87%E3%83%90%E3%83%83%E3%82%B0-%E5%A4%89%E6%95%B0%E3%81%AE%E6%A4%9C%E6%9F%BB">4.2 変数の検査</a></h4>
<p><code>instance_variables</code>を呼び出すと、コンテキストで利用可能なインスタンス変数をすべてリスト表示できます。すべてのローカル変数をリスト表示したい場合は、<code>local_variables</code>を使用します。</p>
<h4 id="web-console-gemを使用するデバッグ-設定"><a href="#web-console-gem%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%87%E3%83%90%E3%83%83%E3%82%B0-%E8%A8%AD%E5%AE%9A">4.3 設定</a></h4>
<ul>
<li>
<code>config.web_console.whitelisted_ips</code>: 認証済みの IPv4/IPv6アドレスとネットワークのリストです (デフォルト値: <code>127.0.0.1/8、::1</code>).</li>
<li>
<code>config.web_console.whiny_requests</code>: コンソール出力が抑制されている場合にメッセージをログ出力します (デフォルト値: <code>true</code>).</li>
</ul>
<p><code>web-console</code>はサーバー上の純粋なRubyコードをリモート評価できるので、production環境では絶対に使用しないください。</p>
<h3 id="メモリーリークのデバッグ"><a href="#%E3%83%A1%E3%83%A2%E3%83%AA%E3%83%BC%E3%83%AA%E3%83%BC%E3%82%AF%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0">5 メモリーリークのデバッグ</a></h3>
<p>Railsに限らず、Rubyアプリケーションではメモリーリークが発生することがあります。リークはRubyコードレベルのこともあれば、Cコードレベルであることもあります。</p>
<p>このセクションでは、Valgrindなどのツールを使用してこうしたメモリーリークの検出と修正を行う方法をご紹介します。</p>
<h4 id="valgrind"><a href="#valgrind">5.1 Valgrind</a></h4>
<p><a href="http://valgrind.org/">Valgrind</a>はLinux専用のアプリケーションであり、Cコードベースのメモリーリークや競合状態の検出を行います。</p>
<p>Valgrindには、さまざまなメモリー管理上のバグやスレッドバグなどを自動検出し、プログラムの詳細なプロファイリングを行うための各種ツールがあります。たとえば、インタプリタ内にあるC拡張機能が<code>malloc()</code>を呼び出した後<code>free()</code>を正しく呼び出さなかった場合、このメモリーはアプリケーションが終了するまで利用できなくなります。</p>
<p>Valgrindのインストール方法とRuby内での使用方法については、<a href="http://blog.evanweaver.com/articles/2008/02/05/valgrind-and-ruby/">ValgrindとRuby</a>(Evan Weaver著、英語) を参照してください。</p>
<h3 id="デバッグ用プラグイン"><a href="#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E7%94%A8%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3">6 デバッグ用プラグイン</a></h3>
<p>アプリケーションのエラーを検出し、デバッグするためのRailsプラグインがあります。デバッグ用に便利なプラグインのリストを以下にご紹介します。</p>
<ul>
<li>
<a href="https://github.com/josevalim/rails-footnotes">Footnotes</a>: すべてのRailsページに脚注を追加し、リクエスト情報を表示したり、TextMateでソースを開くためのリンクを表示したりします。</li>
<li>
<a href="https://github.com/ruckus/active-record-query-trace/tree/master">Query Trace</a>: ログにクエリ元のトレースを追加します。</li>
<li>
<a href="https://github.com/nesquena/query_reviewer">Query Reviewer</a>: このRailsプラグインは、開発中のselectクエリの前に"EXPLAIN"を実行します。また、ページごとにDIVセクションを追加して、分析対象のクエリごとの警告の概要をそこに表示します。</li>
<li>
<a href="https://github.com/smartinez87/exception_notification/tree/master">Exception Notifier</a>: Railsアプリケーションでのエラー発生時用の、メイラーオブジェクトとメール通知送信テンプレートのデフォルトセットを提供します。</li>
<li>
<a href="https://github.com/charliesome/better_errors">Better Errors</a>: Rails標準のエラーページを新しい表示に置き換えて、ソースコードや変数検査などのコンテキスト情報を見やすくしてくれます。</li>
<li>
<a href="https://github.com/dejan/rails_panel">RailsPanel</a>: Rails開発用のChrome機能拡張です。これがあればdevelopment.logでtailコマンドを実行する必要がなくなります。Railsアプリケーションのリクエストに関するすべての情報をブラウザ上 (Developer Toolsパネル) に表示できます。
db時間、レンダリング時間、トータル時間、パラメータリスト、出力したビューなども表示されます。</li>
</ul>
<h3 id="参考資料"><a href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99">7 参考資料</a></h3>
<ul>
<li>
<a href="http://bashdb.sourceforge.net/ruby-debug/home-page.html">ruby-debugホームページ</a>(英語)</li>
<li>
<a href="https://github.com/cldwalker/debugger">debuggerホームページ</a>(英語)</li>
<li>
<a href="https://github.com/deivid-rodriguez/byebug">byebugホームページ</a>(英語)</li>
<li>
<a href="https://github.com/rails/web-console">web-consoleホームページ</a>(英語)</li>
<li>
<a href="http://www.sitepoint.com/debug-rails-app-ruby-debug/">記事: ruby-debugでRailsアプリケーションをデバッグする</a>(英語)</li>
<li>
<a href="http://railscasts.com/episodes/54-debugging-ruby-revised">Ryan Batesのスクリーンキャスト: Rubyデバッグ(改訂版)</a>(英語)</li>
<li>
<a href="http://railscasts.com/episodes/24-the-stack-trace">Ryan Batesのスクリーンキャスト: スタックトレース</a>(英語)</li>
<li>
<a href="http://railscasts.com/episodes/56-the-logger">Ryan Batesのスクリーンキャスト: ロガー</a>(英語)</li>
<li>
<a href="http://bashdb.sourceforge.net/ruby-debug.html">ruby-debugによるデバッグ</a>(英語)</li>
</ul>
</body></html>

        
        <h3>フィードバックについて</h3>
        <p>
          本ガイドの訳文およびソースコードは、GitHub上の <a href="https://github.com/yasslab/railsguides.jp">yasslab/railsguides.jp</a> で管理・公開されております。
	  本ガイドを読んで、誤字・脱字・誤訳などを見かけましたら、上記リポジトリにてお気軽に <a href="https://github.com/yasslab/railsguides.jp/issues">Issue</a> を出して頂けると大変嬉しいです。また、「Pull Request を送りたい!」という場合には、<a href="ruby_on_rails_guides_guidelines.html">Ruby on Railsガイドのガイドライン</a>と、<a href="https://github.com/yasslab/railsguides.jp#%E7%BF%BB%E8%A8%B3%E3%81%AE%E6%B5%81%E3%82%8C">README</a>に記載されている「翻訳の流れ」をご参考にしてください。
	</p>
	<p>
	  なお、原著レベルでの間違いを見つけましたら、原著へのフィードバック方法 (<a href="http://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">documentation contributions</a>) をご参考にしてください。
        </p>
        <p>
	  本ガイドの品質向上に向けて、皆さまのご協力が得られれば幸いです。よろしくお願い致します。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <ol class="snsb" style="margin-left: 13px">
	<li><a href="http://www.railscp.org/text/" target="_blank"><img src="images/railscp_logo.png" width="150px"/></a></li>
      </ol>
      <ol class="snsb" style="margin-left: 13px">
	<li><iframe src="http://ghbtns.com/github-btn.html?user=yasslab&repo=railsguides.jp&type=watch&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="80" height="20"></iframe></li>
	<li><a href="http://b.hatena.ne.jp/entry/railsguides.jp" class="hatena-bookmark-button" data-hatena-bookmark-title="Ruby on Rails ガイド：体系的に Rails を学ぼう (Rails 4.2 対応)" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script></li>
	<li><div class="fb-like" data-href="http://railsguides.jp/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div></li>
	<li><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://railsguides.jp/" data-text="Ruby on Rails ガイド：体系的に Rails を学ぼう (Rails 4.2 対応)" data-lang="ja" data-hashtags="Railsガイド" width="100">ツイート</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></li>
      </ol>
      <ol class="snsb" style="margin-left: 13px">
	<li>本ガイドは<a href="https://creativecommons.org/licenses/by-sa/4.0/deed.ja">クリエイティブ・コモンズ 表示-継承 4.0 国際</a> (CC BY-SA 4.0) ライセンスに基づいて公開されています。</li>
	<li>「Rails」および「Ruby on Rails」という名称、そして Rails のロゴは、David Heinemeier Hansson による登録商標で、すべての権利を有しています。</li>
      </ol>
    </div>
  </div>
</h5>
  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all();
    $(guidesIndex.bind);
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
    ga('create', 'UA-50163209-4', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
