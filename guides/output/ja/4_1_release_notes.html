<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
  <head>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport"    content="width=device-width, initial-scale=1"/>
    <meta name="description" content="Rails ガイドは、Ruby on Rails Guides に基づいた Rails 4.2 対応のリファレンスガイドです。Rails 開発で生産性を向上する方法や、各部品がどのように連携しているかなどを体系的に理解する上で役に立ちます。" />
    <meta name="keywords"    content="Ruby Rails ガイド 体系的 入門 無料" />
    <meta name="author"      content="Ruby on Rails Community" />

    <meta property="fb:admins"      content="715330868" />
    <meta property="og:title"       content="Ruby on Rails ガイド：体系的に Rails を学ぼう"/>
    <meta property="og:site_name"   content="Ruby on Rails ガイド：体系的に Rails を学ぼう"/>
    <meta property="og:image"       content="http://railsguides.jp/images/cover_for_facebook.png"/>
    <meta property="og:url"         content="http://railsguides.jp/" />
    <meta property="og:type"        content="article" />
    <meta property="og:description" content="Rails ガイドは、Ruby on Rails Guides に基づいた Rails 4.2 対応のリファレンスガイドです。Rails 開発で生産性を向上する方法や、各部品がどのように連携しているかなどを体系的に理解する上で役に立ちます。" />

    <meta name="twitter:card"  content="summary" />
    <meta name="twitter:site"  content="@RailsGuidesJP" />
    <meta name="twitter:title" content="Ruby on Rails ガイド：体系的に Rails を学ぼう" />
    <meta name="twitter:description" content="Rails ガイドは、Ruby on Rails Guides に基づいた Rails 4.2 対応のリファレンスガイドです。Rails 開発で生産性を向上する方法や、各部品がどのように連携しているかなどを体系的に理解する上で役に立ちます。" />
    <meta name="twitter:image" content="http://railsguides.jp/images/cover_for_twitter.png" />
    <meta name="twitter:url"   content="http://railsguides.jp/" />

    <title>Ruby on Rails 4.1 リリースノート — Rails ガイド</title>
    <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
    <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

    <link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

    <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />

    <link rel="apple-touch-icon" sizes="57x57" href="images/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="images/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="images/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="images/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="images/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="images/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="images/favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="images/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicons/favicon-16x16.png">
    <link rel="manifest" href="images/favicons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="images/favicons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

  </head>
<body class="guide">
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=614116885378153&version=v2.0";
    fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">関連サイト: </strong>
      <span class="red-button more-info-button">関連URL</span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://guides.rubyonrails.org/">原著 (英語)</a></li>
        <li class="more-info"><a href="https://github.com/yasslab/railsguides.jp">ソースコード (GitHub)</a></li>
        <li class="more-info"><a href="http://railstutorial.jp/">Rails チュートリアル</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="/" title="Return to home page">railsguides.jp</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="/">ホーム</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">ガイド目次</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>はじめに</dt>
                <dd><a href="getting_started.html">Rails をはじめよう</a></dd>
                <dt>モデル</dt>
                <dd><a href="active_record_basics.html">Active Record の基礎</a></dd>
                <dd><a href="active_record_migrations.html">Active Record マイグレーション</a></dd>
                <dd><a href="active_record_validations.html">Active Record バリデーション</a></dd>
                <dd><a href="active_record_callbacks.html">Active Record コールバック</a></dd>
                <dd><a href="association_basics.html">Active Record の関連付け</a></dd>
                <dd><a href="active_record_querying.html">Active Record クエリインターフェイス</a></dd>
                <dd><a href="active_model_basics.html">Active Model の基礎</a></dd>
                <dt>ビュー</dt>
                <dd><a href="action_view_overview.html">Action View の概要</a></dd>
                <dd><a href="layouts_and_rendering.html">レイアウトとレンダリング</a></dd>
                <dd><a href="form_helpers.html">Action View フォームヘルパー</a></dd>
                <dt>コントローラ</dt>
                <dd><a href="action_controller_overview.html">Action Controller の概要</a></dd>
                <dd><a href="routing.html">Rails ルーティング</a></dd>
              </dl>
              <dl class="R">
                <dt>高度なトピック</dt>
                <dd><a href="active_support_core_extensions.html">Active Support コア拡張機能</a></dd>
                <dd><a href="i18n.html">Rails 国際化 (i18n) API</a></dd>
                <dd><a href="action_mailer_basics.html">Action Mailer の基礎</a></dd>
                <dd><a href="active_job_basics.html">Active Job の基礎</a></dd>
                <dd><a href="testing.html">Rails テスティングガイド</a></dd>
                <dd><a href="security.html">Rails セキュリティガイド</a></dd>
                <dd><a href="debugging_rails_applications.html">Rails アプリケーションのデバッグ</a></dd>
                <dd><a href="configuring.html">Rails アプリケーションを設定する</a></dd>
                <dd><a href="command_line.html">コマンドラインツールと Rake タスク</a></dd>
                <dd><a href="asset_pipeline.html">アセットパイプライン</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">Rails で JavaScript を使用する</a></dd>
                <dd><a href="engines.html">Rails エンジン入門</a></dd>
                <dd><a href="initialization.html">Rails の初期化プロセス</a></dd>
                <dd><a href="constant_autoloading_and_reloading.html">定数の自動読み込みと再読み込み</a></dd>
                <dt>Rails を拡張する</dt>
                <dd><a href="plugins.html">Rails プラグイン作成入門</a></dd>
                <dd><a href="rails_on_rack.html">Rails と Rack</a></dd>
                <dd><a href="generators.html">Rails ジェネレータとテンプレート入門</a></dd>
                <dt>Ruby on Rails に貢献する</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails [未着手]</a></dd>
                <dd><a href="api_documentation_guidelines.html">APIドキュメント作成ガイドライン</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">Rails ガイドのガイドライン</a></dd>
                <dt>メンテナンスポリシー</dt>
                <dd><a href="maintenance_policy.html">メンテナンスポリシー</a></dd>
                <dt>リリースノート</dt>
                <dd><a href="upgrading_ruby_on_rails.html">Rails アップグレードガイド</a></dd>
                <dd><a href="4_2_release_notes.html">Ruby on Rails 4.2 リリースノート</a></dd>
                <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1 リリースノート</a></dd>
                <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0 リリースノート</a></dd>
                <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes [未着手]</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes [未着手]</a></dd>
                <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes [未着手]</a></dd>
                <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes [未着手]</a></dd>
                <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes [未着手]</a></dd>
              </dl>
          </div>
        </li>
        <li><a class="nav-item" href="https://github.com/yasslab/railsguides.jp#readme">翻訳に貢献する</a></li>
        <li><a class="nav-item" href="credits.html">原著者</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">ガイド目次</option>
              <optgroup label="はじめに">
                  <option value="getting_started.html">Rails をはじめよう</option>
              </optgroup>
              <optgroup label="モデル">
                  <option value="active_record_basics.html">Active Record の基礎</option>
                  <option value="active_record_migrations.html">Active Record マイグレーション</option>
                  <option value="active_record_validations.html">Active Record バリデーション</option>
                  <option value="active_record_callbacks.html">Active Record コールバック</option>
                  <option value="association_basics.html">Active Record の関連付け</option>
                  <option value="active_record_querying.html">Active Record クエリインターフェイス</option>
                  <option value="active_model_basics.html">Active Model の基礎</option>
              </optgroup>
              <optgroup label="ビュー">
                  <option value="action_view_overview.html">Action View の概要</option>
                  <option value="layouts_and_rendering.html">レイアウトとレンダリング</option>
                  <option value="form_helpers.html">Action View フォームヘルパー</option>
              </optgroup>
              <optgroup label="コントローラ">
                  <option value="action_controller_overview.html">Action Controller の概要</option>
                  <option value="routing.html">Rails ルーティング</option>
              </optgroup>
              <optgroup label="高度なトピック">
                  <option value="active_support_core_extensions.html">Active Support コア拡張機能</option>
                  <option value="i18n.html">Rails 国際化 (i18n) API</option>
                  <option value="action_mailer_basics.html">Action Mailer の基礎</option>
                  <option value="active_job_basics.html">Active Job の基礎</option>
                  <option value="testing.html">Rails テスティングガイド</option>
                  <option value="security.html">Rails セキュリティガイド</option>
                  <option value="debugging_rails_applications.html">Rails アプリケーションのデバッグ</option>
                  <option value="configuring.html">Rails アプリケーションを設定する</option>
                  <option value="command_line.html">コマンドラインツールと Rake タスク</option>
                  <option value="asset_pipeline.html">アセットパイプライン</option>
                  <option value="working_with_javascript_in_rails.html">Rails で JavaScript を使用する</option>
                  <option value="engines.html">Rails エンジン入門</option>
                  <option value="initialization.html">Rails の初期化プロセス</option>
                  <option value="constant_autoloading_and_reloading.html">定数の自動読み込みと再読み込み</option>
              </optgroup>
              <optgroup label="Rails を拡張する">
                  <option value="plugins.html">Rails プラグイン作成入門</option>
                  <option value="rails_on_rack.html">Rails と Rack</option>
                  <option value="generators.html">Rails ジェネレータとテンプレート入門</option>
              </optgroup>
              <optgroup label="Ruby on Rails に貢献する">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails [未着手]</option>
                  <option value="api_documentation_guidelines.html">APIドキュメント作成ガイドライン</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Rails ガイドのガイドライン</option>
              </optgroup>
              <optgroup label="メンテナンスポリシー">
                  <option value="maintenance_policy.html">メンテナンスポリシー</option>
              </optgroup>
              <optgroup label="リリースノート">
                  <option value="upgrading_ruby_on_rails.html">Rails アップグレードガイド</option>
                  <option value="4_2_release_notes.html">Ruby on Rails 4.2 リリースノート</option>
                  <option value="4_1_release_notes.html">Ruby on Rails 4.1 リリースノート</option>
                  <option value="4_0_release_notes.html">Ruby on Rails 4.0 リリースノート</option>
                  <option value="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes [未着手]</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes [未着手]</option>
                  <option value="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes [未着手]</option>
                  <option value="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes [未着手]</option>
                  <option value="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes [未着手]</option>
              </optgroup>
          </select>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Ruby on Rails 4.1 リリースノート</h2><p>Rails 4.1の注目ポイント</p>
<ul>
<li>アプリケーションプリローダーSpring</li>
<li><code>config/secrets.yml</code></li>
<li>Action Packのバリアント</li>
<li>Action Mailerプレビュー</li>
</ul>
<p>本リリースノートでは、主要な変更についてのみ説明します。細かなバグ修正や変更については、change logを参照するか、Githubの主要なRailsリポジトリにある<a href="https://github.com/rails/rails/commits/master">コミットリスト</a> を参照してください</p>
                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />目次</h3>
            <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<ol class="chapters">
<li><a href="#rails-4.1%E3%81%B8%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89">Rails 4.1へのアップグレード</a></li>
<li>
<a href="#%E4%B8%BB%E8%A6%81%E3%81%AA%E5%A4%89%E6%9B%B4">主要な変更</a>

<ul>
<li><a href="#%E3%80%8Cspring%E3%80%8D%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%97%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%80%E3%83%BC">「Spring」アプリケーションプリローダー</a></li>
<li><a href="#config/secrets.yml"><code>config/secrets.yml</code></a></li>
<li><a href="#action-pack-variant">Action Pack Variant</a></li>
<li><a href="#action-mailer%E3%83%97%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC">Action Mailerプレビュー</a></li>
<li><a href="#active-record-enums">Active Record enums</a></li>
<li><a href="#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%83%99%E3%83%AA%E3%83%95%E3%82%A1%E3%82%A4%E3%82%A2">メッセージベリファイア</a></li>
<li><a href="#module#concerning">Module#concerning</a></li>
<li><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88-%3Cscript%3E-%E3%82%BF%E3%82%B0%E3%81%ABcsrf%E4%BF%9D%E8%AD%B7%E3%82%92%E5%AE%9F%E6%96%BD">リモート <code>&lt;script&gt;</code> タグにCSRF保護を実施</a></li>
</ul>
</li>
<li>
<a href="#railties">Railties</a>

<ul>
<li><a href="#railties-%E5%89%8A%E9%99%A4%E3%81%95%E3%82%8C%E3%81%9F%E3%82%82%E3%81%AE">削除されたもの</a></li>
<li><a href="#railties-%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9">主な変更点</a></li>
</ul>
</li>
<li>
<a href="#action-pack">Action Pack</a>

<ul>
<li><a href="#action-pack-%E5%89%8A%E9%99%A4%E3%81%95%E3%82%8C%E3%81%9F%E3%82%82%E3%81%AE">削除されたもの</a></li>
<li><a href="#action-pack-%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9">主な変更点</a></li>
</ul>
</li>
<li>
<a href="#action-mailer">Action Mailer</a>

<ul>
<li><a href="#action-mailer-%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9">主な変更点</a></li>
</ul>
</li>
<li>
<a href="#active-record">Active Record</a>

<ul>
<li><a href="#active-record-%E5%89%8A%E9%99%A4%E3%81%95%E3%82%8C%E3%81%9F%E3%82%82%E3%81%AE">削除されたもの</a></li>
<li><a href="#active-record-%E9%9D%9E%E6%8E%A8%E5%A5%A8">非推奨</a></li>
<li><a href="#active-record-%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9">主な変更点</a></li>
</ul>
</li>
<li>
<a href="#active-model">Active Model</a>

<ul>
<li><a href="#active-model-%E9%9D%9E%E6%8E%A8%E5%A5%A8">非推奨</a></li>
<li><a href="#active-model-%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9">主な変更点</a></li>
</ul>
</li>
<li>
<a href="#active-support">Active Support</a>

<ul>
<li><a href="#active-support-%E5%89%8A%E9%99%A4%E3%81%95%E3%82%8C%E3%81%9F%E3%82%82%E3%81%AE">削除されたもの</a></li>
<li><a href="#%E9%9D%9E%E6%8E%A8%E5%A5%A8">非推奨</a></li>
<li><a href="#active-support-%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9">主な変更点</a></li>
</ul>
</li>
<li><a href="#%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E8%A1%A8%E8%A8%98">クレジット表記</a></li>
</ol>
</body></html>

          </div>
</div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h3 id="rails-4.1へのアップグレード"><a href="#rails-4.1%E3%81%B8%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89">1 Rails 4.1へのアップグレード</a></h3>
<p>既存のアプリケーションをアップグレードするのであれば、その前に質のよいテストカバレッジを用意するのがよい考えです。アプリケーションがRails 4.0までアップグレードされていない場合は先にそれを完了し、アプリケーションが正常に動作することを十分確認してからRails 4.1にアップデートしてください。アップグレードの注意点などについては<a href="upgrading_ruby_on_rails.html#rails-4.0%E3%81%8B%E3%82%89rails-4.1%E3%81%B8%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89">Ruby on Railsアップグレードガイド</a> を参照してください。</p>
<h3 id="主要な変更"><a href="#%E4%B8%BB%E8%A6%81%E3%81%AA%E5%A4%89%E6%9B%B4">2 主要な変更</a></h3>
<h4 id="「spring」アプリケーションプリローダー"><a href="#%E3%80%8Cspring%E3%80%8D%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%97%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%80%E3%83%BC">2.1 「Spring」アプリケーションプリローダー</a></h4>
<p>SpringはRailsアプリケーション用のプリローダーです。アプリケーションをバックグラウンドで常駐させることで開発速度を向上させ、テストやrakeタスク、マイグレーションを実行するたびにRailsを起動しないで済むようにします。</p>
<p>Rails 4.1アプリケーションに含まれるbinstubは「spring化」されています。これは、アプリケーションのルートディレクトリで<code>bin/rails</code>および<code>bin/rake</code>を実行すると自動的にspring環境をプリロードするということです。</p>
<p><strong>rakeタスクの実行:</strong></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
bin/rake test:models

</pre>
</div>
<p><strong>Railsコマンドの実行:</strong></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
bin/rails console

</pre>
</div>
<p><strong>Springの状態確認:</strong></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
$ bin/spring status
Spring is running:

1182 spring server | my_app | started 29 mins ago
3656 spring app    | my_app | started 23 secs ago | test mode
3746 spring app    | my_app | started 10 secs ago | development mode

</pre>
</div>
<p>Springのすべての機能については<a href="https://github.com/rails/spring/blob/master/README.md">Spring README</a>を参照してください。</p>
<p><a href="upgrading_ruby_on_rails.html#spring">Ruby on Railsアップグレードガイド</a>には、この機能を既存のアプリケーションと統合する方法について記載されています。</p>
<h4 id="config/secrets.yml"><a href="#config/secrets.yml">2.2 <code>config/secrets.yml</code></a></h4>
<p>Rails 4.1では<code>config</code>フォルダ内に新しく<code>secrets.yml</code>ファイルが生成されます。デフォルトでは、このファイルにはアプリケーションの<code>secret_key_base</code>が含まれていますが、外部API用のアクセスキーなどの秘密キーもここに保存できます。</p>
<p>このファイルに保存された秘密キーは<code>Rails.application.secrets</code>を使用してアクセスできます。
たとえば、以下の<code>config/secrets.yml</code>について見てみましょう。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
development:
  secret_key_base: 3b7cd727ee24e8444053437c36cc66c3
  some_api_key: SOMEKEY

</pre>
</div>
<p>上の設定にした場合、development環境で<code>Rails.application.secrets.some_api_key</code>を実行すると<code>SOMEKEY</code>が返されます。</p>
<p>既存のアプリケーションにこの機能を統合する方法については<a href="upgrading_ruby_on_rails.html#config/secrets.yml">Ruby on Railsアップグレードガイド</a>を参照してください。</p>
<h4 id="action-pack-variant"><a href="#action-pack-variant">2.3 Action Pack Variant</a></h4>
<p>スマートフォン、タブレット、デスクトップブラウザごとに異なるHTML/JSON/XMLテンプレートを使いたいことはよくあります。Variantを使用することで、これを簡単に実現できます。</p>
<p>リクエストvariantは、<code>:tablet</code>、<code>:phone</code>、<code>:desktop</code>のようなリクエストフォーマットを特殊化したものです。</p>
<p><code>before_action</code>で以下のvariantを設定できます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
request.variant = :tablet if request.user_agent =~ /iPad/

</pre>
</div>
<p>アクションの側では、フォーマットへの応答と同じ要領でvariantに応答します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
respond_to do |format|
  format.html do |html|
    html.tablet # renders app/views/projects/show.html+tablet.erb
    html.phone { extra_setup; render ... }
  end
end

</pre>
</div>
<p>フォーマットごと、variantごとに個別のテンプレートを用意してください。</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
app/views/projects/show.html.erb
app/views/projects/show.html+tablet.erb
app/views/projects/show.html+phone.erb

</pre>
</div>
<p>以下のようなインライン文法を使用することで、variant定義を簡略化することもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
respond_to do |format|
  format.js         { render "trash" }
  format.html.phone { redirect_to progress_path }
  format.html.none  { render "trash" }
end

</pre>
</div>
<h4 id="action-mailerプレビュー"><a href="#action-mailer%E3%83%97%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC">2.4 Action Mailerプレビュー</a></h4>
<p>Action Mailerプレビューは、特定のURLにアクセスすることで、送信されるメールがどんなふうに見えるかをレンダリングしてプレビューします。</p>
<p>チェックしたいメールオブジェクトを返すメソッドを持つプレビュークラスを定義してください。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class NotifierPreview &lt; ActionMailer::Preview
  def welcome
    Notifier.welcome(User.first)
  end
end

</pre>
</div>
<p>プレビューを表示するには <a href="http://localhost:3000/rails/mailers/notifier/welcome">http://localhost:3000/rails/mailers/notifier/welcome</a> にアクセスします。プレビューのリストは <a href="http://localhost:3000/rails/mailers">http://localhost:3000/rails/mailers</a> にあります。</p>
<p>デフォルトのプレビュークラスは<code>test/mailers/previews</code>に置かれます。
<code>preview_path</code>オプションを変更することでこれを変更できます。</p>
<p>詳細については<a href="http://api.rubyonrails.org/v4.1.0/classes/ActionMailer/Base.html">ドキュメント</a>を参照してください。</p>
<h4 id="active-record-enums"><a href="#active-record-enums">2.5 Active Record enums</a></h4>
<p>データベースで値をintegerにマップしたい場所でenum属性を宣言しますが、名前でクエリを発行することもできます。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Conversation &lt; ActiveRecord::Base
  enum status: [ :active, :archived ]
end

conversation.archived!
conversation.active? # =&gt; false
conversation.status  # =&gt; "archived"

Conversation.archived # =&gt; Relation for all archived Conversations

Conversation.statuses # =&gt; { "active" =&gt; 0, "archived" =&gt; 1 }

</pre>
</div>
<p>詳細については<a href="http://api.rubyonrails.org/v4.1.0/classes/ActiveRecord/Enum.html">マニュアル</a>を参照してください。</p>
<h4 id="メッセージベリファイア"><a href="#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%83%99%E3%83%AA%E3%83%95%E3%82%A1%E3%82%A4%E3%82%A2">2.6 メッセージベリファイア</a></h4>
<p>メッセージベリファイア (message verifier) は、署名付きメッセージの生成と照合に使用できます。この機能は、「パスワードを保存 (remember me)」トークンや友人リストのような機密データを安全に転送するときに便利です。</p>
<p><code>Rails.application.message_verifier</code>メソッドは、 secret_key_baseを使用して生成されたキーで署名された新しいメッセージベリファイアと、与えられたメッセージ照合名を返します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
signed_token = Rails.application.message_verifier(:remember_me).generate(token)
Rails.application.message_verifier(:remember_me).verify(signed_token) # =&gt; token

Rails.application.message_verifier(:remember_me).verify(tampered_token)
# ActiveSupport::MessageVerifier::InvalidSignatureをはっせいする

</pre>
</div>
<h4 id="module#concerning"><a href="#module#concerning">2.7 Module#concerning</a></h4>
<p>自然かつ堅苦しくない方法で、クラスから責任を分離します。</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Todo &lt; ActiveRecord::Base
  concerning :EventTracking do
    included do
      has_many :events
    end

    def latest_event
      ...
    end

    private
      def some_internal_method
        ...
      end
  end
end

</pre>
</div>
<p>この例は、<code>EventTracking</code>モジュールをインラインで定義し、<code>ActiveSupport::Concern</code>でextendし、<code>Todo</code>クラスにミックスインしたのと同等です。</p>
<p>詳細および想定されるユースケースについては<a href="http://api.rubyonrails.org/v4.1.0/classes/Module/Concerning.html">マニュアル</a> を参照してください。</p>
<h4 id="リモート-&lt;script&gt;-タグにcsrf保護を実施"><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88-&lt;script&gt;-%E3%82%BF%E3%82%B0%E3%81%ABcsrf%E4%BF%9D%E8%AD%B7%E3%82%92%E5%AE%9F%E6%96%BD">2.8 リモート <code>&lt;script&gt;</code> タグにCSRF保護を実施</a></h4>
<p>JavaScriptレスポンスを伴うGETリクエストもクロスサイトリクエストフォージェリ (CSRF) 保護の対象となりました。この保護によって、第三者のサイトが重要なデータの奪取のために自分のサイトのJavaScript URLを参照して実行しようとすることを防止します。</p>
<p>これは、xhr<code>を使用しない場合、</code>.js<code>URLにヒットするすべてのテストはCSRF保護によって失敗するということです。</code>XmlHttpRequestsを明示的に想定するようにテストをアップグレードしてください。<code>post :create, format: :js</code>の代りに、明示的に<code>xhr :post, :create, format: :js</code>を使用してください。</p>
<h3 id="railties"><a href="#railties">3 Railties</a></h3>
<p>変更の詳細については<a href="https://github.com/rails/rails/blob/4-1-stable/railties/CHANGELOG.md">Changelog</a> を参照してください。</p>
<h4 id="railties-削除されたもの"><a href="#railties-%E5%89%8A%E9%99%A4%E3%81%95%E3%82%8C%E3%81%9F%E3%82%82%E3%81%AE">3.1 削除されたもの</a></h4>
<ul>
<li><p><code>update:application_controller</code> rake taskが削除されました。</p></li>
<li><p>非推奨の<code>Rails.application.railties.engines</code>が除外されました。</p></li>
<li><p>非推奨の<code>threadsafe!</code>がRails Configから削除されました。</p></li>
<li><p>非推奨の<code>ActiveRecord::Generators::ActiveModel#update_attributes</code>が削除されました。<code>ActiveRecord::Generators::ActiveModel#update</code>をご使用ください。</p></li>
<li><p>非推奨の<code>config.whiny_nils</code>オプションが削除されました。</p></li>
<li><p>非推奨のテスト実行rakeタスク<code>rake test:uncommitted</code>および<code>rake test:recent</code>が削除されました。</p></li>
</ul>
<h4 id="railties-主な変更点"><a href="#railties-%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9">3.2 主な変更点</a></h4>
<ul>
<li><p><a href="https://github.com/rails/spring">Springアプリケーションプリローダー</a> は新規アプリケーションにデフォルトでインストールされます。Gemfileのdevelopグループにインストールされ、productionグループにはインストールされません。(<a href="https://github.com/rails/rails/pull/12958">Pull Request</a>)</p></li>
<li><p>テスト失敗時にフィルタされていないバックトレースを表示する<code>BACKTRACE</code>環境変数。(<a href="https://github.com/rails/rails/commit/84eac5dab8b0fe9ee20b51250e52ad7bfea36553">Commit</a>)</p></li>
<li><p><code>MiddlewareStack#unshift</code>が環境構成用に公開されました。(<a href="https://github.com/rails/rails/pull/12479">Pull Request</a>)</p></li>
<li><p>メッセージベリファイアを返す<code>Application#message_verifier</code>メソッド。(<a href="https://github.com/rails/rails/pull/12995">Pull Request</a>)</p></li>
<li><p>デフォルトで生成されるテストヘルパーでrequireされる<code>test_help.rb</code>ファイルは、<code>db/schema.rb</code> (または <code>db/structure.sql</code>) を使用して自動的にテストデータベースを最新の状態に保ちます。スキーマを再度読み込んでもペンディング中のマイグレーションをすべて解決できなかった場合はエラーが発生します。<code>config.active_record.maintain_test_schema = false</code>を指定することでエラーを回避できます。(<a href="https://github.com/rails/rails/pull/13528">Pull Request</a>)</p></li>
<li><p><code>Gem::Version.new(Rails.version)</code>を返す便利なメソッドとして<code>Rails.gem_version</code>が導入されました。より信頼できるバージョン比較法を提供します。(<a href="https://github.com/rails/rails/pull/14103">Pull Request</a>)</p></li>
</ul>
<h3 id="action-pack"><a href="#action-pack">4 Action Pack</a></h3>
<p>変更の詳細については<a href="https://github.com/rails/rails/blob/4-1-stable/actionpack/CHANGELOG.md">Changelog</a> を参照してください。</p>
<h4 id="action-pack-削除されたもの"><a href="#action-pack-%E5%89%8A%E9%99%A4%E3%81%95%E3%82%8C%E3%81%9F%E3%82%82%E3%81%AE">4.1 削除されたもの</a></h4>
<ul>
<li><p>非推奨の、結合テスト用Railsアプリケーションフォールバックが削除されました。<code>ActionDispatch.test_app</code>を代りにご使用ください。</p></li>
<li><p>非推奨の<code>page_cache_extension</code> configが削除されました。</p></li>
<li><p>非推奨の<code>ActionController::RecordIdentifier</code>が削除されました。<code>ActionView::RecordIdentifier</code>を代りにご使用ください。</p></li>
<li><p>以下の非推奨の定数がAction Controllerから削除されました。</p></li>
</ul>

<table>
<thead>
<tr>
<th style="text-align: left">削除された</th>
<th style="text-align: left">今後使用する</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">ActionController::AbstractRequest</td>
<td style="text-align: left">ActionDispatch::Request</td>
</tr>
<tr>
<td style="text-align: left">ActionController::Request</td>
<td style="text-align: left">ActionDispatch::Request</td>
</tr>
<tr>
<td style="text-align: left">ActionController::AbstractResponse</td>
<td style="text-align: left">ActionDispatch::Response</td>
</tr>
<tr>
<td style="text-align: left">ActionController::Response</td>
<td style="text-align: left">ActionDispatch::Response</td>
</tr>
<tr>
<td style="text-align: left">ActionController::Routing</td>
<td style="text-align: left">ActionDispatch::Routing</td>
</tr>
<tr>
<td style="text-align: left">ActionController::Integration</td>
<td style="text-align: left">ActionDispatch::Integration</td>
</tr>
<tr>
<td style="text-align: left">ActionController::IntegrationTest</td>
<td style="text-align: left">ActionDispatch::IntegrationTest</td>
</tr>
</tbody>
</table>
<h4 id="action-pack-主な変更点"><a href="#action-pack-%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9">4.2 主な変更点</a></h4>
<ul>
<li><p><code>protect_from_forgery</code>によって、クロスオリジン<code>&lt;script&gt;</code>タグも使用できなくなりました。テストをアップデートして、 <code>get :foo, format: :js</code>の代りに<code>xhr :get, :foo, format: :js</code>を使うようにしてください。(<a href="https://github.com/rails/rails/pull/13345">Pull Request</a>)</p></li>
<li><p><code>#url_for</code>は、オプションのハッシュを配列の中で使用できるようになりました。(<a href="https://github.com/rails/rails/pull/9599">Pull Request</a>)</p></li>
<li><p><code>session#fetch</code>メソッドが追加されました。この振る舞いは<a href="http://www.ruby-doc.org/core-1.9.3/Hash.html#method-i-fetch">Hash#fetch</a>と似ていますが、戻り値が常にセッションに保存される点が異なります。(<a href="https://github.com/rails/rails/pull/12692">Pull Request</a>)</p></li>
<li><p>Action ViewはAction Packから完全に分離されました。(<a href="https://github.com/rails/rails/pull/11032">Pull Request</a>)</p></li>
<li><p>deep_mungeに影響されているキーがログ出力されるようになりました。(<a href="https://github.com/rails/rails/pull/13813">Pull Request</a>)</p></li>
<li><p>セキュリティ脆弱性CVE-2013-0155に対応するため、パラメータのdeep_munge化を回避する<code>config.action_dispatch.perform_deep_munge</code>configオプションが新たに追加されました。(<a href="https://github.com/rails/rails/pull/13188">Pull Request</a>)</p></li>
<li><p>署名及び暗号化されたcookies jarのシリアライザを指定する<code>config.action_dispatch.cookies_serializer</code>configオプションが新たに追加されました。 (Pull Requests <a href="https://github.com/rails/rails/pull/13692">1</a>, <a href="https://github.com/rails/rails/pull/13945">2</a> / <a href="upgrading_ruby_on_rails.html#cookies%E3%82%B7%E3%83%AA%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%B6">詳細</a>)</p></li>
<li><p><code>render :plain</code>、<code>render :html</code>、<code>render :body</code>が追加されました。(<a href="https://github.com/rails/rails/pull/14062">Pull Request</a> / <a href="upgrading_ruby_on_rails.html#%E6%96%87%E5%AD%97%E5%88%97%E3%81%8B%E3%82%89%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E6%8F%8F%E5%87%BA">詳細</a>)</p></li>
</ul>
<h3 id="action-mailer"><a href="#action-mailer">5 Action Mailer</a></h3>
<p>変更の詳細については<a href="https://github.com/rails/rails/blob/4-1-stable/actionmailer/CHANGELOG.md">Changelog</a> を参照してください。</p>
<h4 id="action-mailer-主な変更点"><a href="#action-mailer-%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9">5.1 主な変更点</a></h4>
<ul>
<li><p>37 Signals社のmail_view gemを元にメイラーのプレビュー機能が追加されました。(<a href="https://github.com/rails/rails/commit/d6dec7fcb6b8fddf8c170182d4fe64ecfc7b2261">Commit</a>)</p></li>
<li><p>Action Mailerメッセージの生成が計測されるようになりました。メッセージを生成するのにかかった時間がログに記録されます。(<a href="https://github.com/rails/rails/pull/12556">Pull Request</a>)</p></li>
</ul>
<h3 id="active-record"><a href="#active-record">6 Active Record</a></h3>
<p>変更の詳細については<a href="https://github.com/rails/rails/blob/4-1-stable/activerecord/CHANGELOG.md">Changelog</a> を参照してください。</p>
<h4 id="active-record-削除されたもの"><a href="#active-record-%E5%89%8A%E9%99%A4%E3%81%95%E3%82%8C%E3%81%9F%E3%82%82%E3%81%AE">6.1 削除されたもの</a></h4>
<ul>
<li><p><code>SchemaCache</code>メソッド (<code>primary_keys</code>、<code>tables</code>、<code>columns</code>、<code>columns_hash</code>) にnilを渡す非推奨機能が削除されました。</p></li>
<li><p>非推奨のブロックフィルタが<code>ActiveRecord::Migrator#migrate</code>から削除されました。</p></li>
<li><p>非推奨のStringコンストラクタが<code>ActiveRecord::Migrator</code>から削除されました。</p></li>
<li><p><code>scope</code>で呼び出し可能オブジェクトを渡さない用法が削除されました。</p></li>
<li><p>非推奨の<code>transaction_joinable=</code>が削除されました。<code>:joinable</code>オプション付きで<code>begin_transaction</code>をお使いください。</p></li>
<li><p>非推奨の<code>decrement_open_transactions</code>が削除されました。</p></li>
<li><p>非推奨の<code>increment_open_transactions</code>が削除されました。</p></li>
<li><p>非推奨の<code>PostgreSQLAdapter#outside_transaction?</code>メソッドが削除されました。代りに<code>#transaction_open?</code>をお使いください。</p></li>
<li><p>非推奨の<code>ActiveRecord::Fixtures.find_table_name</code>が削除されました。<code>ActiveRecord::Fixtures.default_fixture_model_name</code>をお使いください。</p></li>
<li><p>非推奨の<code>columns_for_remove</code>が<code>SchemaStatements</code>削除されました。</p></li>
<li><p>非推奨の<code>SchemaStatements#distinct</code>が削除されました。</p></li>
<li><p>非推奨の<code>ActiveRecord::TestCase</code>がRailsテストスイートに移動しました。このクラスはpublicでなくなり、Railsテストの内部でのみ使用されます。</p></li>
<li><p>関連付けの<code>:dependent</code>で、非推奨の<code>:restrict</code>オプションのサポートが削除されました。</p></li>
<li><p>関連付けにおいて、非推奨の<code>:delete_sql</code>、<code>:insert_sql</code>、<code>:finder_sql</code>、<code>:counter_sql</code>オプションが削除されました。</p></li>
<li><p>Columnから非推奨の<code>type_cast_code</code>が削除されました。</p></li>
<li><p>非推奨の<code>ActiveRecord::Base#connection</code>メソッドが削除されました。このメソッドにはクラス経由でアクセスするようにしてください。</p></li>
<li><p><code>auto_explain_threshold_in_seconds</code>における非推奨の警告が削除されました。</p></li>
<li><p><code>Relation#count</code>から非推奨の<code>:distinct</code>オプションが削除されました。</p></li>
<li><p>非推奨の<code>partial_updates</code>、<code>partial_updates?</code>、<code>partial_updates=</code>が削除されました。</p></li>
<li><p>非推奨の<code>scoped</code>メソッドが削除されました。</p></li>
<li><p>非推奨の<code>default_scopes?</code>が削除されました。</p></li>
<li><p>4.0で非推奨だった、暗黙の結合参照が削除されました。</p></li>
<li><p>依存関係としての<code>activerecord-deprecated_finders</code>が削除されました。詳細については<a href="https://github.com/rails/activerecord-deprecated_finders#active-record-deprecated-finders">gem README</a>を参照してください。</p></li>
<li><p><code>implicit_readonly</code>の用法が削除されました。明示的に<code>readonly</code>メソッドを使用してレコードを<code>readonly</code>に設定してください。(<a href="https://github.com/rails/rails/pull/10769">Pull Request</a>)</p></li>
</ul>
<h4 id="active-record-非推奨"><a href="#active-record-%E9%9D%9E%E6%8E%A8%E5%A5%A8">6.2 非推奨</a></h4>
<ul>
<li><p><code>quoted_locking_column</code>メソッドは非推奨です。現在使われている場所はありません。</p></li>
<li><p><code>ConnectionAdapters::SchemaStatements#distinct</code>は内部で使用されなくなったため非推奨です。(<a href="https://github.com/rails/rails/pull/10556">Pull Request</a>)</p></li>
<li><p><code>rake db:test:*</code>タスクは非推奨となりました。データベースは自動的にメンテナンスされます。railtiesのリリースノートを参照してください。(<a href="https://github.com/rails/rails/pull/13528">Pull Request</a>)</p></li>
<li><p>使用されていない<code>ActiveRecord::Base.symbolized_base_class</code>、および置き換えのない<code>ActiveRecord::Base.symbolized_sti_name</code>は非推奨になりました。<a href="https://github.com/rails/rails/commit/97e7ca48c139ea5cce2fa9b4be631946252a1ebd">Commit</a></p></li>
</ul>
<h4 id="active-record-主な変更点"><a href="#active-record-%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9">6.3 主な変更点</a></h4>
<p>デフォルトのスコープは、条件を連鎖した場合にオーバーライドされなくなりました。</p>
<p>  今回の変更より前にモデルで<code>default_scope</code>を定義していた場合、同じフィールドで条件が連鎖している場合にはオーバーライドされていました。現在は、他のスコープと同様、マージされるようになりました。<a href="upgrading_ruby_on_rails.html#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97%E3%81%AE%E5%A4%89%E6%9B%B4">詳細</a></p>
<ul>
<li><p>モデルの属性やメソッドから派生する便利な "pretty" URL用に<code>ActiveRecord::Base.to_param</code>が追加されました。(<a href="https://github.com/rails/rails/pull/12891">Pull Request</a>)</p></li>
<li><p><code>ActiveRecord::Base.no_touching</code>が追加されました。モデルへのタッチを無視します。(<a href="https://github.com/rails/rails/pull/12772">Pull Request</a>)</p></li>
<li><p><code>MysqlAdapter</code>および<code>Mysql2Adapter</code>における型変換の真偽値が統一されました。<code>type_cast</code>は<code>true</code>の場合に<code>1を、</code>false<code>の場合に</code>2`を返します。(<a href="https://github.com/rails/rails/pull/12425">Pull Request</a>)</p></li>
<li><p><code>.unscope</code>を指定すると<code>default_scope</code>で指定された条件が削除されます。(<a href="https://github.com/rails/rails/commit/94924dc32baf78f13e289172534c2e71c9c8cade">Commit</a>)</p></li>
<li><p><code>ActiveRecord::QueryMethods#rewhere</code>が追加されました。既存の名前付きwhere条件をオーバーライドします。(<a href="https://github.com/rails/rails/commit/f950b2699f97749ef706c6939a84dfc85f0b05f2">Commit</a>)</p></li>
<li><p><code>ActiveRecord::Base#cache_key</code>が拡張され、timestamp属性のリストをオプションで取れるようになりました。timestamp属性リストのうち最大値が使用されます。(<a href="https://github.com/rails/rails/commit/e94e97ca796c0759d8fcb8f946a3bbc60252d329">Commit</a>)</p></li>
<li><p>enum属性を宣言する<code>ActiveRecord::Base#enum</code>が追加されました。enum属性はデータベースのintegerにマップされますが、名前でクエリできます。(<a href="https://github.com/rails/rails/commit/db41eb8a6ea88b854bf5cd11070ea4245e1639c5">Commit</a>)</p></li>
<li><p>json値が書き込み時に型変換されます。これにより値がデータベースからの読み出し時と一貫します。(<a href="https://github.com/rails/rails/pull/12643">Pull Request</a>)</p></li>
<li><p>hstore値が書き込み時に型変換されます。これにより値がデータベースからの読み出し時と一致します。(<a href="https://github.com/rails/rails/commit/5ac2341fab689344991b2a4817bd2bc8b3edac9d">Commit</a>)</p></li>
<li><p>サードパーティ製ジェネレータ用に、<code>next_migration_number</code>がアクセス可能になりました。(<a href="https://github.com/rails/rails/pull/12407">Pull Request</a>)</p></li>
<li><p>引数を<code>nil</code>にして<code>update_attributes</code>を呼び出すと、常に<code>ArgumentError</code>エラーが発生します。具体的には、渡された引数が<code>stringify_keys</code>に応答しない場合にエラーが発生します。(<a href="https://github.com/rails/rails/pull/9860">Pull Request</a>)</p></li>
<li><p><code>CollectionAssociation#first</code>/<code>#last</code> (<code>has_many</code>など) による結果の取り出しで、コレクション全体を読み出すクエリの代りに、限定的なクエリが使用されるようになりました。(<a href="https://github.com/rails/rails/pull/12137">Pull Request</a>)</p></li>
<li><p>Active Recordモデルクラスの<code>inspect</code>は新しい接続を初期化しなくなりました。つまり、データベースが見つからない状態で<code>inspect</code>を呼び出した場合に例外を発生しなくなりました。(<a href="https://github.com/rails/rails/pull/11014">Pull Request</a>)</p></li>
<li><p><code>count</code>のカラム制約が削除されました。SQLが無効な場合にはデータベース側でraiseされます。(<a href="https://github.com/rails/rails/pull/10710">Pull Request</a>)</p></li>
<li><p>Railsが逆関連付けを自動で検出するようになりました。関連付けで<code>:inverse_of</code>オプションを設定していない場合、Active Recordはヒューリスティックに逆関連付けを推測します。(<a href="https://github.com/rails/rails/pull/10886">Pull Request</a>)</p></li>
<li><p>ActiveRecord::Relationの属性のエイリアスを扱うようになりました。シンボルキーを使用すると、ActiveRecordはエイリアス化された属性名をデータベース上の実際のカラム名に翻訳します。(<a href="https://github.com/rails/rails/pull/7839">Pull Request</a>)</p></li>
<li><p>フィクスチャーのERBファイルはメインオブジェクトのコンテキストでは評価されなくなりました。複数のフィクスチャーで使用されているヘルパーメソッドは、<code>ActiveRecord::FixtureSet.context_class</code>でインクルードされるモジュール上で定義しておく必要があります。(<a href="https://github.com/rails/rails/pull/13022">Pull Request</a>)</p></li>
<li><p>RAILS_ENVが明示的に指定されている場合はテストデータベースのcreateやdropは行いません。(<a href="https://github.com/rails/rails/pull/13629">Pull Request</a>)</p></li>
</ul>
<p><code>Relation</code>には<code>#map!</code>や<code>#delete_if</code>などのミューテーターメソッド (mutator method) が含まれなくなりました。これらのメソッドを使用したい場合は<code>#to_a</code>を呼び出して<code>Array</code>に変更してからにしてください。(<a href="https://github.com/rails/rails/pull/13314">Pull Request</a>)</p>
<ul>
<li><p><code>find_in_batches</code>、<code>find_each</code>、<code>Result#each</code> and <code>Enumerable#index_by</code>は、自身のサイズを計算可能な<code>Enumerator</code>を返すようになりました。(<a href="https://github.com/rails/rails/pull/13938">Pull Request</a>)</p></li>
<li><p><code>scope</code>、<code>enum</code>とAssociationsで "dangerous" 名前衝突が発生するようになりました。(<a href="https://github.com/rails/rails/pull/13450">Pull Request</a>, <a href="https://github.com/rails/rails/pull/13896">Pull Request</a>)</p></li>
<li><p><code>second</code>から<code>fifth</code>メソッドは<code>first</code>ファインダーと同様に動作します。(<a href="https://github.com/rails/rails/pull/13757">Pull Request</a>)</p></li>
<li><p><code>touch</code>が<code>after_commit</code>と<code>after_rollback</code>コールバックを発火するようになりました。(<a href="https://github.com/rails/rails/pull/12031">Pull Request</a>)</p></li>
<li><p><code>sqlite &gt;= 3.8.0</code>でのパーシャルインデックスが有効になりました。(<a href="https://github.com/rails/rails/pull/13350">Pull Request</a>)</p></li>
<li><p><code>change_column_null</code>が復元可能になりました。(<a href="https://github.com/rails/rails/commit/724509a9d5322ff502aefa90dd282ba33a281a96">Commit</a>)</p></li>
<li><p>マイグレーション後無効になったスキーマダンプにフラグが追加されました。これは新しいアプリケーションのproduction環境ではデフォルトで<code>false</code>に設定されます。(<a href="https://github.com/rails/rails/pull/13948">Pull Request</a>)</p></li>
</ul>
<h3 id="active-model"><a href="#active-model">7 Active Model</a></h3>
<p>変更の詳細については<a href="https://github.com/rails/rails/blob/4-1-stable/activemodel/CHANGELOG.md">Changelog</a> を参照してください。</p>
<h4 id="active-model-非推奨"><a href="#active-model-%E9%9D%9E%E6%8E%A8%E5%A5%A8">7.1 非推奨</a></h4>
<ul>
<li>
<code>Validator#setup</code>は非推奨です。今後はバリデーターのコンストラクタ内で手動で行なう必要があります。(<a href="https://github.com/rails/rails/commit/7d84c3a2f7ede0e8d04540e9c0640de7378e9b3a">Commit</a>)</li>
</ul>
<h4 id="active-model-主な変更点"><a href="#active-model-%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9">7.2 主な変更点</a></h4>
<ul>
<li><p><code>ActiveModel::Dirty</code>に、状態を制御する新しいAPI<code>reset_changes</code> および<code>changes_applied</code>が追加されました。</p></li>
<li><p>検証の定義時に複数のコンテキストを指定できるようになりました。(<a href="https://github.com/rails/rails/pull/13754">Pull Request</a>)</p></li>
<li><p><code>attribute_changed?</code>がハッシュを受け付けるようになり、属性が与えられた値<code>に</code>変更されたか(または与えられた値<code>から</code>変更されたか)どうかをチェックするようになりました。(<a href="https://github.com/rails/rails/pull/13131">Pull Request</a>)</p></li>
</ul>
<h3 id="active-support"><a href="#active-support">8 Active Support</a></h3>
<p>変更の詳細については<a href="https://github.com/rails/rails/blob/4-1-stable/activesupport/CHANGELOG.md">Changelog</a> を参照してください。</p>
<h4 id="active-support-削除されたもの"><a href="#active-support-%E5%89%8A%E9%99%A4%E3%81%95%E3%82%8C%E3%81%9F%E3%82%82%E3%81%AE">8.1 削除されたもの</a></h4>
<ul>
<li><p><code>MultiJSON</code>依存が削除されました。これにより、<code>ActiveSupport::JSON.decode</code>は<code>MultiJSON</code>のオプションハッシュを受け付けなくなりました。(<a href="https://github.com/rails/rails/pull/10576">Pull Request</a> / <a href="upgrading_ruby_on_rails.html#json%E3%81%AE%E6%89%B1%E3%81%84%E3%81%AE%E5%A4%89%E6%9B%B4%E7%82%B9">詳細</a>)</p></li>
<li><p>カスタムオブジェクトをJSONにエンコードする<code>encode_json</code>フックのサポートが削除されました。この機能は<a href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a> gemに書き出されました。
この機能は<a href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a> gemに書き出されました。</p></li>
<li><p>非推奨の<code>ActiveSupport::JSON::Variable</code>が代替なしで削除されました。</p></li>
<li><p>非推奨の<code>String#encoding_aware?</code>コアエクステンション (<code>core_ext/string/encoding</code>) が削除されました。</p></li>
<li><p>非推奨の<code>Module#local_constant_names</code>が削除されました。<code>Module#local_constants</code>を使用します。</p></li>
<li><p>非推奨の<code>DateTime.local_offset</code>が削除されました。<code>DateTime.civil_from_format</code>を使用します。</p></li>
<li><p>非推奨の<code>Logger</code>コアエクステンション (<code>core_ext/logger.rb</code>) が削除されました。</p></li>
<li><p>非推奨の<code>Time#time_with_datetime_fallback</code>、<code>Time#utc_time</code>、<code>Time#local_time</code>が削除されました。<code>Time#utc</code>および<code>Time#local</code>を使用します。</p></li>
<li><p>非推奨の<code>Hash#diff</code>が代替なしで削除されました。</p></li>
<li><p>非推奨の<code>Date#to_time_in_current_zone</code>が削除されました。<code>Date#in_time_zone</code>を使用します。</p></li>
<li><p>非推奨の<code>Proc#bind</code>が代替なしで削除されました。</p></li>
<li><p>非推奨の<code>Array#uniq_by</code>と<code>Array#uniq_by!</code>が削除されました。ネイティブの<code>Array#uniq</code>および<code>Array#uniq!</code>を使用してください。</p></li>
<li><p>非推奨の<code>ActiveSupport::BasicObject</code>が削除されました。<code>ActiveSupport::ProxyObject</code>を使用してください。</p></li>
<li><p>非推奨の<code>BufferedLogger</code>が削除されました。<code>ActiveSupport::Logger</code>を使用してください。</p></li>
<li><p>非推奨の<code>assert_present</code>メソッドと<code>assert_blank</code>メソッドが削除されました。<code>assert object.blank?</code>および<code>assert object.present?</code>を使用してください。</p></li>
<li><p>フィルタオブジェクト用の非推奨<code>#filter</code>メソッドが削除されました。対応する別のメソッドを使用してください。(before filterの<code>#before</code>など)</p></li>
<li><p>デフォルトの活用形から不規則活用の'cow' =&gt; 'kine'が削除されました。(<a href="https://github.com/rails/rails/commit/c300dca9963bda78b8f358dbcb59cabcdc5e1dc9">Commit</a>)</p></li>
</ul>
<h4 id="非推奨"><a href="#%E9%9D%9E%E6%8E%A8%E5%A5%A8">8.2 非推奨</a></h4>
<ul>
<li><p>時間表現<code>Numeric#{ago,until,since,from_now}</code>が非推奨になりました。この値はAS::Durationに明示的に変換してください。例: <code>5.ago</code> =&gt; <code>5.seconds.ago</code> (<a href="https://github.com/rails/rails/pull/12389">Pull Request</a>)</p></li>
<li><p>requireパス<code>active_support/core_ext/object/to_json</code>が非推奨になりました。<code>active_support/core_ext/object/json</code>を代りにrequireしてください。(<a href="https://github.com/rails/rails/pull/12203">Pull Request</a>)</p></li>
<li><p><code>ActiveSupport::JSON::Encoding::CircularReferenceError</code>が非推奨になりました。この機能は<a href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a> gemに書き出されました。(<a href="https://github.com/rails/rails/pull/10785">Pull Request</a> / <a href="upgrading_ruby_on_rails.html#json%E3%81%AE%E6%89%B1%E3%81%84%E3%81%AE%E5%A4%89%E6%9B%B4%E7%82%B9">詳細</a>)</p></li>
<li><p><code>ActiveSupport.encode_big_decimal_as_string</code>オプションが非推奨になりました。この機能は<a href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a> gemに書き出されました。
(<a href="https://github.com/rails/rails/pull/13060">Pull Request</a> / <a href="upgrading_ruby_on_rails.html#json%E3%81%AE%E6%89%B1%E3%81%84%E3%81%AE%E5%A4%89%E6%9B%B4%E7%82%B9">詳細</a>)</p></li>
<li><p>カスタムの<code>BigDecimal</code>シリアライズが非推奨になりました。(<a href="https://github.com/rails/rails/pull/13911">Pull Request</a>)</p></li>
</ul>
<h4 id="active-support-主な変更点"><a href="#active-support-%E4%B8%BB%E3%81%AA%E5%A4%89%E6%9B%B4%E7%82%B9">8.3 主な変更点</a></h4>
<ul>
<li><p><code>ActiveSupport</code>のJSONエンコーダーが書き直され、pure-RubyのカスタムエンコーディングではなくJSON gemを利用するようになりました。
(<a href="https://github.com/rails/rails/pull/12183">Pull Request</a> / <a href="upgrading_ruby_on_rails.html#json%E3%81%AE%E6%89%B1%E3%81%84%E3%81%AE%E5%A4%89%E6%9B%B4%E7%82%B9">詳細</a>)</p></li>
<li><p>JSON gemとの互換性が向上しました。
(<a href="https://github.com/rails/rails/pull/12862">Pull Request</a> / <a href="upgrading_ruby_on_rails.html#json%E3%81%AE%E6%89%B1%E3%81%84%E3%81%AE%E5%A4%89%E6%9B%B4%E7%82%B9">詳細</a>)</p></li>
<li><p><code>ActiveSupport::Testing::TimeHelpers#travel</code>および<code>#travel_to</code>が追加されました。これらのメソッドは、<code>Time.now</code>および<code>Date.today</code>をスタブ化することによって、現在時刻を指定の時刻または時間に変換します。</p></li>
<li><p><code>ActiveSupport::Testing::TimeHelpers#travel_back</code>が追加されました。このメソッドは、<code>travel</code>および<code>travel_to</code>メソッドによって追加されたスタブを削除することで、現在時刻を元の状態に戻します。(<a href="https://github.com/rails/rails/pull/13884">Pull Request</a>)</p></li>
<li><p><code>Numeric#in_milliseconds</code>が追加されました。<code>1.hour.in_milliseconds</code>のように使用でき、これを<code>getTime()</code>などのJavaScript関数に渡すことができます。(<a href="https://github.com/rails/rails/commit/423249504a2b468d7a273cbe6accf4f21cb0e643">Commit</a>)</p></li>
<li><p><code>Date#middle_of_day</code>、<code>DateTime#middle_of_day</code>、<code>Time#middle_of_day</code>メソッドが追加されました。エイリアスとして<code>midday</code>、<code>noon</code>、<code>at_midday</code>、<code>at_noon</code>、<code>at_middle_of_day</code>も追加されました。(<a href="https://github.com/rails/rails/pull/10879">Pull Request</a>)</p></li>
<li><p>期間を生成するための<code>Date#all_week/month/quarter/year</code>が追加されました。(<a href="https://github.com/rails/rails/pull/9685">Pull Request</a>)</p></li>
<li><p><code>Time.zone.yesterday</code>と<code>Time.zone.tomorrow</code>が追加されました。(<a href="https://github.com/rails/rails/pull/12822">Pull Request</a>)</p></li>
<li><p>よく使用される<code>String#gsub("pattern,'')</code>の省略表現として<code>String#remove(pattern)</code>が追加されました。(<a href="https://github.com/rails/rails/commit/5da23a3f921f0a4a3139495d2779ab0d3bd4cb5f">Commit</a>)</p></li>
<li><p>値がnilの項目をハッシュから削除するための<code>Hash#compact</code>および<code>Hash#compact!</code>が追加されました。(<a href="https://github.com/rails/rails/pull/13632">Pull Request</a>)</p></li>
<li><p><code>blank?</code>および<code>present?</code>はシングルトンを返します。(<a href="https://github.com/rails/rails/commit/126dc47665c65cd129967cbd8a5926dddd0aa514">Commit</a>)</p></li>
<li><p>新しい<code>I18n.enforce_available_locales</code> configのデフォルトは<code>true</code>です。これは、ロケールに渡された<code>I18n</code>が<code>available_locales</code>リストに載っていなければならないということです。(<a href="https://github.com/rails/rails/pull/13341">Pull Request</a>)</p></li>
</ul>
<p><code>Module#concerning</code>が導入されました。自然かつ堅苦しくない方法で、クラスから責任を分離します。(<a href="https://github.com/rails/rails/commit/1eee0ca6de975b42524105a59e0521d18b38ab81">Commit</a>)</p>
<ul>
<li>
<code>Object#presence_in</code>が追加されました。値のホワイトリスト化を簡略化します。(<a href="https://github.com/rails/rails/commit/4edca106daacc5a159289eae255207d160f22396">Commit</a>)</li>
</ul>
<h3 id="クレジット表記"><a href="#%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E8%A1%A8%E8%A8%98">9 クレジット表記</a></h3>
<p>膨大な時間を費やしてRailsを作り、頑丈かつ安定したフレームワークにしてくれた多くの皆様については、<a href="http://contributors.rubyonrails.org/">Railsコントリビューターの完全なリスト</a>を参照してください。これらの方々全員に敬意を表明いたします。</p>
</body></html>

        
        <h3>フィードバックについて</h3>
        <p>
          本ガイドの訳文およびソースコードは、GitHub上の <a href="https://github.com/yasslab/railsguides.jp">yasslab/railsguides.jp</a> で管理・公開されております。
	  本ガイドを読んで、誤字・脱字・誤訳などを見かけましたら、上記リポジトリにてお気軽に <a href="https://github.com/yasslab/railsguides.jp/issues">Issue</a> を出して頂けると大変嬉しいです。また、「Pull Request を送りたい!」という場合には、<a href="ruby_on_rails_guides_guidelines.html">Ruby on Railsガイドのガイドライン</a>と、<a href="https://github.com/yasslab/railsguides.jp#%E7%BF%BB%E8%A8%B3%E3%81%AE%E6%B5%81%E3%82%8C">README</a>に記載されている「翻訳の流れ」をご参考にしてください。
	</p>
	<p>
	  なお、原著レベルでの間違いを見つけましたら、原著へのフィードバック方法 (<a href="http://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">documentation contributions</a>) をご参考にしてください。
        </p>
        <p>
	  本ガイドの品質向上に向けて、皆さまのご協力が得られれば幸いです。よろしくお願い致します。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <ol class="snsb" style="margin-left: 13px">
	<li><a href="http://www.railscp.org/text/" target="_blank"><img src="images/railscp_logo.png" width="150px"/></a></li>
      </ol>
      <ol class="snsb" style="margin-left: 13px">
	<li><iframe src="http://ghbtns.com/github-btn.html?user=yasslab&repo=railsguides.jp&type=watch&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="80" height="20"></iframe></li>
	<li><a href="http://b.hatena.ne.jp/entry/railsguides.jp" class="hatena-bookmark-button" data-hatena-bookmark-title="Ruby on Rails ガイド：体系的に Rails を学ぼう (Rails 4.2 対応)" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script></li>
	<li><div class="fb-like" data-href="http://railsguides.jp/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div></li>
	<li><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://railsguides.jp/" data-text="Ruby on Rails ガイド：体系的に Rails を学ぼう (Rails 4.2 対応)" data-lang="ja" data-hashtags="Railsガイド" width="100">ツイート</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></li>
      </ol>
      <ol class="snsb" style="margin-left: 13px">
	<li>本ガイドは<a href="https://creativecommons.org/licenses/by-sa/4.0/deed.ja">クリエイティブ・コモンズ 表示-継承 4.0 国際</a> (CC BY-SA 4.0) ライセンスに基づいて公開されています。</li>
	<li>「Rails」および「Ruby on Rails」という名称、そして Rails のロゴは、David Heinemeier Hansson による登録商標で、すべての権利を有しています。</li>
      </ol>
    </div>
  </div>
</h5>
  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all();
    $(guidesIndex.bind);
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
    ga('create', 'UA-50163209-4', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
